<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Traefik+mkcertï¼šLocalç«¯ ç°¡æ˜“TLS Domainæ¨¡æ“¬ç’°å¢ƒ</title>
      <link href="/posts/Traefik+mkcert%20Local%E7%AB%AF%20%E7%B0%A1%E6%98%93TLS%20Domain%E6%A8%A1%E6%93%AC%E7%92%B0%E5%A2%83/"/>
      <url>/posts/Traefik+mkcert%20Local%E7%AB%AF%20%E7%B0%A1%E6%98%93TLS%20Domain%E6%A8%A1%E6%93%AC%E7%92%B0%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨é–‹ç™¼ Web æ‡‰ç”¨æˆ– API æœå‹™æ™‚ï¼Œå¯èƒ½æœƒé‡åˆ°éœ€è¦æ¨¡æ“¬ã€Œæ­£å¼ç’°å¢ƒã€çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼š</p><ul><li>æ¸¬è©¦å‰ç«¯åœ¨ HTTPS ä¸‹çš„è¡Œç‚ºï¼ˆä¾‹å¦‚ Cookie çš„ Secure å±¬æ€§ã€Service Worker çš„è¨»å†Šã€ç€è¦½å™¨å®‰å…¨æ€§é™åˆ¶ç­‰ï¼‰</li><li>ä½¿ç”¨ OAuth æˆ–ç¬¬ä¸‰æ–¹ç™»å…¥æœå‹™æ™‚ï¼Œè¦æ±‚ callback URL å¿…é ˆç‚º HTTPS ç¶²åŸŸ</li><li>æ¨¡æ“¬å¯¦éš›éƒ¨ç½²æƒ…å¢ƒä¸­çš„å¤šå€‹å­ç¶²åŸŸ</li></ul><h2 id="ç« ç¯€é‡é»"><a href="#ç« ç¯€é‡é»" class="headerlink" title="ç« ç¯€é‡é»"></a>ç« ç¯€é‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>Dockerå®‰è£</li><li>Kindå®‰è£</li><li>helmå®‰è£</li></ul></li><li>Traefik ä»‹ç´¹</li><li>mkcert ä»‹ç´¹</li><li>Docker Compose è·¯ç”±è½‰ç™¼è¨­ç½®</li><li>Kubernetes Ingress è·¯ç”±è½‰ç™¼è¨­ç½®</li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><h3 id="Dockerå®‰è£"><a href="#Dockerå®‰è£" class="headerlink" title="Dockerå®‰è£"></a>Dockerå®‰è£</h3><p>Dockerå®‰è£æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ç§»é™¤èˆŠç‰ˆæœ¬çš„docker</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure><p>çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°‡$USERåŠ å…¥dockerç¾¤çµ„</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ›ç¾¤çµ„</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><h3 id="Kindå®‰è£"><a href="#Kindå®‰è£" class="headerlink" title="Kindå®‰è£"></a>Kindå®‰è£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For AMD64 / x86_64</span></span><br><span class="line">[ $(uname -m) = x86_64 ] &amp;&amp; curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.29.0/kind-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># For ARM64</span></span><br><span class="line">[ $(uname -m) = aarch64 ] &amp;&amp; curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.29.0/kind-linux-arm64</span><br><span class="line">chmod +x ./kind</span><br><span class="line">sudo mv ./kind /usr/<span class="built_in">local</span>/bin/kind</span><br></pre></td></tr></table></figure><h3 id="mkcert-å®‰è£"><a href="#mkcert-å®‰è£" class="headerlink" title="mkcert å®‰è£"></a>mkcert å®‰è£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libnss3-tools</span><br><span class="line"></span><br><span class="line">curl -JLO <span class="string">&quot;https://dl.filippo.io/mkcert/latest?for=linux/amd64&quot;</span></span><br><span class="line">chmod +x mkcert-v*-linux-amd64</span><br><span class="line">sudo cp mkcert-v*-linux-amd64 /usr/<span class="built_in">local</span>/bin/mkcert</span><br></pre></td></tr></table></figure><h2 id="Traefik-ä»‹ç´¹"><a href="#Traefik-ä»‹ç´¹" class="headerlink" title="Traefik ä»‹ç´¹"></a>Traefik ä»‹ç´¹</h2><p>Traefikæ˜¯ä¸€å€‹çš„ <strong>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰</strong> å’Œ <strong>è² è¼‰å¹³è¡¡å™¨ï¼ˆLoad Balancerï¼‰</strong>çš„æœå‹™ï¼Œä¸¦ä¸”æ”¯æ´å®¹å™¨åŒ–Dockerã€Kubernetesæ•´åˆï¼Œå¯ä»¥ä¾¿åˆ©çš„è™•ç†Ingressçš„è·¯ç”±è™•ç†ã€‚</p><p>å…¶ä¸­æä¾›äº†docker imageã€k8s Ingresså’Œè‡ªå®šç¾©çš„CRD IngressRouteä½œç‚ºProxy/Ingressè§’è‰²è™•ç†è·¯ç”±</p><h3 id="Traefik-meä»‹ç´¹"><a href="#Traefik-meä»‹ç´¹" class="headerlink" title="Traefik meä»‹ç´¹"></a>Traefik meä»‹ç´¹</h3><p><strong>Traefik.me</strong> æ˜¯ä¸€å€‹æä¾›ã€ŒWildcard DNSã€çš„å…è²»æœå‹™ã€‚å¯ä»¥é€éé¡ä¼¼ <code>10.0.0.1.traefik.me</code> ç¶²å€ï¼Œ<strong>ç›´æ¥å°æ‡‰åˆ°æŒ‡å®š IPï¼ˆä¾‹å¦‚æœ¬æ©Ÿæˆ–å€ç¶²å…§çš„é–‹ç™¼ä¼ºæœå™¨ï¼‰</strong>ï¼Œä¸éœ€è¦é¡å¤–è¨­å®š DNS æˆ– <code>/etc/hosts</code>ï¼Œå…¶èƒŒå¾Œé‹ä½œçš„æ˜¯ä¸€å° <strong>è‡ªè¨‚çš„ DNS ä¼ºæœå™¨</strong>ï¼Œå®ƒæœƒå¾é€™å€‹ç¶²åŸŸåç¨±ä¸­<strong>è§£æå‡º IP åœ°å€</strong>ï¼Œç„¶å¾Œç›´æ¥å›å‚³ã€‚</p><p>ç¯„ä¾‹ï¼š</p><ul><li><code>10.0.0.1.traefik.me</code> â æœƒè‡ªå‹•è§£ææˆ <code>10.0.0.1</code></li><li><code>app.10.0.0.1.traefik.me</code> â ä¸€æ¨£æœƒæŒ‡å‘ <code>10.0.0.1</code></li><li><code>mysite.traefik.me</code> â é è¨­æŒ‡å‘ <code>127.0.0.1</code> </li></ul><div class="note info flat no-icon flat"><p>ğŸ’¡ éIPé¡å‹ï¼Œç„¡æ³•è¾¨åˆ¥çš„æœƒå°å‘127.0.0.1ï¼Œéå¸¸é©åˆç”¨ä¾†Localæœå‹™æ¸¬è©¦</p></div><h2 id="mkcert-ä»‹ç´¹"><a href="#mkcert-ä»‹ç´¹" class="headerlink" title="mkcert ä»‹ç´¹"></a>mkcert ä»‹ç´¹</h2><p><code>mkcert</code> æ˜¯ä¸€å€‹ç”¨ä¾†åœ¨æœ¬åœ°ç”¢ç”Ÿã€Œå—ä¿¡ä»»çš„é–‹ç™¼ç”¨ SSL æ†‘è­‰ã€çš„å·¥å…·ï¼Œå…å»è‡ªå·±æ¶è¨­ CA ç­‰éº»ç…©è¨­ç½®ï¼Œé‚„å¯é¿å…å¦‚è‡ªç°½æ†‘è­‰æœƒæœ‰ç€è¦½å™¨è­¦å‘Šã€‚</p><h3 id="å®‰è£æœ¬åœ°CAæ†‘è­‰"><a href="#å®‰è£æœ¬åœ°CAæ†‘è­‰" class="headerlink" title="å®‰è£æœ¬åœ°CAæ†‘è­‰"></a>å®‰è£æœ¬åœ°CAæ†‘è­‰</h3><p>æœƒåœ¨ä½ çš„ç³»çµ±ä¸­å»ºç«‹ä¸¦å®‰è£ä¸€å€‹æœ¬åœ°çš„æ†‘è­‰æˆæ¬Šæ©Ÿæ§‹ï¼ˆCAï¼‰ï¼Œä¸¦åŠ å…¥åˆ°ç³»çµ± çš„ä¿¡ä»»æ†‘è­‰åº«ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert -install</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹æŒ‡å®šåŸŸåSSLæ†‘è­‰"><a href="#å»ºç«‹æŒ‡å®šåŸŸåSSLæ†‘è­‰" class="headerlink" title="å»ºç«‹æŒ‡å®šåŸŸåSSLæ†‘è­‰"></a>å»ºç«‹æŒ‡å®šåŸŸåSSLæ†‘è­‰</h3><p>ç‚ºæŒ‡å®šçš„åŸŸåæˆ– IP ç”¢ç”Ÿ SSL æ†‘è­‰ï¼Œæœƒç”¢ç”Ÿç›¸æ‡‰çš„å…¬é–‹æ†‘è­‰èˆ‡ç§é‘°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert &lt;æŒ‡å®šçš„åŸŸåor IP&gt;</span><br></pre></td></tr></table></figure><h2 id="Docker-Compose-è·¯ç”±è½‰ç™¼è¨­ç½®"><a href="#Docker-Compose-è·¯ç”±è½‰ç™¼è¨­ç½®" class="headerlink" title="Docker Compose è·¯ç”±è½‰ç™¼è¨­ç½®"></a>Docker Compose è·¯ç”±è½‰ç™¼è¨­ç½®</h2><div class="note info flat no-icon flat"><p>ğŸ’¡ ç¯„æœ¬å¯åƒè€ƒï¼š<a href="https://github.com/SP12893678/traefik-ingress-example/tree/main/docker-compose">https://github.com/SP12893678/traefik-ingress-example/tree/main/docker-compose</a></p></div><h3 id="Docker-Compose-è¨­ç½®"><a href="#Docker-Compose-è¨­ç½®" class="headerlink" title="Docker Compose è¨­ç½®"></a>Docker Compose è¨­ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">traefik:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">traefik:v2.10</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--entrypoints.web.address=:80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--entrypoints.websecure.address=:443</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--entrypoints.websecure.http.tls=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--providers.docker=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--providers.file.directory=/etc/traefik/dynamic</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--providers.file.watch=true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./certs:/certs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./dynamic:/etc/traefik/dynamic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">whoami:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">containous/whoami</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;traefik.http.routers.whoami.rule=Host(`whoami.traefik.me`)&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;traefik.http.routers.whoami.entrypoints=websecure&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;traefik.http.routers.whoami.tls=true&quot;</span></span><br></pre></td></tr></table></figure><div class="note info flat no-icon flat"><p><strong>Entrypoints</strong></p><ul><li><code>web</code>ï¼šå°æ‡‰ <strong>HTTP</strong>ï¼ˆport 80ï¼‰</li><li><code>websecure</code>ï¼šå°æ‡‰ <strong>HTTPS</strong>ï¼ˆport 443ï¼‰ï¼Œä¸¦å•Ÿç”¨ <strong>TLS</strong></li></ul><p><strong>Providers</strong></p><p>Traefik æ”¯æ´å¤šç¨®æœå‹™æä¾›è€…ï¼ˆProvidersï¼‰ï¼Œé€™è£¡æˆ‘å€‘å•Ÿç”¨äº†å…©ç¨®ï¼š</p><ul><li><code>docker</code>ï¼šå¾å…¶ä»– container çš„ <code>labels</code> è‡ªå‹•è®€å–è·¯ç”±è¦å‰‡</li><li><code>file</code>ï¼šå¾æŒ‡å®šç›®éŒ„ï¼ˆå¦‚ <code>dynamic/</code>ï¼‰è®€å–è¨­å®šï¼ˆå¯ç”¨ä¾†å®šç¾© TLS æ†‘è­‰ã€middlewares ç­‰ï¼‰</li></ul><p><strong>Volume æ›è¼‰</strong></p><ul><li><code>certs/</code>ï¼šå­˜æ”¾ <code>mkcert</code> ç”¢ç”Ÿçš„æ†‘è­‰æª”ï¼ˆ<code>.pem</code>, <code>.key</code>ï¼‰</li><li><code>dynamic/</code>ï¼šéœæ…‹è¨­å®šæª”ï¼ˆä¾‹å¦‚ <code>tls.yml</code>ï¼‰ï¼Œç”± file provider æƒæ</li></ul></div><h4 id="Traefik-labels-èªªæ˜"><a href="#Traefik-labels-èªªæ˜" class="headerlink" title="Traefik labels èªªæ˜"></a>Traefik labels èªªæ˜</h4><p><code>whoami</code> æ˜¯ä¸€å€‹ç°¡æ˜“æ¸¬è©¦æœå‹™ï¼Œæœƒå›å‚³ä½ çš„ IP å’Œä¸€äº›è«‹æ±‚è³‡è¨Šã€‚<br>é€™æ®µ label è¨­å®šäº†ï¼šè¨ªå• <code>https://whoami.traefik.me</code> æ™‚ï¼Œè«‹æ±‚æœƒè¢« Traefik æ¥æ”¶ä¸¦ä½¿ç”¨ TLSï¼Œç„¶å¾Œè½‰ç™¼åˆ° <code>whoami</code> æœå‹™ã€‚</p><p>Traefik é€é Docker container çš„ <code>labels</code> ä¾†è¨­å®šè·¯ç”±ï¼ˆrouterï¼‰ï¼Œè€Œ <code>traefik.http.routers</code> æ˜¯å®šç¾© HTTP è·¯ç”±çš„æ ¸å¿ƒè¨­å®šã€‚router è² è²¬åŒ¹é…ç¬¦åˆæ¢ä»¶çš„è«‹æ±‚ï¼Œä¸¦å°‡è«‹æ±‚å°å‘æŒ‡å®šçš„æœå‹™ã€‚</p><table><thead><tr><th>Label åç¨±</th><th>èªªæ˜</th></tr></thead><tbody><tr><td><code>traefik.http.routers.&lt;router_name&gt;.rule</code></td><td>å®šç¾©å¦‚ä½•åŒ¹é…è«‹æ±‚ï¼ˆå¦‚ Hostã€Pathï¼‰ä¾‹ï¼š<code>Host(</code>whoami.traefik.me<code>)</code></td></tr><tr><td><code>traefik.http.routers.&lt;router_name&gt;.entrypoints</code></td><td>æŒ‡å®šæ­¤è·¯ç”±å°æ‡‰çš„å…¥å£é»ï¼Œå¦‚ <code>web</code>, <code>websecure</code></td></tr><tr><td><code>traefik.http.routers.&lt;router_name&gt;.tls</code></td><td>è‹¥è¨­ç‚º <code>true</code>ï¼Œè¡¨ç¤ºæ­¤è·¯ç”±æœƒä½¿ç”¨ TLS</td></tr></tbody></table><div class="note info flat no-icon flat"><p>è©³ç´°è¨­ç½®åƒè€ƒ: <a href="https://doc.traefik.io/traefik/routing/providers/docker/">Traefik Docker Routing Documentation - Traefik</a></p></div><h3 id="å»ºç«‹TLS-secretæ†‘è­‰"><a href="#å»ºç«‹TLS-secretæ†‘è­‰" class="headerlink" title="å»ºç«‹TLS secretæ†‘è­‰"></a><strong>å»ºç«‹TLS secretæ†‘è­‰</strong></h3><p>ä½¿ç”¨ <code>mkcert</code> å»ºç«‹æœ¬åœ°çš„è‡ªç°½æ†‘è­‰ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨æœ¬æ©Ÿä½¿ç”¨ HTTPS åŠ å¯†å­˜å– <code>whoami.traefik.me</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkcert</span> <span class="string">whoami.traefik.me</span></span><br></pre></td></tr></table></figure><p>æœƒç”¢ç”Ÿå…©å€‹æª”æ¡ˆï¼š</p><ul><li><code>whoami.traefik.me.pem</code>ï¼ˆæ†‘è­‰ï¼‰</li><li><code>whoami.traefik.me-key.pem</code>ï¼ˆç§é‘°ï¼‰</li></ul><p>è«‹å°‡é€™å…©å€‹æª”æ¡ˆæ”¾å…¥ <code>certs/</code> ç›®éŒ„ä¸­ã€‚</p><h3 id="è¨­ç½®Traefikéœ€è¦è®€å–-TLSè¨­å®š"><a href="#è¨­ç½®Traefikéœ€è¦è®€å–-TLSè¨­å®š" class="headerlink" title="è¨­ç½®Traefikéœ€è¦è®€å– TLSè¨­å®š"></a>è¨­ç½®Traefikéœ€è¦è®€å– TLSè¨­å®š</h3><p>å»ºç«‹ <code>dynamic/tls.yml</code> æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼Œè®“ Traefik çŸ¥é“è¦ä½¿ç”¨å‰›å‰›ç”¢ç”Ÿçš„æ†‘è­‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tls:</span></span><br><span class="line">  <span class="attr">certificates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">certFile:</span> <span class="string">/certs/whoami.traefik.me.pem</span></span><br><span class="line">      <span class="attr">keyFile:</span> <span class="string">/certs/whoami.traefik.me-key.pem</span></span><br></pre></td></tr></table></figure><p>é€™å€‹æª”æ¡ˆæœƒé€é <code>docker-compose.yml</code> ä¸­çš„ volume æ›è¼‰é€² <code>/etc/traefik/dynamic</code>ï¼Œç”± <code>--providers.file.directory</code> æŒ‡å®šçš„ä½ç½®è¼‰å…¥ã€‚åªè¦ Traefik æœ‰å•Ÿç”¨ <code>--providers.file.watch=true</code>ï¼Œè®Šæ›´æœƒè‡ªå‹•å¥—ç”¨ã€‚</p><h3 id="å•Ÿå‹•æœå‹™"><a href="#å•Ÿå‹•æœå‹™" class="headerlink" title="å•Ÿå‹•æœå‹™"></a>å•Ÿå‹•æœå‹™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">compose</span> <span class="string">up</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure><p>åŸå‰‡ä¸Šï¼Œæœå‹™å•Ÿå‹•å¾Œï¼Œwhoami.traefik.meå°±å¯ä»¥æŸ¥çœ‹åˆ°whoamiæä¾›çš„ç›¸é—œè³‡è¨Š</p><h2 id="Kubernetes-Ingress-è·¯ç”±è½‰ç™¼è¨­ç½®"><a href="#Kubernetes-Ingress-è·¯ç”±è½‰ç™¼è¨­ç½®" class="headerlink" title="Kubernetes Ingress è·¯ç”±è½‰ç™¼è¨­ç½®"></a>Kubernetes Ingress è·¯ç”±è½‰ç™¼è¨­ç½®</h2><p>åœ¨ä¸‹é¢çš„ç’°ç¯€ä¸­ï¼Œæ‰“ç®—å®‰è£<strong>Prometheus stack</strong>ï¼Œä¸¦å°‡<code>http://grafana.traefik.me</code> å°åˆ° <code>grafana</code>æœå‹™ä¸Š</p><p>ç¤¾ç¾¤ç¶­è­·çš„ <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack"><code>kube-prometheus-stack</code></a>ï¼Œæä¾›Helmæ–¹å¼å¿«é€Ÿå®‰è£Prometheusã€Grafanaç­‰å¯è§€æ¸¬æ€§æœå‹™ã€‚</p><h3 id="Kindè¨­ç½®"><a href="#Kindè¨­ç½®" class="headerlink" title="Kindè¨­ç½®"></a>Kindè¨­ç½®</h3><p>å»ºç«‹ kind-config.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">    <span class="attr">extraPortMappings:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">hostPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">        <span class="attr">hostPort:</span> <span class="number">443</span></span><br></pre></td></tr></table></figure><p>é€™æ®µè¨­å®šæœƒè®“ <code>kind</code> å»ºç«‹çš„æœ¬åœ° Kubernetes cluster èƒ½å¤ å°‡æœ¬æ©Ÿçš„ 80ï¼ˆHTTPï¼‰èˆ‡ 443ï¼ˆHTTPSï¼‰port æ˜ å°„åˆ° container çš„å°æ‡‰ portï¼Œé€™æ¨£æ‰èƒ½ç”¨ <code>localhost</code> æˆ– <code>*.traefik.me</code> é€™ç¨®æœ¬åœ°æ¸¬è©¦åŸŸåç›´æ¥è¨ªå•æœå‹™ã€‚</p><h3 id="å»ºç«‹Cluster"><a href="#å»ºç«‹Cluster" class="headerlink" title="å»ºç«‹Cluster"></a>å»ºç«‹Cluster</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind create cluster --name demo --config kind-config.yml </span><br></pre></td></tr></table></figure><h3 id="å®‰è£-Traefik-stack"><a href="#å®‰è£-Traefik-stack" class="headerlink" title="å®‰è£ Traefik stack"></a><strong>å®‰è£ Traefik stack</strong></h3><p>Helm å®‰è£ Traefikï¼Œä¸¦é€é <code>hostPort</code> å°‡ Traefik çš„ <code>web</code>ï¼ˆ80ï¼‰èˆ‡ <code>websecure</code>ï¼ˆ443ï¼‰ entrypoint æš´éœ²åˆ°æœ¬æ©Ÿç¶²è·¯ä¸­ï¼Œå°æ‡‰å‰é¢ Kind çš„ port mappingã€‚é€™æ¨£æ‰å¯ä»¥è®“æˆ‘å€‘è¨ªå• <code>http://grafana.traefik.me</code> ç­‰ç¶²å€æ™‚ï¼Œè‡ªå‹•é€²å…¥ Traefik è™•ç†è·¯ç”±é‚è¼¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">helm repo add traefik https://traefik.github.io/charts</span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line">helm install traefik traefik/traefik \</span><br><span class="line">  --namespace=traefik --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> service.type=ClusterIP \</span><br><span class="line">  --<span class="built_in">set</span> ports.web.hostPort=80 \</span><br><span class="line">  --<span class="built_in">set</span> ports.websecure.hostPort=443 \</span><br><span class="line">  --<span class="built_in">set</span> ports.web.expose.enabled=<span class="literal">true</span> \</span><br><span class="line">  --<span class="built_in">set</span> ports.websecure.expose.enabled=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£-Prometheus-stack"><a href="#å®‰è£-Prometheus-stack" class="headerlink" title="å®‰è£ Prometheus stack"></a><strong>å®‰è£ Prometheus stack</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br><span class="line"></span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line">helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring --create-namespace</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹TLS-secret"><a href="#å»ºç«‹TLS-secret" class="headerlink" title="å»ºç«‹TLS secret"></a><strong>å»ºç«‹TLS secret</strong></h3><p>ä½¿ç”¨ <code>mkcert</code> å»ºç«‹æœ¬åœ°çš„è‡ªç°½æ†‘è­‰ï¼Œæä¾›è¨­ç½®Ingressæ‰€éœ€çš„æ†‘è­‰ä¾†æº</p><p>ä¸¦é€é <code>kubectl create secret tls</code> å°‡æ†‘è­‰ç­‰æ©Ÿå¯†è³‡è¨Šå­˜æ”¾åœ¨Secretï¼Œå¾…Ingressç‰©ä»¶è®€å– </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkcert grafana.traefik.me</span><br><span class="line"></span><br><span class="line">kubectl create secret tls grafana-cert-secret \</span><br><span class="line">  --cert=grafana.traefik.me.pem \</span><br><span class="line">  --key=grafana.traefik.me-key.pem \</span><br><span class="line">  -n monitoring</span><br></pre></td></tr></table></figure><h3 id="Ingressè¨­ç½®"><a href="#Ingressè¨­ç½®" class="headerlink" title="Ingressè¨­ç½®"></a>Ingressè¨­ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grafana-ingress.yml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitoring</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">traefik</span></span><br><span class="line">    <span class="attr">traefik.ingress.kubernetes.io/router.entrypoints:</span> <span class="string">websecure</span></span><br><span class="line">    <span class="attr">traefik.ingress.kubernetes.io/router.tls:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">traefik</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">grafana.traefik.me</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">grafana-cert-secret</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">grafana.traefik.me</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">prometheus-grafana</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Kubernetes åŸç”Ÿçš„ Ingress ç‰©ä»¶ä¾†è¨­å®šè·¯ç”±è½‰ç™¼è¦å‰‡ï¼Œé€éä»¥ä¸‹è¨­å®šï¼š</p><ul><li><code>annotations.traefik.ingress.kubernetes.io/router.entrypoints: websecure</code>  è¡¨ç¤ºé€™æ¢è·¯ç”±é€é HTTPS (<code>websecure</code>) entrypoint è™•ç†ã€‚</li><li><code>annotations.traefik.ingress.kubernetes.io/router.tls: &#39;true&#39;</code>  è¦æ±‚ä½¿ç”¨ TLSï¼ˆHTTPSï¼‰å”å®šè™•ç†ã€‚</li><li><code>spec.rules.host</code> èˆ‡ <code>spec.tls.hosts</code> éƒ½è¨­ç‚º <code>grafana.traefik.me</code>  è®“ Traefik æ ¹æ“š Hostname ä¾†æ¯”å°è«‹æ±‚ï¼Œä¸¦ç¶å®šå…ˆå‰å»ºç«‹çš„æ†‘è­‰ Secretã€‚</li></ul><p>æœ€çµ‚ï¼ŒIngress è¨­å®šæœƒå°‡ä½¿ç”¨ <code>https://grafana.traefik.me</code> çš„è«‹æ±‚è½‰ç™¼çµ¦ <code>prometheus-grafana</code> serviceã€‚</p><h3 id="åŸ·è¡Œå»ºç«‹Ingress"><a href="#åŸ·è¡Œå»ºç«‹Ingress" class="headerlink" title="åŸ·è¡Œå»ºç«‹Ingress"></a>åŸ·è¡Œå»ºç«‹Ingress</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f grafana-ingress.yml</span><br></pre></td></tr></table></figure><h3 id="Traefikçš„CRD-IngressRouteè¨­ç½®"><a href="#Traefikçš„CRD-IngressRouteè¨­ç½®" class="headerlink" title="Traefikçš„CRD IngressRouteè¨­ç½®"></a>Traefikçš„CRD IngressRouteè¨­ç½®</h3><p>Traefik æä¾›ä¸€ç¨®æ›´å½ˆæ€§çš„æ–¹å¼ä¾†è¨­å®šè·¯ç”±ï¼Œå«åš <code>IngressRoute</code>ã€‚å’ŒåŸç”Ÿ Ingress ç›¸æ¯”ï¼ŒIngressRoute æ”¯æ´æ›´å¤šæ¢ä»¶ã€çµ„åˆé‚è¼¯èˆ‡ä¸­ä»‹è™•ç†ï¼ˆmiddlewareï¼‰è¨­å®šã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grafana-ingress-route.yml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">traefik.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IngressRoute</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-ingressroute</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitoring</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">entryPoints:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">websecure</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">match:</span> <span class="string">Host(`grafana.traefik.me`)</span> <span class="string">&amp;&amp;</span> <span class="string">PathPrefix(`/`)</span></span><br><span class="line">      <span class="attr">kind:</span> <span class="string">Rule</span></span><br><span class="line">      <span class="attr">services:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-grafana</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">grafana-cert-secret</span></span><br></pre></td></tr></table></figure><p>è¨­å®šå’Œå‰é¢çš„ Ingress é¡ä¼¼ï¼š</p><ul><li><code>entryPoints</code> æŒ‡å®šé€²å…¥é»ç‚º <code>websecure</code>ï¼ˆHTTPSï¼‰</li><li><code>routes.match</code> ä½¿ç”¨ Host èˆ‡ PathPrefix çµ„åˆé‚è¼¯</li><li><code>services</code> æŒ‡å®šå¾Œç«¯æœå‹™èˆ‡å°æ‡‰ port</li><li><code>tls.secretName</code> æŒ‡å®šè¦ä½¿ç”¨çš„æ†‘è­‰ Secret</li></ul><h3 id="åŸ·è¡Œå»ºç«‹Ingress-Route"><a href="#åŸ·è¡Œå»ºç«‹Ingress-Route" class="headerlink" title="åŸ·è¡Œå»ºç«‹Ingress Route"></a>åŸ·è¡Œå»ºç«‹Ingress Route</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f grafana-ingress-route.yml</span><br></pre></td></tr></table></figure><p>åŸå‰‡ä¸Šï¼Œ<a href="http://grafana.traefik.me/">http://grafana.traefik.me/</a> å°±å¯ä»¥æˆåŠŸæŸ¥çœ‹åˆ°æ¶è¨­çš„ grafanaæœå‹™äº†</p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> DNS </tag>
            
            <tag> HTTPS </tag>
            
            <tag> Traefik </tag>
            
            <tag> Ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cloudflareï¼šDomain è¨—ç®¡ä¾¿æ·æ‡‰ç”¨ - Email Routing</title>
      <link href="/posts/Cloudflare%EF%BC%9ADomain%20%E8%A8%97%E7%AE%A1%E4%BE%BF%E6%8D%B7%E6%87%89%E7%94%A8Email%20Routing/"/>
      <url>/posts/Cloudflare%EF%BC%9ADomain%20%E8%A8%97%E7%AE%A1%E4%BE%BF%E6%8D%B7%E6%87%89%E7%94%A8Email%20Routing/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ“æœ‰ä¸€çµ„è‡ªå·±çš„åŸŸåï¼ˆDomainï¼‰å¯ä»¥å¯¦ç¾å¾ˆå¤šæ‡‰ç”¨ï¼Œæœ€ç°¡æ˜“çš„æ‡‰ç”¨æ˜¯å°‡æŒ‡å®šçš„åŸŸåè·¯ç”±åˆ°æ¶è¨­çš„æœå‹™ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥é€éåŸŸåè¨ªå•åˆ°æœå‹™ã€‚Cloudflare æä¾›åŸŸåè¨—ç®¡ï¼Œä¸¦æä¾›å„ç¨®æ•´åˆæ€§è³ªæœå‹™ï¼Œæœ¬æ¬¡è¦åˆ†äº«ä¿¡ä»¶æœå‹™çš„æ‡‰ç”¨ã€‚</p><h2 id="ç« ç¯€é‡é»"><a href="#ç« ç¯€é‡é»" class="headerlink" title="ç« ç¯€é‡é»"></a>ç« ç¯€é‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™</li><li>Domain Email Routing ç„¡é™Email æ”¶ä¿¡æ¸¬è©¦ç³»çµ±</li><li>Cloudflare Tunnels åˆ†äº«Localè‡¨æ™‚æ¸¬è©¦/Demoæœå‹™</li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><ul><li>æ“æœ‰ä¸€çµ„åŸŸå</li></ul><h2 id="Domain-Email-Routing-ç„¡é™Email-æ”¶ä¿¡æ¸¬è©¦ç³»çµ±"><a href="#Domain-Email-Routing-ç„¡é™Email-æ”¶ä¿¡æ¸¬è©¦ç³»çµ±" class="headerlink" title="Domain Email Routing ç„¡é™Email æ”¶ä¿¡æ¸¬è©¦ç³»çµ±"></a>Domain Email Routing ç„¡é™Email æ”¶ä¿¡æ¸¬è©¦ç³»çµ±</h2><p>ç•¶é–‹ç™¼ä¸€å€‹ç”¢å“æˆ–æœå‹™æ™‚ï¼Œå¯èƒ½æœƒè¨­è¨ˆè¨»å†Šé©—è­‰ä¿¡ã€é‚€è«‹ä¿¡ç­‰æ©Ÿåˆ¶ã€‚ä¸¦ä¸”ç”¢å“å¯èƒ½æœ‰å¾ˆå¤šä¸åŒçš„è§’è‰²èˆ‡æ¬Šé™è¨­ç½®ã€‚ç‚ºæ–¹ä¾¿æ¸¬è©¦ï¼Œéœ€è¦å¾ˆå¤šEmailå¸³è™Ÿï¼Œè€ŒCloudflareæä¾›çš„Email Routingæ©Ÿåˆ¶å¯ä»¥ç‚ºè‡ªå·±çš„ç¶²åŸŸå»ºç«‹è‡ªè¨‚é›»å­éƒµä»¶åœ°å€ï¼Œä¸¦å°‡æ”¶åˆ°çš„éƒµä»¶è½‰é€åˆ°æŒ‡å®šçš„ä¿¡ç®±ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image.png" alt="image.png"></p><h3 id="è¨­ç½®DNS-MX-Mail-Exchange-è¨˜éŒ„"><a href="#è¨­ç½®DNS-MX-Mail-Exchange-è¨˜éŒ„" class="headerlink" title="è¨­ç½®DNS MX(Mail Exchange)è¨˜éŒ„"></a>è¨­ç½®DNS MX(Mail Exchange)è¨˜éŒ„</h3><p>è¨­ç½®DNS MX(Mail Exchange)è¨˜éŒ„ï¼Œç”¨ä¾†æŒ‡å®šè©²ç¶²åŸŸåç¨±çš„<strong>é›»å­éƒµä»¶ä¼ºæœå™¨</strong></p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%201.png" alt="image.png"></p><p>é€™é‚ŠCloudflareå·²ç¶“å¸¶å‡ºè¨­å®šå…§å®¹ï¼Œè®“æˆ‘å€‘å¯ä»¥å¾ˆä¾¿åˆ©çš„ç›´æ¥å°‡DNSç´€éŒ„æŒ‡åˆ°Cloudflareçš„é›»å­éƒµä»¶ä¼ºæœå™¨ä¸Šï¼Œè®“ä»–ä¾†å¹«æˆ‘å€‘è™•ç†ä¿¡ä»¶çš„æ¥æ”¶èˆ‡è½‰ç™¼äº‹ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%202.png" alt="image.png"></p><p>è¨­å®šå®ŒDNS MXç´€éŒ„å¾Œï¼Œå°±æœƒå•Ÿç”¨Email routing ä¸¦ä¸”æœ‰å¯«å…¥ç›¸é—œçš„MXç´€éŒ„è¨­ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%203.png" alt="image.png"></p><h3 id="æ–°å¢è½‰ç™¼çš„éƒµä»¶åœ°å€"><a href="#æ–°å¢è½‰ç™¼çš„éƒµä»¶åœ°å€" class="headerlink" title="æ–°å¢è½‰ç™¼çš„éƒµä»¶åœ°å€"></a>æ–°å¢è½‰ç™¼çš„éƒµä»¶åœ°å€</h3><p>åœ¨Destination addressè¦æ–°å¢è½‰ç™¼çš„éƒµä»¶åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%204.png" alt="image.png"></p><h3 id="å•Ÿç”¨Email-Routingè¨­ç½®"><a href="#å•Ÿç”¨Email-Routingè¨­ç½®" class="headerlink" title="å•Ÿç”¨Email Routingè¨­ç½®"></a>å•Ÿç”¨Email Routingè¨­ç½®</h3><p>å•Ÿç”¨Email Routingè¨­ç½®ï¼Œè¨­ç½®Catch-Allæ””æˆªæ‰€æœ‰éƒµä»¶åœ°å€ï¼Œä¸¦è½‰ç™¼çµ¦æŒ‡å®šé›»å­éƒµä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%205.png" alt="image.png"></p><p>é»é¸Editç·¨è¼¯è¨­ç½®æ””æˆªæ‰€æœ‰éƒµä»¶çš„è¡Œç‚ºèˆ‡ç›®çš„åœ°</p><p>é€™é‚Šæˆ‘å€‘å°±é¸æ“‡ Send to an email å¯„é€éƒµä»¶åˆ°æˆ‘å€‘å‰›æ‰è¨­ç½®çš„è½‰ç™¼åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%206.png" alt="image.png"></p><aside>ğŸ’¡<p>åˆ°é€™æ­¥é©Ÿæˆ‘å€‘å°±èƒ½è®“åªè¦æ˜¯ç™¼é€åˆ° @hairybear.me çš„ä¿¡ä»¶ï¼Œéƒ½æœƒè¢«è½‰ç™¼åˆ°æˆ‘è‡ªå·±çš„Gmailä¿¡ç®±ä¸­</p></aside><h3 id="Gmailæ¥æ”¶è€…è¨­å®šè½‰ç™¼å°è±¡èˆ‡æ¢ä»¶"><a href="#Gmailæ¥æ”¶è€…è¨­å®šè½‰ç™¼å°è±¡èˆ‡æ¢ä»¶" class="headerlink" title="Gmailæ¥æ”¶è€…è¨­å®šè½‰ç™¼å°è±¡èˆ‡æ¢ä»¶"></a>Gmailæ¥æ”¶è€…è¨­å®šè½‰ç™¼å°è±¡èˆ‡æ¢ä»¶</h3><p>å¦‚æœæƒ³è®“åœ˜éšŠæˆå“¡éƒ½å¯ä»¥ä¸€èµ·æ¸¬è©¦ä¿¡ä»¶è¨»å†Šé©—è­‰ä¿¡ã€é‚€è«‹ä¿¡ç­‰æ©Ÿåˆ¶æˆ–è€…å¤šè§’è‰²ç­‰åŠŸèƒ½ï¼Œå¯ä»¥é€éGmailè½‰ç™¼æ©Ÿåˆ¶çµ¦å…¶ä»–äºº</p><p>é¦–å…ˆéœ€è¦å»è¨­å®š â‡’ è½‰å¯„å’ŒPOP/IMAPä¾†æ–°å¢è½‰å¯„çš„åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%207.png" alt="image.png"></p><p>æ–°å¢å¾Œéœ€è¦è®“æ¥æ”¶çš„ä¿¡ç®±åšé©—è­‰</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%208.png" alt="image.png"></p><p>ç¢ºèªæ˜¯å¦å…è¨±æ¥æ”¶ä¾†è‡ªXXXçš„è‡ªå‹•éƒµä»¶è½‰å¯„</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%209.png" alt="image.png"></p><p>æ¥çºŒä¾†å»ºæ§‹ä¿¡ä»¶ç¯©é¸å™¨ï¼Œè¨­ç½®æˆ‘å€‘æƒ³è¦è½‰å¯„çš„éƒµä»¶è¦å‰‡</p><p>é€™é‚Šæ”¶ä»¶äººå°±å¯ä»¥å¡«å¯« <code>@&lt;ä½ çš„åŸŸå&gt;</code></p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%2010.png" alt="image.png"></p><p>å‹¾é¸ â€œè½‰å¯„çµ¦â€ é¸é …ï¼Œä¸¦é¸æ“‡é›»å­éƒµä»¶åœ°å€</p><p>æ¥è‘—å°±å»ºç«‹ç¯©é¸å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%2011.png" alt="image.png"></p><p>å¦‚æ­¤æˆ‘å€‘åœ¨è¨­å®šçš„â‡’ ç¯©é¸å™¨å’Œå°é–çš„åœ°å€ å°±å¯ä»¥çœ‹åˆ°é€™é …è¨­å®šè¦å‰‡äº†</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%2012.png" alt="image.png"></p><p>æ¥è‘—ä¾†ç”¨ç¬¬ä¸‰å€‹å¸³è™Ÿä¾†æ¨¡æ“¬ç³»çµ±è½‰ç™¼éƒµä»¶ï¼Œæ¸¬è©¦ä¸€ä¸‹èƒ½ä¸èƒ½æˆåŠŸè½‰å¯„çµ¦å¤§å®¶</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%2013.png" alt="image.png"></p><p>ç¬¬ä¸‰å€‹å¸³è™ŸæˆåŠŸæ”¶åˆ°ä¿¡ä»¶å•¦ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-email-routing/image%2014.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> DNS </tag>
            
            <tag> Cloudflare </tag>
            
            <tag> Email Routing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢å‘å°å‘ç¨‹å¼è¨­è¨ˆ(AOP)æ¦‚å¿µ èˆ‡ AspectJ å¯¦ä½œ</title>
      <link href="/posts/%E9%9D%A2%E5%90%91%E5%B0%8E%E5%90%91%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88(AOP)%E6%A6%82%E5%BF%B5%20%E8%88%87%20AspectJ%20%E5%AF%A6%E4%BD%9C/"/>
      <url>/posts/%E9%9D%A2%E5%90%91%E5%B0%8E%E5%90%91%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88(AOP)%E6%A6%82%E5%BF%B5%20%E8%88%87%20AspectJ%20%E5%AF%A6%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼ˆOOPï¼‰ä¸­ï¼Œç³»çµ±çš„åŠŸèƒ½è¢«åˆ†æ•£åˆ°å¤šå€‹é¡åˆ¥æˆ–ç‰©ä»¶ä¸­ï¼Œä¾‹å¦‚æ—¥èªŒè¨˜éŒ„ã€æ¬Šé™é©—è­‰ã€å®‰å…¨æ€§ç­‰æ–¹é¢çš„ç¨‹å¼ç¢¼æœƒæ•£ä½ˆåœ¨ä¸åŒçš„é¡å’Œæ–¹æ³•ä¸­ï¼Œå°è‡´ç¨‹å¼ç¢¼çš„é‡è¤‡æ€§å’Œé›£ä»¥ç¶­è­·æ€§å¢åŠ ã€‚ AOPçš„ç›®æ¨™æ˜¯é€šéæå–é€™äº›æ©«åˆ‡é—œæ³¨é»ï¼Œä¸¦å°‡å®ƒå€‘æ¨¡çµ„åŒ–ï¼Œå¾è€Œæé«˜ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€å¯ç¶­è­·æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p><h2 id="AOPä»‹ç´¹"><a href="#AOPä»‹ç´¹" class="headerlink" title="AOPä»‹ç´¹"></a>AOPä»‹ç´¹</h2><h3 id="AOPæ¦‚å¿µ"><a href="#AOPæ¦‚å¿µ" class="headerlink" title="AOPæ¦‚å¿µ"></a>AOPæ¦‚å¿µ</h3><p>ç°¡å–®ä¾†èªªï¼Œé¢å‘å°å‘ç¨‹å¼è¨­è¨ˆ(Aspect-oriented programming, AOP)æ˜¯<strong>æ ¹æ“šå°ˆæ¡ˆç¨‹å¼ä¸­æƒ³è¦ä»‹å…¥çš„åœ°æ–¹é€²è¡Œè¡Œç‚ºæ“ä½œ</strong>ã€‚</p><p>å¦‚ä¸‹åœ–ç¯„ä¾‹ï¼Œæƒ³å°Method A B CåŸ·è¡Œå‰éƒ½å…ˆé€²è¡Œæ¬Šé™é©—è­‰è¡Œç‚ºï¼ŒåŸ·è¡Œå¾Œéƒ½é€²è¡Œæ—¥èªŒç´€éŒ„è¡Œç‚ºã€‚è€ŒåŸæœ¬å¯«æ³•ä¸Šè¦åˆ°æ¯å€‹å‡½å¼å®£å‘Šçš„åœ°æ–¹æ’å…¥æ’°å¯«çš„å…§å®¹ã€‚AOPå‰‡æ”¹ç‚ºåœ¨å–®å€‹é¢å‘ç¨‹å¼ç¢¼ä¸­å¯«é€™å¹¾å€‹Methodæ˜¯åˆ‡å…¥é»ï¼Œè¦åœ¨åŸ·è¡Œå‰åŠ å…¥é€™é …åŠŸèƒ½è¡Œç‚ºã€‚ä¾†é”æˆçµ±ä¸€ç®¡ç†ä»¥åŠæ¨¡çµ„åŒ–çš„æ•ˆç”¨</p><p>æ›å€‹æƒ…å¢ƒæ€è€ƒï¼Œè‹¥åŸå…ˆçš„å¯«æ³•ä¸Šå› ç‚ºé©—è­‰ç›¸é—œçš„é¡åˆ¥èˆ‡æ–¹æ³•æœ‰æ›´æ–°ï¼Œè€Œå°è‡´æ¯å€‹å¼•ç”¨çš„éƒ¨åˆ†çš†é ˆå¾®èª¿ä¿®æ­£ï¼Œé‚£æ˜¯ä¸æ˜¯æœƒé ­ç—›å‘¢<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-1.jpg" alt="Untitled"></p><h3 id="AOPè¡“èª"><a href="#AOPè¡“èª" class="headerlink" title="AOPè¡“èª"></a>AOPè¡“èª</h3><p>åœ¨AOPä¸­æœ‰ä»¥ä¸‹å¸¸ç”¨çš„è¡“èªï¼š</p><ul><li><p>é¢å‘é€£çµé» (joinpoint)<br>  é€£çµé»ç‚ºåœ¨é¢å‘ä¸­éœ€è¦é—œæ³¨çš„é»ï¼Œå¦‚ä»¥ä¸‹ï¼š</p><ol><li>å‘¼å«æ–¹æ³•æˆ–å»ºæ§‹å­ (A method or constructor call)</li><li>æ–¹æ³•èˆ‡å»ºæ§‹å­çš„åŸ·è¡Œ (The execution of a method or constructor)</li><li>è®Šæ•¸æ¬„ä½çš„è¨ªå•æˆ–æ›´æ–° (The accessing or updating of a field)</li><li>ç•°å¸¸è™•ç† (The handling of an exception)</li><li>é¡åˆ¥èˆ‡ç‰©ä»¶çš„åˆå§‹åŒ– (The initialization of a class or object)</li></ol><p>  å…¶å¯¦å°±æ˜¯é¢å‘ä¸­æ“ä½œæ™‚å¯ä»¥ä»‹å…¥çš„é»ï¼Œä¸Šè¿°çš„é—œæ³¨é»å¯ä»¥å¦‚ä»¥ä¸‹ç”¨æ³•ï¼š</p><ol><li>åœ¨æŸå€‹å‡½å¼åŸ·è¡Œå‰ï¼Œè¦å…ˆåŸ·è¡Œæ¬Šé™é©—è­‰åŠŸèƒ½ï¼Œç¢ºå®šä½¿ç”¨è€…æœ‰ç„¡æ¬Šé™</li><li>æŸå€‹è®Šæ•¸è¢«è³¦å€¼æ›´æ–°å…§å®¹å¾Œï¼Œè¦åŸ·è¡Œé‡æ–°æ¸²æŸ“ï¼Œè®“ç•«é¢åŒæ­¥</li><li>ç•¶ç™¼ç”Ÿç•°å¸¸æ™‚ï¼ŒåŸ·è¡Œæ—¥èªŒç´€éŒ„</li><li>ç•¶æŸå€‹ç‰©ä»¶åˆå§‹åŒ–å‰ï¼ŒåŸ·è¡Œæª¢æŸ¥è³‡æ–™æœ‰ç„¡è¨­å®šå®Œå–„</li></ol><p>  å…·é¡Œæ’°å¯«æ ¼å¼å¦‚ä¸‹ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">call ( void Foo.m(int) )</span><br><span class="line">call ( Foo.new(..) )</span><br><span class="line">execution ( * Foo.*(..) throws IOException )</span><br><span class="line">execution ( !public Foo.new(..) )</span><br><span class="line">initialization ( Foo.new(int) )</span><br><span class="line">within ( com.bigboxco.* )</span><br><span class="line">args ( *, int )</span><br></pre></td></tr></table></figure>  <div class="note info flat"><p>ğŸ’¡å¯ä»¥ç™¼ç¾callã€executionã€initializationç­‰ç‚ºä¸åŒçš„é€£æ¥æ–¹æ³•<br>æ‹¬å¼§è£¡é¢æ ¼å¼é€šå¸¸ç‚º (å›å‚³å‹åˆ¥ é¡åˆ¥æ–¹æ³•(åƒæ•¸))<br>ä¸Šè¿°ç¯„ä¾‹ä¸­*æ˜Ÿå­—è™Ÿä»£è¡¨ä¸é™åˆ¶ï¼Œäº¦å³çš†å¯<br>..ç¬¦è™Ÿå‰‡è¡¨ç¤ºä¸ç®¡å…§å®¹ç‚ºä½•çš†å¯</p></div><p>  å› æ­¤ï¼Œä¸Šè¿°ç¯„ä¾‹çš„joinpointå¯ä»¥ç‚º</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call(void Foo.MethodA())</span><br><span class="line">call(int Bar.MethodB())</span><br><span class="line">call(void Bear.MethodC(int))</span><br></pre></td></tr></table></figure></li><li><p>é¢å‘åˆ‡å…¥é» (pointcut)</p><p>  é¸æ“‡é¢å‘é€£çµé»çš„æ–¹å¼/è¦å‰‡ï¼Œä»£è¡¨è©²é‚è¼¯é¢å‘ç‚ºä¸€ç¨®åˆ‡å…¥é»ï¼Œå¯ä»¥ç•¶ä½œåˆ‡å…¥é»æ˜¯ä¸€å€‹è©²é¢å‘åˆ‡å…¥çš„ç¨±å‘¼</p><p>  ä¾‹å¦‚ä¸Šè¿°ä¸­æˆ‘å€‘å¯ä»¥å®šç¾©æ¬Šé™é©—è­‰çš„åˆ‡å…¥é»ç‚ºä»¥ä¸‹ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pointcut auth():</span><br><span class="line">call(void Foo.MethodA()) ||</span><br><span class="line">call(int Bar.MethodB())  ||</span><br><span class="line">call(void Bear.MethodC(int))</span><br></pre></td></tr></table></figure><p>  å¯ä»¥çœ‹åˆ°æˆ‘å€‘å°‡åˆ‡å…¥é»å–åç‚ºauthï¼Œå…¶è¦å‰‡ç‚ºä»»ä¸€åŸ·è¡ŒæŒ‡å®šé¡åˆ¥æ–¹æ³•å³ç¬¦åˆæ¢ä»¶ï¼Œå…¶ä¸­æ¡ç”¨ || æˆ–è€…çš„ç¬¦è™Ÿè™•ç†</p></li><li><p>é¢å‘åˆ‡å…¥è¡Œç‚º (advice)</p><p>  å¸Œæœ›åœ¨åˆ‡å…¥é»é€²è¡Œçš„æ“ä½œæ–¹å¼ï¼Œä¾‹å¦‚åœ¨åˆ‡å…¥é»å‰å¾Œå¢åŠ åŠŸèƒ½ï¼Œæˆ–è€…æ”¹å¯«åˆ‡å…¥é»çš„å…§å®¹</p><ol><li>Beforeï¼šæ–¼æŒ‡å®šåˆ‡å…¥é»å‰åŠ å…¥è¡Œç‚º</li><li>Afterï¼šæ–¼æŒ‡å®šåˆ‡å…¥é»å¾ŒåŠ å…¥è¡Œç‚º</li><li>Aroundï¼šæ–¼æŒ‡å®šåˆ‡å…¥é»è¦†å¯«è¡Œç‚º</li></ol></li><li><p>é¢å‘ç·¨ç¹”å™¨ (aspect weaver)</p><p>  è² è²¬åœ¨ç·¨è­¯æ™‚æœŸå°‡é¢å‘ç¨‹å¼ç¢¼æ‰€å®šç¾©ä¹‹å…§å®¹ä½µå…¥ç³»çµ±ä¸­ï¼Œå› æ­¤ç·¨è­¯å¾Œçš„byte codeä¸­æœƒå°‡åˆ‡å…¥è¡Œç‚ºæ³¨å…¥è‡³åˆ‡å…¥é»ä¸­ã€‚è‹¥æˆ‘å€‘é€éåç·¨è­¯æ–¹å¼æŸ¥çœ‹ç¨‹å¼ç¢¼ï¼Œæ˜¯å¯ä»¥å¾ˆæ˜é¡¯åœ°çœ‹åˆ°ã€‚</p></li></ul><h3 id="AOPç‰¹æ€§èˆ‡å„ªé»"><a href="#AOPç‰¹æ€§èˆ‡å„ªé»" class="headerlink" title="AOPç‰¹æ€§èˆ‡å„ªé»"></a>AOPç‰¹æ€§èˆ‡å„ªé»</h3><ul><li>å…è¨±ä¸ä¿®æ”¹åŸç¨‹å¼ç¢¼æƒ…æ³ä¸‹æ·»å¢è¡Œç‚º</li><li>æé«˜æ¨¡çµ„åŒ–ç¨‹åº¦èˆ‡ç¶­è­·æ€§</li><li>æ•ˆèƒ½æ–¹é¢èˆ‡å‚³çµ±æ’°å¯«æ–¹å¼å¹¾ä¹ç›¸åŒ</li></ul><h2 id="Mavenä»‹ç´¹"><a href="#Mavenä»‹ç´¹" class="headerlink" title="Mavenä»‹ç´¹"></a>Mavenä»‹ç´¹</h2><h3 id="Mavenæ¦‚å¿µ"><a href="#Mavenæ¦‚å¿µ" class="headerlink" title="Mavenæ¦‚å¿µ"></a>Mavenæ¦‚å¿µ</h3><p>Mavenæ˜¯ä¸€å€‹åŸºæ–¼Javaçš„å°ˆæ¡ˆç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¹«åŠ©é–‹ç™¼äººå“¡è‡ªå‹•åŒ–å»ºæ§‹ã€ç™¼å¸ƒå’Œç®¡ç†Javaå°ˆæ¡ˆã€‚Mavenä½¿ç”¨ä¸€å€‹ç¨±ç‚ºPOMï¼ˆProject Object Modelï¼‰çš„XMLæª”æ¡ˆä¾†æè¿°å°ˆæ¡ˆçš„çµæ§‹ã€ç›¸ä¾é—œä¿‚å’Œå»ºæ§‹éç¨‹ã€‚POMæª”æ¡ˆåŒ…å«å°ˆæ¡ˆçš„metadataï¼Œä¾‹å¦‚å°ˆæ¡ˆåç¨±ã€ç‰ˆæœ¬è™Ÿã€ä½œè€…ç­‰ï¼ŒåŒæ™‚ä¹Ÿå®šç¾©äº†å°ˆæ¡ˆçš„ç›¸ä¾é—œä¿‚ã€å»ºæ§‹ç›®æ¨™å’Œæ’ä»¶é…ç½®ç­‰è³‡è¨Šã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›Mavençš„é‡è¦æ¦‚å¿µï¼š</p><ol><li>POMï¼ˆProject Object Modelï¼‰ï¼šPOMæ˜¯Mavenå°ˆæ¡ˆçš„æ ¸å¿ƒæª”æ¡ˆï¼Œæè¿°äº†å°ˆæ¡ˆçš„çµæ§‹ã€ç›¸ä¾é—œä¿‚å’Œå»ºæ§‹éç¨‹ã€‚POMæª”æ¡ˆä½æ–¼å°ˆæ¡ˆçš„æ ¹ç›®éŒ„ä¸‹ï¼Œä½¿ç”¨XMLæ ¼å¼é€²è¡Œç·¨å¯«ã€‚</li><li>ä¾è³´ç®¡ç†ï¼šMavené€éPOMæª”æ¡ˆä¸­çš„ç›¸ä¾é…ç½®ä¾†ç®¡ç†å°ˆæ¡ˆçš„ç›¸ä¾é—œä¿‚ã€‚é–‹ç™¼äººå“¡å¯ä»¥æŒ‡å®šå°ˆæ¡ˆæ‰€ä¾è³´çš„å¤–éƒ¨å‡½å¼åº«æˆ–æ¨¡çµ„ï¼ŒMavenæœƒè‡ªå‹•ä¸‹è¼‰é€™äº›ç›¸ä¾é …ç›®ä¸¦å°‡å…¶åŠ å…¥å°ˆæ¡ˆçš„å»ºæ§‹è·¯å¾‘ä¸­ã€‚</li><li>å»ºæ§‹ç”Ÿå‘½é€±æœŸ(Lifecycle)ï¼šMavenå®šç¾©äº†ä¸€çµ„æ¨™æº–çš„å»ºæ§‹ç”Ÿå‘½é€±æœŸï¼ŒåŒ…æ‹¬cleanã€compileã€testã€packageã€installå’Œdeployç­‰éšæ®µã€‚é–‹ç™¼äººå“¡å¯ä»¥åœ¨POMæª”æ¡ˆä¸­é…ç½®é€™äº›ç”Ÿå‘½é€±æœŸéšæ®µè¦åŸ·è¡Œçš„æ“ä½œï¼Œä»¥å¯¦ç¾å°ˆæ¡ˆçš„å»ºæ§‹ã€æ¸¬è©¦å’Œéƒ¨ç½²ç­‰ä»»å‹™ã€‚</li><li>æ’ä»¶ï¼šMavenæ”¯æ´å¤–æ›ç¨‹å¼æ©Ÿåˆ¶ï¼Œé–‹ç™¼äººå“¡å¯ä»¥é€éå¤–æ›ç¨‹å¼æ“´å±•å’Œå®¢è£½åŒ–å°ˆæ¡ˆçš„å»ºæ§‹éç¨‹ã€‚å¤–æ›ç¨‹å¼å¯ä»¥åœ¨å»ºæ§‹ç”Ÿå‘½é€±æœŸçš„ä¸åŒéšæ®µåŸ·è¡Œç‰¹å®šçš„ä»»å‹™ï¼Œä¾‹å¦‚ç¨‹å¼ç¢¼éœæ…‹åˆ†æã€å–®å…ƒæ¸¬è©¦ã€æ‰“åŒ…ç­‰ã€‚</li><li>å€‰åº«ï¼ˆRepositoryï¼‰ï¼šMavenä½¿ç”¨å€‰åº«ä¾†å­˜å„²å’Œç®¡ç†ç›¸ä¾å‡½å¼åº«å’Œå»ºæ§‹æˆæœã€‚æœ‰å…©ç¨®é¡å‹çš„å€‰åº«ï¼šæœ¬åœ°å€‰åº«ï¼ˆLocal Repositoryï¼‰å’Œé ç«¯å€‰åº«ï¼ˆRemote Repositoryï¼‰ã€‚æœ¬åœ°å€‰åº«ä½æ–¼æœ¬åœ°é–‹ç™¼æ©Ÿå™¨ä¸Šï¼Œç”¨æ–¼å¿«å–ä¸‹è¼‰çš„ç›¸ä¾é …ç›®å’Œå»ºæ§‹æˆæœã€‚é ç«¯å€‰åº«æ˜¯åˆ†ä½ˆå¼çš„ï¼Œå¯ä»¥æ˜¯å…¬å…±çš„ä¸­å¤®å€‰åº«æˆ–ç§æœ‰çš„è‡ªè¨‚å€‰åº«ï¼Œç”¨æ–¼åˆ†äº«å’Œç²å–ç›¸ä¾é …ç›®ã€‚</li></ol><p>é€éä½¿ç”¨Mavenï¼Œé–‹ç™¼äººå“¡å¯ä»¥ç°¡åŒ–å°ˆæ¡ˆçš„å»ºæ§‹éç¨‹ï¼Œè‡ªå‹•ç®¡ç†ç›¸ä¾é—œä¿‚ï¼Œæé«˜å°ˆæ¡ˆçš„å¯ç¶­è­·æ€§å’Œå¯é‡è¤‡ä½¿ç”¨æ€§ã€‚æ­¤å¤–ï¼ŒMavené‚„æä¾›äº†è¨±å¤šå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚å°ˆæ¡ˆå ±å‘Šã€ç¨‹å¼ç¢¼æª¢æŸ¥ã€æ–‡ä»¶ç”Ÿæˆç­‰ï¼Œé€²ä¸€æ­¥æå‡é–‹ç™¼æ•ˆç‡å’Œå°ˆæ¡ˆå“è³ªã€‚</p><h3 id="Mavenå°ˆæ¡ˆçµæ§‹"><a href="#Mavenå°ˆæ¡ˆçµæ§‹" class="headerlink" title="Mavenå°ˆæ¡ˆçµæ§‹"></a>Mavenå°ˆæ¡ˆçµæ§‹</h3><p>ä»¥ä¸‹ç‚ºå°ˆæ¡ˆçš„çµæ§‹</p><ol><li>åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾æ ¹ç›®éŒ„å¿…å®šè¦æœ‰pom.xmlæª”æ¡ˆ</li><li>srcç‚ºæ’°å¯«åŸå§‹ç¢¼çš„ç›®éŒ„<ol><li>mainç‚ºä¸»è¦ç¨‹å¼æ’°å¯«å€åŸŸ</li><li>testç‚ºæ¸¬è©¦æ¡ˆä¾‹æ’°å¯«çš„å€åŸŸ</li></ol></li><li>targetç‚ºç·¨è­¯å¾Œç”¢ç”Ÿbytecodeèˆ‡ç›¸é—œå ±å‘Šçš„ä½ç½®</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">`-- src</span><br><span class="line">|   |-- main</span><br><span class="line">|   |   `-- java</span><br><span class="line">|   |       `-- com</span><br><span class="line">|   |           `-- mycompany</span><br><span class="line">|   |               `-- app</span><br><span class="line">|   |                   `-- App.java</span><br><span class="line">|   `-- <span class="built_in">test</span></span><br><span class="line">|       `-- java</span><br><span class="line">|           `-- com</span><br><span class="line">|               `-- mycompany</span><br><span class="line">|                   `-- app</span><br><span class="line">|                       `-- AppTest.java</span><br><span class="line">` -- target</span><br></pre></td></tr></table></figure><h3 id="Maven-POMçµæ§‹"><a href="#Maven-POMçµæ§‹" class="headerlink" title="Maven POMçµæ§‹"></a>Maven POMçµæ§‹</h3><p>pom.xmlæ¡ç”¨æ¨™ç±¤å½¢å¼æ’°å¯«ï¼Œprojectæ¨™ç±¤åŒ…å«pomæ•´é«”å…§å®¹ï¼Œå…¶å…§å®¹å¯åŠƒåˆ†å¹¾å€‹å€åŸŸï¼š</p><ol><li>å°ˆæ¡ˆè³‡è¨Š groupIdæ¨™ç±¤ä¸»è¦æ˜¯å®šç¾©è©²å°ˆæ¡ˆæ‰€å±¬çš„çµ„ç¹”ï¼Œè‹¥ä»¥å¾Œç™¼ä½ˆçµ¦ä»–äººä½¿ç”¨ï¼Œä»–äººåœ¨å¼•ç”¨å®£å‘Šæ™‚å°‡ä¾å¾ªgroupIdçš„åç¨±ä½¿ç”¨ artifactIdç‚ºå®šç¾©å°ˆæ¡ˆçš„IDï¼Œå°±æ˜¯å°ˆæ¡ˆçš„å”¯ä¸€è¾¨åˆ¥æ–¹æ³•ï¼Œå¾ŒçºŒç™¼ä½ˆè‡³å…¬é–‹çš„å„²å­˜åº«ä¸­å¯ä»¥è¾¨åˆ¥</li><li>å°ˆæ¡ˆå±¬æ€§ propertiesæ¨™ç±¤å€åŸŸä¸»è¦ç´€éŒ„å°ˆæ¡ˆä½¿ç”¨çš„å­—æºç·¨ç¢¼èˆ‡ç·¨è­¯ç‰ˆæœ¬ ä»¥ä¸‹ç¯„ä¾‹æ¡ç”¨UTF-8ä»¥åŠJava 7ç‰ˆæœ¬</li><li>ä¾è³´å¥—ä»¶ åœ¨dependenciesæ¨™ç±¤å€åŸŸå…§æ’°å¯«ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œå¦‚ä»¥ä¸‹ç¯„ä¾‹æ¡ç”¨äº†junitå–®å…ƒæ¸¬è©¦å¥—ä»¶ å…¶ä¸­æ¯å€‹ä¾è³´å¥—ä»¶éœ€è¦ä»¥dependencyæ¨™ç±¤å®£å‘Šï¼ŒgroupIdã€artifactIdã€versionå‰‡æ˜¯å®šç¾©å°ˆæ¡ˆéœ€è¦çš„å¥—ä»¶ç‚ºä½•èˆ‡ç‰ˆæœ¬ <div class="note info flat"><p>ğŸ’¡ä¸€èˆ¬å¼•ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶å¯æ–¼mvn repositoryç¶²ç«™æ‰¾åˆ°éœ€è¦çš„å¥—ä»¶ï¼Œå…¶ä¸­å¼•ç”¨çš„å…§å®¹è³‡è¨Šä¹Ÿæœƒæä¾›</p></div></li><li>å»ºæ§‹è³‡è¨Š &amp; æ’ä»¶ç®¡ç† buildæ¨™ç±¤å€åŸŸä¸»è¦ç‚ºæœ‰é—œå°ˆæ¡ˆå»ºæ§‹çš„è³‡è¨Šï¼Œä¹Ÿå°±æ˜¯è·Ÿç”Ÿå‘½é€±æœŸç›¸é—œçš„å…§å®¹ å…¶ä¸­é€épluginManagementå¯ä»¥æ“´å……ä»¥åŠæ§åˆ¶ç”Ÿå‘½é€±æœŸæŒ‡ä»¤éœ€é€²è¡Œçš„äº‹é … æ·»å¢æ’ä»¶æ–¹æ³•èˆ‡ä¾è³´å¥—ä»¶æ¦‚å¿µç›¸ä¼¼ï¼Œæ–¼pluginsæ¨™ç±¤å€åŸŸæ·»åŠ pluginæ¨™ç±¤</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mycompany.app<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- FIXME change it to the project&#x27;s website --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="MavenæŒ‡ä»¤"><a href="#MavenæŒ‡ä»¤" class="headerlink" title="MavenæŒ‡ä»¤"></a>MavenæŒ‡ä»¤</h3><p>åœ¨ä¸Šè¿°ä»‹ç´¹ä¸­æåˆ°ç”Ÿå‘½é€±æœŸçš„æµç¨‹ï¼Œå…¶ä¸­å¸¸è¦‹çš„æŒ‡ä»¤ä¹Ÿèˆ‡ç”Ÿå‘½é€±æœŸç›¸é—œï¼Œè€Œé€™äº›çš„æŒ‡ä»¤æ“ä½œæ˜¯å¦å¯è¡Œä»¥åŠåŸ·è¡Œå…§å®¹ä¹Ÿèˆ‡æ’ä»¶æœ‰é—œé€£æ€§ã€‚</p><ul><li>å°ˆæ¡ˆç¯„æœ¬ mvn archetype:generate</li><li>ç·¨è­¯ mvn compile</li><li>å®‰è£ mvn install</li><li>åŸ·è¡Œ mvn exec</li><li>æ¸¬è©¦ mvn test</li><li>æ‰“åŒ… mvn package</li></ul><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>Java 11ç’°å¢ƒå®‰è£</li><li>Mavenå®‰è£</li></ul></li><li>å»ºç«‹Mavenå°ˆæ¡ˆ èˆ‡ AspectJå¥—ä»¶ä¾è³´è¨­ç½®<ul><li>ç¯„æœ¬å½¢å¼å»ºç«‹Mavenå°ˆæ¡ˆ</li><li>pom.xml åŸ·è¡ŒæŒ‡ä»¤è¨­ç½®</li><li>AspectJ - pom.xmlè¨­ç½®</li></ul></li><li>é¢å‘ç¨‹å¼ç¢¼å¯¦ä½œ<ul><li>é å‚™ç¯„ä¾‹åˆ‡å…¥é»å°è±¡</li><li>é¢å‘å®£å‘Š</li><li>åˆ‡å…¥é»å®£å‘Šèˆ‡è¡Œç‚ºæ’°å¯«</li><li>å¤šå€‹é€£æ¥é»ç‚ºåˆ‡å…¥é»</li></ul></li><li>AspectJæ”¯æ´çš„ç›¸é—œè³‡è¨Š<ul><li>Pointcutå½¢å¼</li><li>Adivceé¡å‹</li></ul></li><li>Around Adviceé‹ç”¨æ–¹æ³•<ul><li>ProceedingJoinPointæ”¯æ´å–å¾—åˆ‡å…¥é»è³‡è¨Š</li></ul></li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><p>æ¥çºŒå¯¦ä½œä¸Šæ¡ç”¨Windowsä½œæ¥­ç³»çµ±ã€Java 11ã€Mavenç‚ºç’°å¢ƒ</p><h3 id="Java-11ç’°å¢ƒå®‰è£"><a href="#Java-11ç’°å¢ƒå®‰è£" class="headerlink" title="Java 11ç’°å¢ƒå®‰è£"></a>Java 11ç’°å¢ƒå®‰è£</h3><p>åˆ°<a href="https://www.oracle.com/tw/java/technologies/javase/jdk11-archive-downloads.html">Java Archive Downloads - Java SE 11 | Oracle å°ç£</a> JAVA JDK 11ç¶²ç«™é¸æ“‡ä¸‹è¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-2.jpg" alt="Untitled"></p><p>å®‰è£å¾Œï¼Œå…¶å®‰è£å…§å®¹æ‡‰è©²æœƒåœ¨C:\Program Files\Java\jdk-11.x.x</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-3.jpg" alt="Untitled"></p><ul><li><p>å‰å¾€ç’°å¢ƒè®Šæ•¸è¨­ç½®é é¢</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-4.jpg" alt="Untitled"></p></li><li><p>è¨­å®šç’°å¢ƒè®Šæ•¸</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-5.jpg" alt="Untitled"></p></li><li><p>è¨­å®šJAVA_HOMEç’°å¢ƒè®Šæ•¸</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-6.jpg" alt="Untitled"></p></li><li><p>æ¸¬è©¦æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line">javac -version</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-7.jpg" alt="Untitled"></p></li></ul><h3 id="Mavenå®‰è£"><a href="#Mavenå®‰è£" class="headerlink" title="Mavenå®‰è£"></a>Mavenå®‰è£</h3><p><a href="https://maven.apache.org/download.cgi">Maven â€“ Download Apache Maven</a></p><ul><li><p>ä¸‹è¼‰Maven</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-8.jpg" alt="Untitled"></p></li><li><p>è§£å£“ç¸®è‡³Cç£ç¢Ÿ</p></li><li><p>è¨­å®šç’°å¢ƒè®Šæ•¸</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-9.jpg" alt="Untitled"></p></li><li><p>æ¸¬è©¦æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/aop-10.jpg" alt="Untitled"></p></li></ul><h2 id="å»ºç«‹Mavenå°ˆæ¡ˆ-èˆ‡-AspectJå¥—ä»¶ä¾è³´è¨­ç½®"><a href="#å»ºç«‹Mavenå°ˆæ¡ˆ-èˆ‡-AspectJå¥—ä»¶ä¾è³´è¨­ç½®" class="headerlink" title="å»ºç«‹Mavenå°ˆæ¡ˆ èˆ‡ AspectJå¥—ä»¶ä¾è³´è¨­ç½®"></a>å»ºç«‹Mavenå°ˆæ¡ˆ èˆ‡ AspectJå¥—ä»¶ä¾è³´è¨­ç½®</h2><h3 id="ç¯„æœ¬å½¢å¼å»ºç«‹Mavenå°ˆæ¡ˆ"><a href="#ç¯„æœ¬å½¢å¼å»ºç«‹Mavenå°ˆæ¡ˆ" class="headerlink" title="ç¯„æœ¬å½¢å¼å»ºç«‹Mavenå°ˆæ¡ˆ"></a>ç¯„æœ¬å½¢å¼å»ºç«‹Mavenå°ˆæ¡ˆ</h3><p>mavenæä¾›ä¾¿æ·çš„æŒ‡ä»¤å¯ä»¥å»ºæ§‹å°ˆæ¡ˆç¯„æœ¬ï¼Œå…¶ä¸­ç”šè‡³å¯ä»¥æŒ‡å®šå°ˆæ¡ˆçš„é¡å‹éœ€æ±‚</p><p>æœ¬æ¬¡å¯¦ä½œåƒ…éœ€ä¸€èˆ¬çš„å³å¯ï¼Œä½¿ç”¨å®˜æ–¹å»ºè­°çš„å¿«é€Ÿå…¥é–€ç¯„æœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DinteractiveMode=<span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡åƒæ•¸èªªæ˜<br>-DgroupIdï¼šä½ å»ºç«‹çš„å°ˆæ¡ˆæ‰€å±¬çš„çµ„ç¹”<br>-DartifactIdï¼šä½ å»ºç«‹çš„å°ˆæ¡ˆID<br>-DarchetypeArtifactIdï¼šæŒ‡å®šçš„ç¯„æœ¬ID<br>-DarchetypeVersionï¼šç¯„æœ¬çš„ç‰ˆæœ¬ï¼Œè¦çœ‹ç¯„æœ¬æ”¯æ´åˆ°å“ªä¸€ç‰ˆ<br>-DinteractiveModeï¼šæ˜¯å¦å•Ÿç”¨äº’å‹•æ¨¡å¼</p></div><h3 id="pom-xml-åŸ·è¡ŒæŒ‡ä»¤è¨­ç½®"><a href="#pom-xml-åŸ·è¡ŒæŒ‡ä»¤è¨­ç½®" class="headerlink" title="pom.xml åŸ·è¡ŒæŒ‡ä»¤è¨­ç½®"></a>pom.xml åŸ·è¡ŒæŒ‡ä»¤è¨­ç½®</h3><p>è‹¥æ–¼å°ˆæ¡ˆä¸­æ¬²åŸ·è¡Œmainå‡½å¼æœƒç™¼ç”ŸéŒ¯èª¤ï¼ŒåŸå› ç‚ºç›®å‰çš„pomå°šæœªè¨­ç½®åŸ·è¡Œæ–¹æ³•çš„æ’ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn exec:java</span><br></pre></td></tr></table></figure><p>åœ¨pom.xmlæ’ä»¶ç®¡ç†è™•pluginsæ¨™ç±¤å€å…§æ·»å¢ä»¥ä¸‹pluginæ¨™ç±¤æè¿°çš„å€å¡Š</p><p>å…¶ä¸­configurationçš„mainClassæ˜¯å‘Šè¨´maven mainå‡½å¼çš„ä½ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.mycompany.app.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="AspectJ-pom-xmlè¨­ç½®"><a href="#AspectJ-pom-xmlè¨­ç½®" class="headerlink" title="AspectJ - pom.xmlè¨­ç½®"></a>AspectJ - pom.xmlè¨­ç½®</h3><p>åœ¨è¨­ç½®ä¸ŠåŒ…å«ä¾è³´èˆ‡æ’ä»¶è¨­ç½®ï¼Œä¾è³´è¨­ç½®ä¸»è¦ä½¿å¾—åœ¨ç¨‹å¼ç¢¼ä¸­å¯ä»¥ä½¿ç”¨aspectjèªæ³•(joinpointã€pointcutã€advice)ï¼Œæ’ä»¶è¨­ç½®å‰‡ç‚ºç”Ÿå‘½é€±æœŸä¸­ç·¨è­¯æ™‚æœŸéœ€è¦é€²è¡Œç·¨ç¹”å‹•ä½œï¼Œå› æ­¤éœ€è¦è¨­ç½®æ’ä»¶ã€‚</p><ul><li><p>ä¾è³´è¨­ç½®</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ’ä»¶è¨­ç½®</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectj-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">complianceLevel</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">complianceLevel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>test-compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="é¢å‘ç¨‹å¼ç¢¼å¯¦ä½œ"><a href="#é¢å‘ç¨‹å¼ç¢¼å¯¦ä½œ" class="headerlink" title="é¢å‘ç¨‹å¼ç¢¼å¯¦ä½œ"></a>é¢å‘ç¨‹å¼ç¢¼å¯¦ä½œ</h2><h3 id="é å‚™ç¯„ä¾‹åˆ‡å…¥é»å°è±¡"><a href="#é å‚™ç¯„ä¾‹åˆ‡å…¥é»å°è±¡" class="headerlink" title="é å‚™ç¯„ä¾‹åˆ‡å…¥é»å°è±¡"></a>é å‚™ç¯„ä¾‹åˆ‡å…¥é»å°è±¡</h3><p>é¦–å…ˆé¢å‘ç¨‹å¼ç¢¼åŠŸç”¨ç‚ºæ–¼åˆ‡å…¥é»é€²è¡Œè¡Œç‚ºæ“ä½œï¼Œå› æ­¤åœ¨å°ˆæ¡ˆä¸­æˆ‘å€‘å…ˆå®£å‘Šä¸€å€‹å‡½å¼ä½œç‚ºåˆ‡å…¥é»</p><p>å°‡App.javaæ›´æ”¹ç‚ºä»¥ä¸‹å…§å®¹ï¼Œå…¶ä¸­ç¨‹å¼ä¸€åŸ·è¡Œå°±æœƒåŸ·è¡ŒApp.greet()å‡½å¼ï¼Œè¼¸å‡ºHello World!å­—ä¸²</p><p>å¾…æœƒæˆ‘å€‘çš„åˆ‡å…¥é»å°±æ˜¯App.greet()å‡½å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        App app = <span class="keyword">new</span> App();</span><br><span class="line">        app.greet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é¢å‘å®£å‘Š"><a href="#é¢å‘å®£å‘Š" class="headerlink" title="é¢å‘å®£å‘Š"></a>é¢å‘å®£å‘Š</h3><p>ä½¿ç”¨@Aspectæ–¼æŒ‡å®šçš„é¡åˆ¥é¢å‘å®£å‘Šï¼Œå‘Šè¨´AspectJ Weaverç·¨è­¯æ™‚éœ€é€²è¡Œé¢å‘ç›¸é—œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ‡å…¥é»å®£å‘Šèˆ‡è¡Œç‚ºæ’°å¯«"><a href="#åˆ‡å…¥é»å®£å‘Šèˆ‡è¡Œç‚ºæ’°å¯«" class="headerlink" title="åˆ‡å…¥é»å®£å‘Šèˆ‡è¡Œç‚ºæ’°å¯«"></a>åˆ‡å…¥é»å®£å‘Šèˆ‡è¡Œç‚ºæ’°å¯«</h3><p>åœ¨AOPä»‹ç´¹æ™‚ï¼Œæœ‰æåˆ°joinpointæˆ–pointcutçš„å¯«æ³•æ ¼å¼ï¼Œé€™æ¬¡æˆ‘å€‘è¦å°App.greet()å‡½å¼ä½œç‚ºåˆ‡å…¥é»ï¼Œä¸¦ä¸”æ˜¯åœ¨åŸ·è¡ŒApp.greet()å‡½å¼çš„æ™‚é–“é»</p><p>é‚£æˆ‘å€‘çš„joinpointæœƒæ˜¯<code>execution(* com.mycompany.app.App.greet())</code> </p><p>æ¥è‘—æ ¹æ“šæˆ‘å€‘æƒ³è¦ä»‹å…¥çš„æ™‚æ©Ÿé»é€²è¡Œadviceçš„å®£å‘Šï¼Œå¦‚Beforeã€Aroundã€After</p><p>ç¯„ä¾‹å¦‚ä¸‹ï¼š</p><ul><li><p>Before advice</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect- Before!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ç·¨ç¹”ä¸¦åŸ·è¡Œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn aspectj:compile exec:java</span><br></pre></td></tr></table></figure><p>  åŸ·è¡Œçµæœ<br>  Beforeæ˜¯æŒ‡åœ¨åˆ‡å…¥é»å‰æ·»åŠ è¡Œç‚º<br>  å¯ä»¥ç™¼ç¾åŸå…ˆç„¡é¢å‘åˆ‡å…¥é æœŸåªæœ‰è¼¸å‡ºHello World!ï¼Œä½†è—‰ç”±é¢å‘åˆ‡å…¥ï¼ŒæŒ‡å®šåœ¨greetå‡½å¼å‰åŸ·è¡Œæˆ‘å€‘æ·»åŠ çš„è¡Œç‚ºã€‚<br>  å› æ­¤å…ˆè¼¸å‡ºäº†Hello Aspect- Before!</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello Aspect- Before!</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure></li><li><p>Around advice</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Around!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ç·¨ç¹”ä¸¦åŸ·è¡Œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn aspectj:compile exec:java</span><br></pre></td></tr></table></figure><p>  åŸ·è¡Œçµæœ<br>  Aroundç‚ºè¦†å¯«åˆ‡å…¥é»çš„åˆ‡å…¥è¡Œç‚ºadviceï¼Œå› æ­¤åŸ·è¡Œçµæœåªæœ‰åˆ‡å…¥åŸ·è¡Œçš„éƒ¨åˆ†ï¼šHello Aspect - Around!ã€‚<br>  åŸå…ˆçš„Hello World!å‰‡è¢«è¦†å¯«æ‰äº†</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Aspect - Around!</span><br></pre></td></tr></table></figure></li><li><p>after advice</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - After!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ç·¨ç¹”ä¸¦åŸ·è¡Œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn aspectj:compile exec:java</span><br></pre></td></tr></table></figure><p>  åŸ·è¡Œçµæœ<br>  Afteræ˜¯æŒ‡åœ¨åˆ‡å…¥é»å¾Œæ·»åŠ è¡Œç‚º<br>  å¯ä»¥ç™¼ç¾åŸå…ˆç„¡é¢å‘åˆ‡å…¥é æœŸåªæœ‰è¼¸å‡ºHello World!ï¼Œä½†è—‰ç”±é¢å‘åˆ‡å…¥ï¼ŒæŒ‡å®šåœ¨greetå‡½å¼å¾ŒåŸ·è¡Œæˆ‘å€‘æ·»åŠ çš„è¡Œç‚ºã€‚<br>  å› æ­¤å…ˆè¼¸å‡ºäº†Hello Aspect - After!</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">Hello Aspect - After!</span><br></pre></td></tr></table></figure></li><li><p>åˆ‡å…¥é»ç®¡ç†å•é¡Œ</p><p>  è‹¥ä¸‰å€‹adviceéƒ½ä¸€åŒä½¿ç”¨çš„è©±ï¼Œå¦‚ä¸‹ç¨‹å¼ç¢¼</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Before!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Around!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - After!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœƒç™¼ç¾æœ‰ä¸€å€‹ç¼ºé»ï¼Œå…¶å¯¦åˆ‡å…¥é»çš†ç‚ºexecution(* com.mycompany.app.App.greet())ï¼Œé‚£ä½•ä¸çµ±ä¸€ç®¡ç†</p><ul><li>åˆ‡å…¥é»å®šç¾©  æˆ‘å€‘å°‡execution(* com.mycompany.app.App.greet())å–åç‚ºexecuteAppGreet()åˆ‡å…¥é»ï¼Œå¦‚æ­¤åœ¨ä½¿ç”¨æ™‚åªè¦è¼¸å…¥executeAppGreet()å³å¯ï¼Œè€Œåˆ‡å…¥é»æœ‰è®Šå‹•æ™‚åªè¦ä¿®æ­£å®šç¾©çš„åœ°æ–¹  ç¯„ä¾‹å¦‚ä¸‹ï¼š  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeAppGreet</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  å®Œæ•´ç¨‹å¼ç¢¼ï¼š  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeAppGreet</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Before!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Around!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - After!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¤šå€‹é€£æ¥é»ç‚ºåˆ‡å…¥é»"><a href="#å¤šå€‹é€£æ¥é»ç‚ºåˆ‡å…¥é»" class="headerlink" title="å¤šå€‹é€£æ¥é»ç‚ºåˆ‡å…¥é»"></a>å¤šå€‹é€£æ¥é»ç‚ºåˆ‡å…¥é»</h3><p>åœ¨å‰é¢AOPä»‹ç´¹æ™‚æœ‰æåˆ°é€éè¦å‰‡çµ„åˆæ–¹å¼å®šç¾©åˆ‡å…¥é»ï¼Œå…¶ä¸­AspectJåŒ…å«ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li>Notè¦å‰‡ï¼š!</li><li>ORè¦å‰‡ï¼š||</li><li>ANDè¦å‰‡ï¼š&amp;&amp;</li><li>wildcardsè¦å‰‡ï¼š*</li><li>wildcardsè¦å‰‡ï¼š..</li><li>åŒ…å«subtypeè¦å‰‡ï¼š+</li></ul><p>ä»¥ä¸‹ç‚ºæ¡ç”¨å…¶ä¸­å¹¾ç¨®çš„ç¯„ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°</p><ol><li>â€˜* com.mycompany.app.App.greetâ€™çš„*ç¬¦è™Ÿä»£è¡¨wildcardså®¹è¨±ä»»ä½•å›å‚³é¡å‹</li><li>com.mycompany.app.App.greet(..)çš„..ç¬¦è™Ÿä»£è¡¨wildcardså®¹è¨±ä»»ä½•åƒæ•¸(ä¸è«–æœ‰ç„¡æˆ–å¤šå°‘å€‹)</li><li>!execution(* com.mycompany.app.App.greet())çš„!ç¬¦è™Ÿä»£è¡¨ä¸è¦å°è©²é€£æ¥é»åˆ‡å…¥</li><li>æ•´é«”ä½¿ç”¨ &amp;&amp; ä¸²æ¥è¡¨ç¤ºæ¢ä»¶éƒ½ç›¸ç¬¦æ‰æ˜¯åˆ‡å…¥é»</li></ol><p>ç¸½çµè©²åˆ‡å…¥é»æ˜¯æ‰€æœ‰ä¸è«–ä»»ä½•å›å‚³é¡å‹èˆ‡åƒæ•¸å¤šå¯¡çš„com.mycompany.app.App.greetå‡½å¼ï¼Œä¸”ä¸æ¥å—æ²’æœ‰åƒæ•¸çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mycompany.app.App.greet(..)) &amp;&amp; !execution(* com.mycompany.app.App.greet())&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeAppGreet</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Before!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - After!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¬¡ç¯„ä¾‹çš„App.javaå…§å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        App app = <span class="keyword">new</span> App();</span><br><span class="line">        app.greet();</span><br><span class="line">        app.greet(<span class="string">&quot;App&quot;</span>);</span><br><span class="line">        app.hibernate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello&quot;</span> + message +<span class="string">&quot;!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hibernate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;App is hibernating&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç·¨ç¹”ä¸¦åŸ·è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn aspectj:compile exec:java</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œçµæœå¦‚ä¸‹ï¼Œå¯ä»¥ç™¼ç¾greet()å‡½å¼ç¢ºå¯¦æ²’æœ‰è¢«æ·»å¢è¡Œç‚ºï¼Œè€Œgreet(â€œAppâ€)å‡½å¼å‰‡å‰å¾Œæ·»å¢è¡Œç‚º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">Hello Aspect - Before!</span><br><span class="line">HelloApp!</span><br><span class="line">Hello Aspect - After!</span><br><span class="line">App is hibernating</span><br></pre></td></tr></table></figure><h2 id="AspectJæ”¯æ´çš„ç›¸é—œè³‡è¨Š"><a href="#AspectJæ”¯æ´çš„ç›¸é—œè³‡è¨Š" class="headerlink" title="AspectJæ”¯æ´çš„ç›¸é—œè³‡è¨Š"></a>AspectJæ”¯æ´çš„ç›¸é—œè³‡è¨Š</h2><p>åœ¨ä¸‹é¢é€£çµçš„é€™é …æ–‡ä»¶ä¸­ï¼Œæ•´ç†äº†AsepctJçš„èªæ³•ï¼Œæœ‰éœ€æ±‚å¯ä»¥è©³ç´°å¯Ÿçœ‹<br><a href="https://www.eclipse.org/aspectj/doc/released/quick5.pdf">https://www.eclipse.org/aspectj/doc/released/quick5.pdf</a></p><h3 id="Pointcutå½¢å¼"><a href="#Pointcutå½¢å¼" class="headerlink" title="Pointcutå½¢å¼"></a>Pointcutå½¢å¼</h3><p>åˆ‡å…¥é»å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">call(MethodPat) </span><br><span class="line">call(ConstructorPat) </span><br><span class="line">execution(MethodPat) </span><br><span class="line">execution(ConstructorPat) </span><br><span class="line">initialization(ConstructorPat) </span><br><span class="line">preinitialization(ConstructorPat) </span><br><span class="line">staticinitialization(TypePat) </span><br><span class="line">get(FieldPat) </span><br><span class="line">set(FieldPat) </span><br><span class="line">handler(TypePat) </span><br><span class="line">adviceexecution()</span><br><span class="line">within(TypePat) </span><br><span class="line">withincode(MethodPat) </span><br><span class="line">withincode(ConstructorPat) </span><br><span class="line">cflow(Pointcut) </span><br><span class="line">cflowbelow(Pointcut) </span><br><span class="line"><span class="keyword">if</span>(Expression) </span><br><span class="line"><span class="keyword">this</span>(Type | Var) </span><br><span class="line">target(Type | Var) </span><br><span class="line">args(Type | Var , â€¦) </span><br><span class="line"><span class="meta">@this(Type|Var)</span> </span><br><span class="line"><span class="meta">@target(Type|Var)</span> </span><br><span class="line"><span class="meta">@args(Type|Var, â€¦)</span> </span><br><span class="line"><span class="meta">@within(Type|Var)</span> </span><br><span class="line"><span class="meta">@withincode(Type|Var)</span> </span><br><span class="line"><span class="meta">@annotation(Type|Var)</span></span><br></pre></td></tr></table></figure><h3 id="Adivceé¡å‹"><a href="#Adivceé¡å‹" class="headerlink" title="Adivceé¡å‹"></a>Adivceé¡å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="meta">@AfterReturning</span></span><br><span class="line"><span class="meta">@AfterThrowing</span></span><br><span class="line"><span class="meta">@After</span></span><br><span class="line"><span class="meta">@Around</span></span><br></pre></td></tr></table></figure><h2 id="Around-Adviceé‹ç”¨æ–¹æ³•"><a href="#Around-Adviceé‹ç”¨æ–¹æ³•" class="headerlink" title="Around Adviceé‹ç”¨æ–¹æ³•"></a>Around Adviceé‹ç”¨æ–¹æ³•</h2><p>around adviceå¯ä»¥è®“æˆ‘å€‘è¦†å¯«åŸåˆ‡å…¥é»å…§å®¹ï¼Œä½†è‹¥æ˜¯ä»¥é¡åˆ¥å‡½å¼ç‚ºåˆ‡å…¥é»ï¼Œé‚£å¦‚ä½•åœ¨é¢å‘ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨é¡åˆ¥å‡½å¼çš„åƒæ•¸èˆ‡é¡åˆ¥è®Šæ•¸å‘¢?</p><p>å‡è¨­App.javaå¦‚ä»¥ä¸‹å…§å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">App</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        App app = <span class="keyword">new</span> App(<span class="string">&quot;Bear&quot;</span>);</span><br><span class="line">        app.greet();</span><br><span class="line">        app.greet(<span class="string">&quot;App&quot;</span>);</span><br><span class="line"></span><br><span class="line">        app = <span class="keyword">new</span> App(<span class="string">&quot;Cat&quot;</span>);</span><br><span class="line">        app.greet();</span><br><span class="line">        app.greet(<span class="string">&quot;meow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello&quot;</span> + message +<span class="string">&quot;!&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°Appé¡åˆ¥æœ‰nameè®Šæ•¸ï¼Œé è¨­ç‚ºç©ºå­—ä¸²ï¼Œåœ¨ç‰©ä»¶åˆå§‹åŒ–æ™‚é€²è¡Œè¨­å®š</p><p>ä¸€èˆ¬åŸ·è¡Œçµæœæœƒæ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">Hello App!</span><br><span class="line">Hello World!</span><br><span class="line">Hello meow!</span><br></pre></td></tr></table></figure><p>è‹¥æˆ‘å€‘æƒ³é”æˆä½¿ç”¨åƒæ•¸èˆ‡é¡åˆ¥è®Šæ•¸ï¼Œå…‰çœ‹ä¹‹å‰çš„Aroundç¯„ä¾‹æ˜¯ç„¡æ³•é”æˆçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;executeAppGreet()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAppGreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Hello Aspect - Around!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ProceedingJoinPointæ”¯æ´å–å¾—åˆ‡å…¥é»è³‡è¨Š"><a href="#ProceedingJoinPointæ”¯æ´å–å¾—åˆ‡å…¥é»è³‡è¨Š" class="headerlink" title="ProceedingJoinPointæ”¯æ´å–å¾—åˆ‡å…¥é»è³‡è¨Š"></a>ProceedingJoinPointæ”¯æ´å–å¾—åˆ‡å…¥é»è³‡è¨Š</h3><p>ProceedingJoinPointå¯ä»¥æä¾›åˆ‡å…¥é»ç›¸é—œè³‡è¨Šï¼Œå› æ­¤åœ¨ä½¿ç”¨Around Adviceæ™‚å¯ä»¥æ­é…ï¼Œä»¥å–å¾—æ‰€éœ€å…§å®¹èˆ‡æ–¹æ³•</p><p>ä½¿ç”¨æ–¹æ³•ç‚ºåœ¨é¢å‘å‡½å¼ä¸­åŠ å…¥ProceedingJoinPointåƒæ•¸å³å¯ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mycompany.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mycompany.app.App.greet(String))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeAppGreet</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;executeAppGreet()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAppGreet</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        String arg1 = (String) joinPoint.getArgs()[<span class="number">0</span>];</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Aspect - Around! - &quot;</span> + arg1);</span><br><span class="line"></span><br><span class="line">        App myAppClass = (App) joinPoint.getTarget();</span><br><span class="line">        System.out.println(<span class="string">&quot;My name is &quot;</span> + myAppClass.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°</p><p>ä½¿ç”¨äº†joinPoint.getArgs()æ–¹æ³•å–å¾—è©²åˆ‡å…¥é»æ‰€æœ‰çš„åƒæ•¸</p><p>ä½¿ç”¨äº†joinPoint.getTarget()æ–¹æ³•å–å¾—ç•¶å‰åˆ‡å…¥é»æ‰€å±¬ç‰©ä»¶èˆ‡å…¶è®Šæ•¸</p><p>ç·¨ç¹”ä¸¦åŸ·è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn aspectj:compile exec:java</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œçµæœå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">Hello Aspect - Around! - App</span><br><span class="line">My name is Bear</span><br><span class="line">Hello World!</span><br><span class="line">Hello Aspect - Around! - meow</span><br><span class="line">My name is Cat</span><br></pre></td></tr></table></figure><!-- ## çµèªæœ¬ç¯‡å¤§è‡´æ•˜è¿°AOPã€Mavenæ¦‚å¿µä»¥åŠä½¿ç”¨AspectJå¯¦ä½œAOPçš„å…§å®¹ï¼Œ -->]]></content>
      
      
      <categories>
          
          <category> AOP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AOP </tag>
            
            <tag> AspectJ </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‹ç”¨Dockerå»ºç½®GitLab Serverèˆ‡GitLab CI Runner</title>
      <link href="/posts/%E9%81%8B%E7%94%A8Docker%E5%BB%BA%E7%BD%AEGitLab%20Server%E8%88%87GitLab%20CI%20Runner/"/>
      <url>/posts/%E9%81%8B%E7%94%A8Docker%E5%BB%BA%E7%BD%AEGitLab%20Server%E8%88%87GitLab%20CI%20Runner/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>GitLabæä¾›self-managed GitLabä¼ºæœå™¨æ¶è¨­æ–¹å¼ï¼Œè®“ä¼æ¥­æˆ–åœ˜éšŠå¯ä»¥åœ¨è‡ªå·±çš„åŸºç¤è¨­æ–½(infrastructure)ä¸­é‹è¡ŒGitLab Serverã€‚ç§äººçš„GitLab Serverä½¿å¾—å°ˆæ¡ˆæ©Ÿå¯†è³‡æ–™ä¸æœƒå› ç¬¬ä¸‰æ–¹å› ç´ è€Œæš´éœ²ï¼Œå°è‡´ä¼æ¥­ç ”ç™¼ä¹‹å°ˆåˆ©æŠ€è¡“å…§å®¹å…¬é–‹è€Œå¤±å»åƒ¹å€¼ã€‚</p><p>GitLab CI Runnerç‚ºæä¾›GitLab é‹è¡ŒCI/CDä½œæ¥­çš„æ‡‰ç”¨ç¨‹å¼</p><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>å®‰è£Docker</li></ul></li><li>å»ºç½®GitLab Server<ul><li>æ’°å¯«Docker Compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™</li><li>ç”³è«‹Gmailæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼</li><li>æ’°å¯«.envç’°å¢ƒè®Šæ•¸</li><li>é‹è¡ŒGitLab Serverå®¹å™¨</li><li>å¯„é€æ¸¬è©¦ä¿¡ä»¶ç¢ºèªSMTPåŠŸèƒ½</li><li>ä½¿ç”¨è€…è¨»å†Šè¨­ç½®</li></ul></li><li>å»ºç½®GitLab CI Runner<ul><li>æ–¼GitLabå°ˆæ¡ˆRepoä¸Šæ–°å¢CI/CD Runner</li><li>æ’°å¯«Docker Compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™</li><li>é‹è¡ŒGitLab CI Runnerå®¹å™¨</li><li>è¨»å†ŠGitLab CI Runner</li><li>æŸ¥çœ‹è©²Projectçš„Runneræ˜¯å¦æˆåŠŸè¨»å†Š</li></ul></li><li>æ¸¬è©¦GitLab CI Runner<ul><li>æ–¼Repoä¸­å»ºç«‹.gitlab-ci.ymlæŒçºŒæ•´åˆè¨­å®šæª”</li><li>è§¸ç™¼CI/CDæ©Ÿåˆ¶</li><li>æŸ¥çœ‹GitLab CI/CD Pipelinesç‹€æ…‹</li><li>.gitlab-ci.ymlè¨­ç½®DockeræŒ‡ä»¤</li></ul></li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><p>ç¯„ä¾‹ä¸­çš„ä½œæ¥­ç³»çµ±æ¡ç”¨Ubuntu 22.04ç‰ˆæœ¬ï¼Œç’°å¢ƒåªè¦å®‰è£Docker</p><h3 id="å®‰è£Docker"><a href="#å®‰è£Docker" class="headerlink" title="å®‰è£Docker"></a>å®‰è£Docker</h3><h4 id="å®‰è£æŒ‡ä»¤"><a href="#å®‰è£æŒ‡ä»¤" class="headerlink" title="å®‰è£æŒ‡ä»¤"></a>å®‰è£æŒ‡ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ca-certificates curl gnupg</span><br><span class="line"></span><br><span class="line">sudo install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line">sudo chmod a+r /etc/apt/keyrings/docker.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=&quot;</span>$(dpkg --print-architecture)<span class="string">&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  &quot;</span>$(. /etc/os-release &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)<span class="string">&quot; stable&quot;</span> | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure><h4 id="çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™"><a href="#çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™" class="headerlink" title="çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™"></a>çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°‡$USERåŠ å…¥dockerç¾¤çµ„</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ›ç¾¤çµ„</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><h2 id="å»ºç½®GitLab-Server"><a href="#å»ºç½®GitLab-Server" class="headerlink" title="å»ºç½®GitLab Server"></a>å»ºç½®GitLab Server</h2><h3 id="æ’°å¯«docker-compose-ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™"><a href="#æ’°å¯«docker-compose-ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™" class="headerlink" title="æ’°å¯«docker-compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™"></a>æ’°å¯«docker-compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™</h3><p>gitlab serveræœ‰è¨±å¤šçš„ç’°å¢ƒé…ç½®å¯ä»¥è¨­å®šï¼Œå…¶ä¸­æœ¬ç¯‡ä»¥SSLæ†‘è­‰è¨­ç½®èˆ‡SMTPå¯„ä¿¡è¨­å®šåšç‚ºåˆ†äº«å…§å®¹</p><div class="tabs" id="gitlab-server-docker-compose.ymlè¨­ç½®"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#gitlab-server-docker-compose.ymlè¨­ç½®-1">è‡ªå‚™SSLæ†‘è­‰ & Gmail SMTPè¨­å®š</button></li><li class="tab"><button type="button" data-href="#gitlab-server-docker-compose.ymlè¨­ç½®-2">è‡ªå‹•letsencrypt SSLæ†‘è­‰ & Gmail SMTPè¨­å®š</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="gitlab-server-docker-compose.ymlè¨­ç½®-1"><ul><li><p>æ’°å¯«docker-compose.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: <span class="string">&#x27;gitlab/gitlab-ee:latest&#x27;</span></span><br><span class="line">    container_name: gitlab</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: <span class="string">&#x27;your_domain&#x27;</span></span><br><span class="line">    environment:</span><br><span class="line">      GITLAB_OMNIBUS_CONFIG: |</span><br><span class="line">        external_url <span class="string">&#x27;https://your_domain&#x27;</span></span><br><span class="line">        letsencrypt[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 587</span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;<span class="variable">$&#123;SMTP_EMAIL&#125;</span>&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;<span class="variable">$&#123;SMTP_PASSWORD&#125;</span>&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_openssl_verify_mode&#x27;</span>] = <span class="string">&#x27;peer&#x27;</span></span><br><span class="line">      GITLAB_ROOT_PASSWORD: <span class="variable">$&#123;GITLAB_ROOT_PASSWORD&#125;</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;80:80&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;443:443&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;22:22&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&#x27;./config:/etc/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;./ssl:/etc/gitlab/ssl&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;./logs:/var/log/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;./data:/var/opt/gitlab&#x27;</span></span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    shm_size: <span class="string">&#x27;256m&#x27;</span></span><br><span class="line">    deploy:</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">&#x27;3&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>å»ºç«‹sslè³‡æ–™å¤¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir ssl</span><br></pre></td></tr></table></figure></li><li><p>å°‡è‡ªå‚™çš„æ†‘è­‰æ”¾å…¥sslè³‡æ–™å¤¾ï¼Œä¸¦å–åç‚ºyour_domain.crtã€your_domain.keyæ ¼å¼</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="gitlab-server-docker-compose.ymlè¨­ç½®-2"><ul><li>æ’°å¯«docker-compose.yml<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: <span class="string">&#x27;gitlab/gitlab-ee:latest&#x27;</span></span><br><span class="line">    container_name: gitlab</span><br><span class="line">    restart: always</span><br><span class="line">    hostname: <span class="string">&#x27;your_domain&#x27;</span></span><br><span class="line">    environment:</span><br><span class="line">      GITLAB_OMNIBUS_CONFIG: |</span><br><span class="line">        external_url <span class="string">&#x27;https://your_domain&#x27;</span></span><br><span class="line">        letsencrypt[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">    letsencrypt[<span class="string">&#x27;auto_renew&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">letsencrypt[<span class="string">&#x27;contact_emails&#x27;</span>] = [<span class="string">&#x27;your_email&#x27;</span>]</span><br><span class="line">        letsencrypt[<span class="string">&#x27;auto_renew_hour&#x27;</span>] = <span class="string">&quot;12&quot;</span></span><br><span class="line">letsencrypt[<span class="string">&#x27;auto_renew_minute&#x27;</span>] = <span class="string">&quot;30&quot;</span></span><br><span class="line">letsencrypt[<span class="string">&#x27;auto_renew_day_of_month&#x27;</span>] = <span class="string">&quot;*/7&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 587</span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;<span class="variable">$&#123;SMTP_EMAIL&#125;</span>&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;<span class="variable">$&#123;SMTP_PASSWORD&#125;</span>&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">        gitlab_rails[<span class="string">&#x27;smtp_openssl_verify_mode&#x27;</span>] = <span class="string">&#x27;peer&#x27;</span></span><br><span class="line">      GITLAB_ROOT_PASSWORD: <span class="variable">$&#123;GITLAB_ROOT_PASSWORD&#125;</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;80:80&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;443:443&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;22:22&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&#x27;./config:/etc/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;./logs:/var/log/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;./data:/var/opt/gitlab&#x27;</span></span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    shm_size: <span class="string">&#x27;256m&#x27;</span></span><br><span class="line">    deploy:</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">&#x27;3&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><p>å…¶ä¸­letsencryptå³ç‚ºå…è²»è‡ªå‹•æ†‘è­‰çš„è¨­ç½®</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info flat"><p>ğŸ’¡æœ‰é—œè©³ç´°çš„SMTPè¨­å®šå¯ä»¥æŸ¥çœ‹GitLabå®˜æ–¹æ–‡ä»¶<br><a href="https://docs.gitlab.com/omnibus/settings/smtp.html">https://docs.gitlab.com/omnibus/settings/smtp.html</a></p></div><h3 id="ç”³è«‹Gmailæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼"><a href="#ç”³è«‹Gmailæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼" class="headerlink" title="ç”³è«‹Gmailæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼"></a>ç”³è«‹Gmailæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼</h3><p>è‹¥æƒ³è¦ä½¿ç”¨Gmail SMTPæœå‹™ï¼Œè®“ä½ çš„è»Ÿé«”å¯ä»¥ç”¨æŒ‡å®šçš„gmailç™¼ä¿¡ï¼Œä½†åˆä¸æƒ³è¦åœ¨ç³»çµ±/è»Ÿé«”è¼¸å…¥è‡ªå·±çš„gmailå¯†ç¢¼ã€‚å¦‚æ­¤å¯æ–¼googleå¸³æˆ¶ä¸­ç”³è«‹æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼</p><ul><li>å‰å¾€Googleå¸³æˆ¶ç®¡ç†é é¢<br>  å¦‚åœ–é»æ“Šç´…æ¡†è™•çš„æŒ‰éˆ•  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-1.jpg" alt="Untitled"></li></ul><ul><li><p>åˆ°å®‰å…¨æ€§é é¢é»æ“Šå…©æ­¥é©Ÿé©—è­‰ï¼Œä¸¦é€²è¡Œç›¸é—œè¨­å®š</p>  <div class="note info flat"><p>ğŸ’¡é€éå…©æ­¥é©Ÿé©—è­‰ä½¿å¾—ä¹‹å¾Œä¸å°å¿ƒå¤–æ´©å¯†ç¢¼ï¼Œgoogleç™¼ç¾æ˜¯ç•°åœ°ç™»å…¥æ™‚æœƒéœ€è¦æ‰‹æ©Ÿé©—è­‰<br>å¢åŠ å¸³æˆ¶çš„å®‰å…¨æ€§</p></div><p>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-2.jpg" alt="Untitled"></p></li></ul><ul><li><p>ä¸‹æ‹‰åˆ°ä¸‹æ–¹å…§å®¹é»æ“Šç´…æ¡†ï¼Œå‰å¾€æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼é é¢<br>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-3.jpg" alt="Untitled"></p></li><li><p>é¸æ“‡æ‰€éœ€çš„ç”¢ç”Ÿå¯†ç¢¼çš„æ‡‰ç”¨ç¨‹å¼èˆ‡è£ç½®</p><ul><li>æˆ‘å€‘çš„éœ€æ±‚æ˜¯SMTPä¹Ÿå°±éƒµä»¶æ‡‰ç”¨ç¨‹å¼</li><li>è£ç½®å¯ä»¥è‡ªè¨‚åç¨±ã€‚å¦‚GitLab server</li><li>æŒ‰ç”¢ç”ŸæŒ‰éˆ•å°±æœƒé¡¯ç¤ºå¯†ç¢¼æ‹‰<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-4.jpg" alt="Untitled"></li></ul></li></ul><h3 id="æ’°å¯«-envç’°å¢ƒè®Šæ•¸"><a href="#æ’°å¯«-envç’°å¢ƒè®Šæ•¸" class="headerlink" title="æ’°å¯«.envç’°å¢ƒè®Šæ•¸"></a>æ’°å¯«.envç’°å¢ƒè®Šæ•¸</h3><p>å¾docker-compose.ymlä¸­å¯ä»¥çœ‹åˆ°æœ‰è¢«${}ç¬¦è™Ÿæ¨™è¨˜çš„ç‚ºä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼ŒSMTP_PASSWORDçš„å€¼å°±æ˜¯å¡«å¯«å‰›æ‰ç”³è«‹çš„æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼æ‹‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GITLAB_ROOT_PASSWORD=</span><br><span class="line">SMTP_EMAIL=</span><br><span class="line">SMTP_PASSWORD=</span><br></pre></td></tr></table></figure><h3 id="é‹è¡ŒGitLab-Serverå®¹å™¨"><a href="#é‹è¡ŒGitLab-Serverå®¹å™¨" class="headerlink" title="é‹è¡ŒGitLab Serverå®¹å™¨"></a>é‹è¡ŒGitLab Serverå®¹å™¨</h3><p>GitLab Serveråˆå§‹é‹è¡Œæ™‚æœƒéœ€è¦è·‘å¥½ä¸€é™£å­ï¼Œç›´åˆ°gitlabé é¢å¯ä»¥è¨ªå•äº†å°±æˆåŠŸäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up</span><br></pre></td></tr></table></figure><h3 id="å¯„é€æ¸¬è©¦ä¿¡ä»¶ç¢ºèªSMTPåŠŸèƒ½"><a href="#å¯„é€æ¸¬è©¦ä¿¡ä»¶ç¢ºèªSMTPåŠŸèƒ½" class="headerlink" title="å¯„é€æ¸¬è©¦ä¿¡ä»¶ç¢ºèªSMTPåŠŸèƒ½"></a>å¯„é€æ¸¬è©¦ä¿¡ä»¶ç¢ºèªSMTPåŠŸèƒ½</h3><p>é›–ç„¶ä¸Šè¿°æœ‰è¨­å®šå®Œç•¢SMTPåŠŸèƒ½äº†ï¼Œä½†é‚„æ˜¯è¦ç¢ºå®šèƒ½å¦æ­£å¸¸ä¸Šå‚³</p><p>è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤é€²å…¥gitlabå®¹å™¨å…§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab bash</span><br></pre></td></tr></table></figure><p>gitlabæ‡‰ç”¨ç¨‹å¼æ˜¯ç”±Ruby on Rails frameworkå»ºæ§‹çš„ï¼Œå…¶ä¸­rails consoleæä¾›äº’å‹•command lineå¯ä»¥èˆ‡gitlabå¯¦é«”äº’å‹•ï¼Œå› æ­¤é€éè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å¯ä»¥ç™¼é€æ¸¬è©¦ä¿¡ä»¶è‡³æŒ‡å®šçš„email</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gitlab-rails console</span><br><span class="line"></span><br><span class="line">Notify.test_email(<span class="string">&#x27;your_email&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;content&#x27;</span>).deliver_now</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è€…è¨»å†Šè¨­ç½®"><a href="#ä½¿ç”¨è€…è¨»å†Šè¨­ç½®" class="headerlink" title="ä½¿ç”¨è€…è¨»å†Šè¨­ç½®"></a>ä½¿ç”¨è€…è¨»å†Šè¨­ç½®</h3><p>ä½¿ç”¨è€…è¨»å†Šæ™‚GitLabå°±æœƒç™¼é€è¨»å†Šç¢ºèªä¿¡ä»¶çµ¦äºˆä½¿ç”¨è€…ï¼Œå¦‚æ­¤ä¸€ä¾†å¯ä»¥å†æ¬¡æª¢é©—ä¿¡ä»¶åŠŸèƒ½æœ‰ç„¡æ­£å¸¸</p><p>åœ¨ä½¿ç”¨è€…è¨»å†Šä¸Šï¼ŒGitLabæœ‰æä¾›è¨±å¤šçš„è¨­ç½®é¸é …ï¼Œè®“åœ˜éšŠå¯ä»¥æ ¹æ“šéœ€æ±‚è¨­å®š</p><ul><li><p>ä»¥rootèº«åˆ†ç™»å…¥ä¸¦å‰å¾€adminé é¢<br>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-5.jpg" alt="Untitled"></p></li><li><p>åœ¨å´é‚Šé¸å–®é»æ“ŠSettingsâ†’General<br>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-6.jpg" alt="Untitled"></p></li><li><p>ä¸‹æ‹‰è‡³Sign-up restrictions</p><p>  é€™é‚Šæ˜¯è¨»å†Šçš„é™åˆ¶ç›¸é—œè¨­å®šï¼Œå¦‚ï¼š</p><ol><li>å¦å…è¨±è¨»å†Š</li><li>æ˜¯å¦éœ€è¦ç®¡ç†è€…åŒæ„æ–°è¨»å†Šç”¨æˆ¶</li><li>ä¿¡ä»¶ç¢ºèªè¨­å®š (ä¸å¼·åˆ¶ä½¿ç”¨è€…ä¿¡ä»¶ç¢ºèªã€å¯ç«‹å³ç™»å…¥ï¼Œä½†ä¸‰å¤©å…§éœ€ä¿¡ä»¶ç¢ºèªã€ç™»å…¥å‰å¿…é ˆå®Œæˆä¿¡ä»¶ç¢ºèª)</li><li>å¯†ç¢¼æœ€ä½é•·åº¦</li><li>å…è¨±æˆ–æ‹’çµ•ä¾†è‡ªå“ªäº›domainçš„è¨»å†Š</li><li>è¨­å®šè¨»å†Šä¿¡ç®±å¿…é ˆç¬¦åˆè¨­ç½®çš„regexæ ¼å¼<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-7.jpg" alt="Untitled"></li></ol></li></ul><pre><code>å®Œæˆè¨­å®šå¾Œï¼Œå°±å¯ä»¥å»å˜—è©¦ä½¿ç”¨è€…è¨»å†Šå•¦</code></pre><h2 id="å»ºç½®GitLab-CI-Runner"><a href="#å»ºç½®GitLab-CI-Runner" class="headerlink" title="å»ºç½®GitLab CI Runner"></a>å»ºç½®GitLab CI Runner</h2><h3 id="æ–¼GitLabå°ˆæ¡ˆRepoä¸Šæ–°å¢CI-CD-Runner"><a href="#æ–¼GitLabå°ˆæ¡ˆRepoä¸Šæ–°å¢CI-CD-Runner" class="headerlink" title="æ–¼GitLabå°ˆæ¡ˆRepoä¸Šæ–°å¢CI/CD Runner"></a>æ–¼GitLabå°ˆæ¡ˆRepoä¸Šæ–°å¢CI/CD Runner</h3><p>æ¯å€‹å°ˆæ¡ˆrepoéƒ½å¯ä»¥è¨­å®šrunnerï¼ŒGitLabæœƒçµ¦äºˆè¨»å†Šrunnerçš„tokenï¼Œè®“ä»–çŸ¥é“ä½ çš„å°ˆæ¡ˆè¦èˆ‡é€™å€‹runneråšé€£çµ</p><p>å¦‚ä¸‹åœ–æ­¥é©Ÿåˆ°å°ˆæ¡ˆCI/CDè¨­ç½®é é¢çš„Runnerå€åŸŸæ–°å¢Runner<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-8.jpg" alt="Untitled"></p><p>æ ¹æ“šéœ€æ±‚é¸æ“‡ï¼Œå…¶ä¸­Tagsç‚ºå¿…å¡«é¸é …ï¼Œä»–æœƒå½±éŸ¿åˆ°å¾ŒçºŒciè¨­ç½®æ™‚æŒ‡å®šå‘¼å«çš„runner<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-9.jpg" alt="Untitled"></p><p>åœ¨ç´…æ¡†è™•å¯ä»¥çœ‹åˆ°GitLab serverè¦æ±‚æˆ‘å€‘åˆ°runnerä¸­åŸ·è¡Œè©²æŒ‡ä»¤<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-10.jpg" alt="Untitled"></p><h3 id="æ’°å¯«Docker-Compose-ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™"><a href="#æ’°å¯«Docker-Compose-ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™" class="headerlink" title="æ’°å¯«Docker Compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™"></a>æ’°å¯«Docker Compose.ymlè¨­ç½®é‹è¡Œå®¹å™¨æœå‹™</h3><p>ç’°å¢ƒçš„éƒ¨åˆ†å¯ä»¥å…ˆè¨­å®šCI_SERVER_URLè®“ruunerçŸ¥é“serverçš„ç¶²å€ï¼Œå¾ŒçºŒè¨»å†Šæ™‚ç„¡é ˆå†æ¬¡è¼¸å…¥ç¶²å€</p><p>volumesä¸­ç¬¬ä¸€å€‹è¨­å®šç‚ºä½¿å…¶å¯åœ¨CI/CDæµç¨‹é‹è¡Œdockerç›¸é—œæŒ‡ä»¤<br>ç¬¬äºŒå€‹å‰‡ç‚ºå°‡è¨­å®šæª”æ˜ å°„å‡ºä¾†æ–¹ä¾¿ç®¡ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  gitlab-runner:</span><br><span class="line">    image: gitlab/gitlab-runner:latest</span><br><span class="line">    container_name: <span class="string">&quot;gitlab_runner&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - CI_SERVER_URL=https://your_domain</span><br><span class="line">    volumes:</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">      - ./config:/etc/gitlab-runner</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure><h3 id="é‹è¡ŒGitLab-CI-Runnerå®¹å™¨"><a href="#é‹è¡ŒGitLab-CI-Runnerå®¹å™¨" class="headerlink" title="é‹è¡ŒGitLab CI Runnerå®¹å™¨"></a>é‹è¡ŒGitLab CI Runnerå®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up</span><br></pre></td></tr></table></figure><p>ç”±æ–¼å°šæœªè¨»å†Šï¼Œrunnerä¸­çš„config.tomlæ²’è¢«å»ºç«‹æœƒä¸€ç›´å ±éŒ¯<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-11.jpg" alt="Untitled"></p><h3 id="è¨»å†ŠGitLab-CI-Runner"><a href="#è¨»å†ŠGitLab-CI-Runner" class="headerlink" title="è¨»å†ŠGitLab CI Runner"></a>è¨»å†ŠGitLab CI Runner</h3><ul><li><p>é€²å…¥runnerå®¹å™¨å…§</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab_runner bash</span><br></pre></td></tr></table></figure></li><li><p>è¨­ç½®ä¿¡ä»»çš„ç¶²ç«™SSLæ†‘è­‰</p><p>  è‹¥å˜—è©¦è¨ªå•çš„ç¶²ç«™å…·æœ‰å·²éæœŸæˆ–ä¾†è‡ªä¸å—ä¿¡ä»»çš„é ’ç™¼æ©Ÿæ§‹çš„ SSL è­‰æ›¸ï¼Œå¯èƒ½æœƒå‡ºç¾ä¸‹åœ–å•é¡Œ<br>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-12.jpg" alt="Untitled"></p><p>  å› æ­¤è¨»å†Šå‰å…ˆå°‡gitlab serverç¶²ç«™çš„æ†‘è­‰åŠ å…¥è‡³ä¿¡ä»»å…§</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">/etc/gitlab-runner/certs</span></span><br><span class="line"><span class="string">openssl</span> <span class="string">s_client</span> <span class="string">-showcerts</span> <span class="string">-connect</span> <span class="string">your_domain:443</span> <span class="string">servername</span> <span class="string">your_domain</span> <span class="string">&lt;</span> <span class="string">/dev/null</span> <span class="number">2</span><span class="string">&gt;/dev/null</span> <span class="string">|</span> <span class="string">openssl</span> <span class="string">x509</span> <span class="string">-outform</span> <span class="string">PEM</span> <span class="string">&gt;</span> <span class="string">/etc/gitlab-runner/certs/your_domain.crt</span></span><br></pre></td></tr></table></figure></li><li><p>åŸ·è¡Œrunnerè¨»å†ŠæŒ‡ä»¤</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner register</span><br></pre></td></tr></table></figure><p>  è¨»å†Šä¸­æœƒè¦æ±‚è¼¸å…¥ï¼š</p><ol><li>GitLab server URLï¼šç”±æ–¼docker-compose.ymlæœ‰å…ˆè¨­å®šäº†ï¼Œé€™é‚Šé»˜èªå³å¯</li><li>è¨»å†ŠRunnerçš„tokenï¼šè²¼ä¸Šå‰›æ‰æŒ‡ä»¤çš„token</li><li>è©²Runnerçš„tagsï¼šç©ºç™½å³å¯</li><li>ç¶­è­·çš„è³‡è¨Šï¼šç©ºç™½å³å¯</li><li>åŸ·è¡Œå™¨ï¼šdocker</li><li>é è¨­docker imageï¼šalpine:latest<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-13.jpg" alt="Untitled"><div class="note info flat"><p>ğŸ’¡Docker executor ä½¿ç”¨ Docker å¼•æ“å‰µå»ºä¸€å€‹æ–°çš„å®¹å™¨ä¾†åŸ·è¡Œä½œæ¥­ã€‚æ¯å€‹ä½œæ¥­éƒ½åœ¨ä¸€å€‹ç¨ç«‹çš„å®¹å™¨ä¸­é‹è¡Œï¼Œå¯ä»¥æŒ‡å®šä¸åŒçš„å®¹å™¨é¡åƒå’Œé‹è¡Œç’°å¢ƒã€‚é€™ç¨®åŸ·è¡Œè€…é©ç”¨æ–¼éœ€è¦éš”é›¢ç’°å¢ƒæˆ–ä¾è³´ç‰¹å®šå®¹å™¨é¡åƒçš„ä½œæ¥­ã€‚</p></div></li></ol></li></ul><ul><li><p>æŸ¥çœ‹è¨­å®šæª”config.toml</p><p>  å¯ä»¥çœ‹åˆ°å‰›æ‰çš„è¨»å†Šè³‡è¨Šå¯«å…¥è‡³è©²è¨­å®šæª”ä¸­ï¼Œå¾ŒçºŒæ›´æ–°èˆ‡æª¢æŸ¥å¯ä½¿ç”¨</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">config.toml</span></span><br></pre></td></tr></table></figure><p>  <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-14.jpg" alt="Untitled"></p></li><li><p>æ›´æ–°config.tomlé…ç½®æª”è¨­å®š</p><p>  config.tomlé…ç½®æª”ä¸­volumeséƒ¨åˆ†éœ€æ›´æ–°ç‚ºä»¥ä¸‹ï¼Œå¦‚æ­¤åŸ·è¡Œdockerç›¸é—œæŒ‡ä»¤æ™‚æ‰å¯é‹ä½œ</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">volumes</span> <span class="string">=</span> [<span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span>, <span class="string">&quot;/cache&quot;</span>]</span><br></pre></td></tr></table></figure></li></ul><h3 id="æŸ¥çœ‹è©²Projectçš„Runneræ˜¯å¦æˆåŠŸè¨»å†Š"><a href="#æŸ¥çœ‹è©²Projectçš„Runneræ˜¯å¦æˆåŠŸè¨»å†Š" class="headerlink" title="æŸ¥çœ‹è©²Projectçš„Runneræ˜¯å¦æˆåŠŸè¨»å†Š"></a>æŸ¥çœ‹è©²Projectçš„Runneræ˜¯å¦æˆåŠŸè¨»å†Š</h3><p>é‡æ•´é é¢ï¼Œå¯ç™¼ç¾ä¸‹åœ–ç´…æ¡†è™•æœ‰å¯ä½¿ç”¨çš„runner<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-15.jpg" alt="Untitled"></p><h2 id="æ¸¬è©¦GitLab-CI-Runner"><a href="#æ¸¬è©¦GitLab-CI-Runner" class="headerlink" title="æ¸¬è©¦GitLab CI Runner"></a>æ¸¬è©¦GitLab CI Runner</h2><p>ä¸Šä¸€ç¯€å»ºç«‹GitLab CI Runnerå¾Œï¼Œåœ¨è¨­ç½®é é¢é›–ç„¶æœ‰å¯ä½¿ç”¨çš„Runnerï¼Œä½†ä»éœ€è¦æª¢é©—CI/CDæµç¨‹æ˜¯å¦æœƒè§¸ç™¼é€²è¡Œä»»å‹™éœ€æ±‚</p><h3 id="æ–¼Repoä¸­å»ºç«‹-gitlab-ci-ymlæŒçºŒæ•´åˆè¨­å®šæª”"><a href="#æ–¼Repoä¸­å»ºç«‹-gitlab-ci-ymlæŒçºŒæ•´åˆè¨­å®šæª”" class="headerlink" title="æ–¼Repoä¸­å»ºç«‹.gitlab-ci.ymlæŒçºŒæ•´åˆè¨­å®šæª”"></a>æ–¼Repoä¸­å»ºç«‹.gitlab-ci.ymlæŒçºŒæ•´åˆè¨­å®šæª”</h3><p>åœ¨å€‹äººå°ˆæ¡ˆä¸­ï¼Œå»ºç«‹.gitlab-ci.ymlï¼Œå…¶ä¸­å…§å®¹å¦‚ä¸‹ï¼š</p><p>é€™æ˜¯ç°¡æ˜“çš„é‹è¡Œç¯„ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">- build</span><br><span class="line">build:</span><br><span class="line">  stage: build</span><br><span class="line">  tags:</span><br><span class="line">   - master</span><br><span class="line">  script:</span><br><span class="line">    - <span class="built_in">echo</span> <span class="string">&quot;Hello GitLab Runner&quot;</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡tagsç‚ºæŒ‡å®šåŸ·è¡Œçš„runnerï¼Œåœ¨æœ€åˆrunneræ–°å¢è¨­å®šæ™‚æœ‰æåˆ°</p></div><h3 id="è§¸ç™¼CI-CDæ©Ÿåˆ¶"><a href="#è§¸ç™¼CI-CDæ©Ÿåˆ¶" class="headerlink" title="è§¸ç™¼CI/CDæ©Ÿåˆ¶"></a>è§¸ç™¼CI/CDæ©Ÿåˆ¶</h3><p>æ¥è‘—å°±æ¨é€ç‰ˆæœ¬ç´€éŒ„å³å¯è§¸ç™¼CI/CDæ©Ÿåˆ¶</p><p>ä¸Šè¿°ç‰ˆæœ¬æ²’æœ‰ä»»ä½•é™åˆ¶ï¼Œè‹¥æœŸæœ›åªåœ¨masteråˆ†æ”¯æˆ–æŒ‡å®šåˆ†æ”¯ç‰ˆæœ¬ç´€éŒ„æ™‚è§¸ç™¼ä¹Ÿå¯ä»¥é¡å¤–è¨­ç½®</p><p>æˆ–è€…æ˜¯merge requestäº‹ä»¶è§¸ç™¼ç­‰è¦å‰‡è¨­å®š</p><h3 id="æŸ¥çœ‹GitLab-CI-CD-Pipelinesç‹€æ…‹"><a href="#æŸ¥çœ‹GitLab-CI-CD-Pipelinesç‹€æ…‹" class="headerlink" title="æŸ¥çœ‹GitLab CI/CD Pipelinesç‹€æ…‹"></a>æŸ¥çœ‹GitLab CI/CD Pipelinesç‹€æ…‹</h3><p>è§¸ç™¼å¾Œåœ¨GitLab CI/CD Pipelineså¯ä»¥æŸ¥çœ‹ç›®å‰çš„ä»»å‹™</p><p>ç‹€æ…‹å‰æœŸæœƒæœ‰pending â†’ running</p><p>pendingä»£è¡¨æº–å‚™å°‡ä»»å‹™æŒ‡æ´¾çµ¦runner</p><p>runningä»£è¡¨runnerå·²ç¶“åœ¨åŸ·è¡ŒCI/CDä»»å‹™äº†</p><div class="note info flat"><p>ğŸ’¡è‹¥ä¸€ç›´è™•æ–¼pendingç‹€æ…‹å¯é»æ“Šå‰å»æŸ¥çœ‹åŸå› ï¼Œå¯èƒ½æ˜¯æ²’æœ‰å¯ç”¨çš„runner</p></div><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gitlab-server-16.jpg" alt="Untitled"></p><h3 id="gitlab-ci-ymlè¨­ç½®Dockerç’°å¢ƒ"><a href="#gitlab-ci-ymlè¨­ç½®Dockerç’°å¢ƒ" class="headerlink" title=".gitlab-ci.ymlè¨­ç½®Dockerç’°å¢ƒ"></a>.gitlab-ci.ymlè¨­ç½®Dockerç’°å¢ƒ</h3><p>å¯ä»¥çœ‹åˆ°æˆ‘çš„pipelineä¸­æœ‰å¹¾æ¬¡çš„å¤±æ•—ï¼Œå…¶åŸå› ç‚ºè‹¥æ¬²åœ¨CI/CDä¸­ä½¿ç”¨dockeræŒ‡ä»¤ï¼Œéœ€è¦è¨­ç½®imageç‚ºdocker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">- build</span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  stage: build</span><br><span class="line">  image: docker</span><br><span class="line">  tags:</span><br><span class="line">   - master</span><br><span class="line">  script:</span><br><span class="line">    - <span class="built_in">echo</span> <span class="string">&quot;Hello GitLab Runner2&quot;</span></span><br><span class="line">    - docker -v</span><br></pre></td></tr></table></figure><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>æœ¬ç¯‡å¤§è‡´æ•˜è¿°ä»¥dockerå»ºç½®GitLab Serverèˆ‡GitLab Runnerçš„æ–¹æ³•ï¼Œä¸¦é€²è¡Œäº†ç°¡æ˜“çš„CIæ¸¬è©¦Runneré‹ä½œç‹€æ…‹ã€‚é€éå®¹å™¨åŒ–æ–¹å¼å¯ä»¥ä½¿å¾—CI/CDä»»å‹™éœ€æ±‚ä¸­æ›´å®¹æ˜“é”æˆæ‰€éœ€çš„ç’°å¢ƒã€‚æœ¬ç¯‡åœ¨gitlab ciè¨­ç½®æª”å±¬æ–¼ç°¡æ˜“ä½¿ç”¨ï¼Œæœªä¾†å¯è©³ç´°æ¢è¨è¨­ç½®çš„ç´°ç¯€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
            <tag> Docker </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‹ç”¨Borg èˆ‡ Crontabå»ºç«‹è‡ªå‹•åŒ–æœ¬åœ°èˆ‡ç•°åœ°å‚™ä»½Backup</title>
      <link href="/posts/%E9%81%8B%E7%94%A8Borg%20%E8%88%87%20Crontab%E5%BB%BA%E7%AB%8B%E8%87%AA%E5%8B%95%E5%8C%96%E6%9C%AC%E5%9C%B0%E8%88%87%E7%95%B0%E5%9C%B0%E5%82%99%E4%BB%BDBackup/"/>
      <url>/posts/%E9%81%8B%E7%94%A8Borg%20%E8%88%87%20Crontab%E5%BB%BA%E7%AB%8B%E8%87%AA%E5%8B%95%E5%8C%96%E6%9C%AC%E5%9C%B0%E8%88%87%E7%95%B0%E5%9C%B0%E5%82%99%E4%BB%BDBackup/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç•¶æ¶è¨­å¾Œç«¯æœå‹™æ™‚ï¼Œä¼ºæœå™¨é€šå¸¸æœƒéš¨è‘—æ™‚é–“å„²å­˜äº†è¨±å¤šä½¿ç”¨è€…çš„è³‡æ–™(åœ–ç‰‡ã€å½±ç‰‡ç­‰ç­‰)ã€‚ç„¶è€Œè‹¥æ²’æœ‰æœ¬åœ°å‚™ä»½èˆ‡ç•°åœ°å‚™ä»½ï¼Œç•¶ç™¼ç”Ÿæ„å¤–åˆªé™¤æˆ–è€…ç£ç¢Ÿæå£æ™‚ï¼Œä½¿ç”¨è€…çš„é‡è¦è³‡æ–™ä¹Ÿå°±ç„¡æ³•æ¢å¾©äº†ã€‚å› æ­¤å®šæ™‚å‚™ä»½ç‚ºä¸€ç¨®ç½é›£æ¢å¾©(disaster recovery)çš„æ–¹å¼ã€‚</p><p>Borgæ˜¯ä¸€ç¨®å‚™ä»½å·¥å…·ï¼Œä»–æä¾›å¢é‡å‚™ä»½ã€å»é™¤é‡è¤‡å£“ç¸®èˆ‡åŠ å¯†ç­‰åŠŸèƒ½ã€‚</p><p>Crontabæ˜¯ä¸€å€‹åœ¨Unixæ“ä½œç³»çµ±ä¸Šç”¨æ–¼å®šæœŸåŸ·è¡Œä»»å‹™çš„å·¥å…·ï¼Œé€éè¨­ç½®ä»»å‹™æ–¹å¼ï¼Œä½¿å…¶åœ¨é å®šæ™‚é–“æˆ–é–“éš”è‡ªå‹•åŸ·è¡ŒæŒ‡ä»¤æˆ–è…³æœ¬</p><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>å®‰è£Borg</li></ul></li><li>æœ¬åœ°ç«¯ - å‚™ä»½æ–¹æ³•<ul><li>åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€</li><li>å»ºç«‹å‚™ä»½æ­¸æª”</li><li>åˆ—å‡ºæ­¸æª”æ¸…å–®</li><li>ä¿®å‰ªå‚™ä»½å­˜æª”</li></ul></li><li>ç•°åœ°ç«¯ - å‚™ä»½æ–¹æ³•<ul><li>åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€</li><li>å»ºç«‹å‚™ä»½æ­¸æª”</li><li>é€éé‡‘é‘°æˆæ¬Šï¼Œé¿å…æ¯æ¬¡è¼¸å…¥ç•°åœ°æ©Ÿå™¨çš„å¯†ç¢¼æ–¹å¼</li></ul></li><li>è‡ªå‹•åŒ–å‚™ä»½<ul><li>å»ºç«‹å‚™ä»½è…³æœ¬Shell script</li><li>è¨­å®šCrontabå®šæ™‚ä»»å‹™</li></ul></li><li>å…¶ä»–å‚™ä»½æŒ‡ä»¤ä»‹ç´¹<ul><li>æ¯”è¼ƒæ­¸æª”å·®ç•°æ€§</li><li>æ¢å¾©è³‡æ–™</li></ul></li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><h3 id="å®‰è£Borg"><a href="#å®‰è£Borg" class="headerlink" title="å®‰è£Borg"></a>å®‰è£Borg</h3><p>é€™é‚Šä½¿ç”¨çš„æ˜¯borg1.2.2ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wget -q --show-progress https://github.com/borgbackup/borg/releases/download/1.2.2/borg-linuxold64</span><br><span class="line"></span><br><span class="line">wget -q --show-progress https://github.com/borgbackup/borg/releases/download/1.2.2/borg-linuxold64.asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># é©—è­‰ä¾†æº</span></span><br><span class="line">gpg --verify borg-linuxold64.asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°‡å‚™ä»½å·¥å…·æ”¾ç½®ç’°å¢ƒä¸­</span></span><br><span class="line">sudo cp borg-linuxold64 /usr/<span class="built_in">local</span>/bin/borg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹æ‰€æœ‰æ¬Š</span></span><br><span class="line">sudo chown root:root /usr/<span class="built_in">local</span>/bin/borg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹æ¬Šé™ï¼Œä½¿ä¸€èˆ¬ä½¿ç”¨è€…å¯ä½¿ç”¨</span></span><br><span class="line">sudo chmod 755 /usr/<span class="built_in">local</span>/bin/borg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹borgç‰ˆæœ¬, ç¢ºèªæœ‰ç„¡å®‰è£æˆåŠŸ</span></span><br><span class="line">borg -V</span><br></pre></td></tr></table></figure><div class="note info flat"><p>è‹¥æœ‰å…¶ä»–éœ€æ±‚äº¦å¯åœ¨borgçš„Github repoæ‰¾éœ€è¦çš„ç‰ˆæœ¬ï¼š<br><a href="https://github.com/borgbackup/borg">https://github.com/borgbackup/borg</a></p></div><h2 id="æœ¬åœ°ç«¯-å‚™ä»½æ–¹æ³•"><a href="#æœ¬åœ°ç«¯-å‚™ä»½æ–¹æ³•" class="headerlink" title="æœ¬åœ°ç«¯ - å‚™ä»½æ–¹æ³•"></a>æœ¬åœ°ç«¯ - å‚™ä»½æ–¹æ³•</h2><h3 id="åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€"><a href="#åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€" class="headerlink" title="åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€"></a>åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€</h3><p>ä¸€é–‹å§‹è¦è¨­å®šæƒ³è¦å‚™ä»½åœ¨å“ªå€‹ç›®éŒ„åº•ä¸‹ï¼Œåˆå§‹åŒ–æ™‚æœƒè¨­å®š-eåƒæ•¸çš„åŠ å¯†æ–¹å¼ï¼ŒæŒ‡ä»¤è³ªæ€§å¾Œæœƒè¦æ±‚å¡«å¯«passphraseï¼Œé€™æ˜¯ä¹‹å¾ŒåŸ·è¡Œé€™å€‹é …å‚™ä»½ç›¸é—œä»»å‹™æ™‚éœ€è¦çš„å¯†èª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg init -e repokey &lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg init -e repokey ~/my_backup</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹å‚™ä»½æ­¸æª”"><a href="#å»ºç«‹å‚™ä»½æ­¸æª”" class="headerlink" title="å»ºç«‹å‚™ä»½æ­¸æª”"></a>å»ºç«‹å‚™ä»½æ­¸æª”</h3><p>å‡è¨­æˆ‘å€‘æƒ³è¦å°‡å°ˆæ¡ˆçš„åœ–ç‰‡ç›®éŒ„å‚™ä»½è‡³ä¸Šè¿°åˆå§‹åŒ–å¥½çš„å‚™ä»½å€ä¸­ï¼Œå¯ä»¥åŸ·è¡Œä¸‹æ–¹æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg create --stats --progress --compression &lt;å£“ç¸®å½¢å¼&gt; &lt;å‚™ä»½å€&gt;::&lt;æ¨™ç±¤&gt; &lt;æƒ³è¦å‚™ä»½çš„è³‡æ–™ç›®éŒ„&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg create --stats --progress --compression lz4  ~/my_backup::2023_02_22_0219 ~/my_project/assets</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡åƒæ•¸ä»‹ç´¹<br>â€“statsï¼šåˆ—å°å·²å‰µå»ºå­˜æª”çš„çµ±è¨ˆè³‡è¨Š<br>â€“progressï¼šé¡¯ç¤ºç›®å‰å»ºç«‹å‚™ä»½çš„é€²åº¦<br>â€“compressionï¼šå£“ç¸®å½¢å¼</p></div><div class="note warning flat"><p>ğŸ’¡å£“ç¸®é¸é …åŒ…å«ä»¥ä¸‹é¸é …ï¼š<br>â€¢ lz4ï¼šå£“ç¸®é€Ÿåº¦å¿«ï¼Œä½†å£“ç¸®ç‡è¼ƒä½ï¼Œé©åˆéœ€è¦å¿«é€Ÿå‚™ä»½å’Œæ¢å¾©çš„æƒ…å¢ƒ<br>â€¢ zstdï¼šå¯èª¿ç¯€å£“ç¸®ç´šåˆ¥çš„é¸é …ï¼Œå¯ä»¥é©éœ€æ±‚å®¢è£½åŒ–<br>â€¢ zlibï¼šå£“ç¸®é€Ÿåº¦èˆ‡å£“ç¸®ç‡ä¸­ç­‰<br>â€¢ lzmaï¼šå£“ç¸®é€Ÿåº¦æ…¢ï¼Œä½†å£“ç¸®ç‡è¼ƒé«˜ï¼Œå‚™ä»½èˆ‡æ¢å¾©é€Ÿåº¦è¼ƒæ…¢</p></div><p>å¦‚ä¸‹åœ–é¡¯ç¤ºå»ºç«‹å‚™ä»½å¾Œçš„è³‡è¨Šï¼Œå¦‚åŸæœ¬è³‡æ–™å¤§å°ã€å£“ç¸®å¾Œå¤§å°ã€å»é™¤é‡è¤‡è³‡æ–™å¤§å°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/borg-create.jpg" alt="Untitled"></p><h3 id="åˆ—å‡ºæ­¸æª”æ¸…å–®"><a href="#åˆ—å‡ºæ­¸æª”æ¸…å–®" class="headerlink" title="åˆ—å‡ºæ­¸æª”æ¸…å–®"></a>åˆ—å‡ºæ­¸æª”æ¸…å–®</h3><p>ç¶“éä¸€æ¬¡æˆ–æ•¸æ¬¡å‚™ä»½å¾Œï¼Œè‹¥æƒ³æŸ¥çœ‹ç›®å‰å‚™ä»½å€ä¸­æœ‰å¤šå°‘å€‹å‚™ä»½ç´€éŒ„ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹å‚™ä»½æ­¸æª”æ¸…å–®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg list &lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg list ~/my_backup</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹åœ–é¡¯ç¤ºç›®å‰çš„æ­¸æª”æ¸…å–®<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/borg-list.jpg" alt="Untitled"></p><h3 id="ä¿®å‰ªå‚™ä»½å­˜æª”"><a href="#ä¿®å‰ªå‚™ä»½å­˜æª”" class="headerlink" title="ä¿®å‰ªå‚™ä»½å­˜æª”"></a>ä¿®å‰ªå‚™ä»½å­˜æª”</h3><p>å¦‚æœä¸€å¤©å‚™ä»½2æ¬¡ï¼Œé‚£365å¤©å°±å‚™ä»½730æ¬¡ï¼Œé€™å°‡å°è‡´å‚™ä»½æª”æ¡ˆè†¨è„¹ã€‚å…¶å¯¦éäº†ä¸€å¹´æˆ‘å€‘éœ€è¦çš„å¯èƒ½æ˜¯éå¾€æ¯é€±ä¸€ä»½æˆ–æ¯æœˆä¸€ä»½å³å¯ï¼Œå› æ­¤å¯ä½¿ç”¨ä¿®å‰ªæ–¹æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">borg prune -v --list --keep-daily=&lt;æ—¥ç´šåˆ¥ä¿ç•™æ•¸&gt; --keep-weekly=&lt;å‘¨ç´šåˆ¥ä¿ç•™æ•¸&gt; --keep-monthly=&lt;æœˆä»½ç´šåˆ¥ä¿ç•™æ•¸&gt; --keep-yearly=&lt;å¹´åº¦ä¿ç•™æ•¸&gt; &lt;å‚™ä»½ç›®éŒ„&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg prune -v --list --keep-daily=14 --keep-monthly=6 --keep-yearly=1 /backup/my-project</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡åƒæ•¸ä»‹ç´¹<br>-v, â€“verboseï¼šæœƒåˆ—å°å‡ºè©³ç´°çš„æ“ä½œè³‡æ–™<br>â€“keep-dailyï¼šä¿ç•™è¿‘æœŸNå€‹æ¯æ—¥å‚™ä»½<br>â€“keep-weeklyï¼šä¿ç•™è¿‘æœŸNå€‹æ¯å‘¨å‚™ä»½<br>â€“keep-monthlyï¼šä¿ç•™è¿‘æœŸNå€‹æ¯æœˆå‚™ä»½<br>â€“keep-yearlyï¼šä¿ç•™è¿‘æœŸNå€‹æ¯å¹´å‚™ä»½</p></div><p>é€™æ˜¯å®˜æ–¹çš„ä¾‹å­ã€‚è‹¥ç¶“éä¸€å¹´ï¼Œæœƒä¿ç•™ä»¥ä¸‹æ—¥æœŸçš„å‚™ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List view</span><br><span class="line">---------</span><br><span class="line"></span><br><span class="line">--keep-daily 14     --keep-monthly 6     --keep-yearly 1</span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"> 1. 2015-12-31       (2015-12-31 kept     (2015-12-31 kept</span><br><span class="line"> 2. 2015-12-30        by daily rule)       by daily rule)</span><br><span class="line"> 3. 2015-12-29       1. 2015-11-30        1. 2015-01-01 (oldest)</span><br><span class="line"> 4. 2015-12-28       2. 2015-10-31</span><br><span class="line"> 5. 2015-12-27       3. 2015-09-30</span><br><span class="line"> 6. 2015-12-26       4. 2015-08-31</span><br><span class="line"> 7. 2015-12-25       5. 2015-07-31</span><br><span class="line"> 8. 2015-12-24       6. 2015-06-30</span><br><span class="line"> 9. 2015-12-23</span><br><span class="line">10. 2015-12-22</span><br><span class="line">11. 2015-12-21</span><br><span class="line">12. 2015-12-20</span><br><span class="line">    (no backup made on 2015-12-19)</span><br><span class="line">13. 2015-12-18</span><br><span class="line">14. 2015-12-17</span><br></pre></td></tr></table></figure><h2 id="ç•°åœ°ç«¯-å‚™ä»½æ–¹æ³•"><a href="#ç•°åœ°ç«¯-å‚™ä»½æ–¹æ³•" class="headerlink" title="ç•°åœ°ç«¯ - å‚™ä»½æ–¹æ³•"></a>ç•°åœ°ç«¯ - å‚™ä»½æ–¹æ³•</h2><p>ç•°åœ°èˆ‡æœ¬åœ°å‚™ä»½ä¸åŒè™•åœ¨æ–¼</p><ul><li>è¼¸å…¥å‚™ä»½å€çš„ç›®éŒ„æœƒæ˜¯ssh://username@remote_ip/&lt;æŒ‡å®šçš„è·¯å¾‘&gt;</li><li>æ¯æ¬¡å‚™ä»½éœ€è¦è¼¸å…¥ç•°åœ°ç™»å…¥çš„å¯†ç¢¼ï¼Œå› ç‚ºæ¯æ¬¡éƒ½ä½¿ç”¨sshé€£ç·š</li><li>ä½¿ç”¨å‰ï¼Œç•°åœ°ç«¯éœ€è¦å®‰è£borg</li></ul><p>è¼¸å…¥ä¸Šå¤šä¸€é»å‰é¢çš„é€£ç·šè³‡è¨Šè€Œå·²ï¼Œè©¦è‘—åšåšçœ‹å§</p><h3 id="åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€-1"><a href="#åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€-1" class="headerlink" title="åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€"></a>åˆå§‹åŒ–å‚™ä»½è³‡æ–™çš„å­˜æ”¾å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg init -e repokey ssh://username@remote_ip/&lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg init -e repokey ssh://username@remote_ip/~/my_backup</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹å‚™ä»½æ­¸æª”-1"><a href="#å»ºç«‹å‚™ä»½æ­¸æª”-1" class="headerlink" title="å»ºç«‹å‚™ä»½æ­¸æª”"></a>å»ºç«‹å‚™ä»½æ­¸æª”</h3><p>å‡è¨­æˆ‘å€‘æƒ³è¦å°‡å°ˆæ¡ˆçš„åœ–ç‰‡ç›®éŒ„å‚™ä»½è‡³ä¸Šè¿°åˆå§‹åŒ–å¥½çš„å‚™ä»½å€ä¸­ï¼Œå¯ä»¥åŸ·è¡Œä¸‹æ–¹æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg create --stats --progress --compression &lt;å£“ç¸®å½¢å¼&gt; &lt;å‚™ä»½å€&gt;::&lt;æ¨™ç±¤&gt; ssh://username@remote_ip/&lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg create --stats --progress --compression lz4  ssh://username@remote_ip/~/my_backup::2023_02_22_0219 ~/my_project/assets</span><br></pre></td></tr></table></figure><h3 id="é€éé‡‘é‘°æˆæ¬Šï¼Œé¿å…æ¯æ¬¡è¼¸å…¥ç•°åœ°æ©Ÿå™¨çš„å¯†ç¢¼æ–¹å¼"><a href="#é€éé‡‘é‘°æˆæ¬Šï¼Œé¿å…æ¯æ¬¡è¼¸å…¥ç•°åœ°æ©Ÿå™¨çš„å¯†ç¢¼æ–¹å¼" class="headerlink" title="é€éé‡‘é‘°æˆæ¬Šï¼Œé¿å…æ¯æ¬¡è¼¸å…¥ç•°åœ°æ©Ÿå™¨çš„å¯†ç¢¼æ–¹å¼"></a>é€éé‡‘é‘°æˆæ¬Šï¼Œé¿å…æ¯æ¬¡è¼¸å…¥ç•°åœ°æ©Ÿå™¨çš„å¯†ç¢¼æ–¹å¼</h3><p>é€éä¸Šè¿°å¯¦ä½œæœƒç™¼ç¾æ¯æ¬¡å‚™ä»½éƒ½éœ€è¦è¼¸å…¥ç™»å…¥çš„å¯†ç¢¼ï¼Œä»¥ä¸‹é€éé‡‘é‘°æˆæ¬Šä¾†çœç•¥æ­¤æ­¥é©Ÿ<br>å¦å¤–è‹¥è¦å¯¦æ–½è‡ªå‹•åŒ–å‚™ä»½å¿…ç„¶ä¸èƒ½æœ‰æ‰‹å‹•è¼¸å…¥å¯†ç¢¼çš„æ­¥é©Ÿ</p><h4 id="å»ºç«‹ssh-key"><a href="#å»ºç«‹ssh-key" class="headerlink" title="å»ºç«‹ssh key"></a>å»ºç«‹ssh key</h4><p>ä¸‹æ–¹æŒ‡ä»¤å°‡ç”¢ç”Ÿä¸€çµ„ssh keyï¼Œæœƒæœ‰ä¸€äº›å•ç­”äº’å‹•ï¼ŒåŸºæœ¬ä¸Šé»˜èªå³å¯ (è‹¥è¦æ›´å®‰å…¨é», å¯ä»¥è¨­ç½®)</p><p>å»ºç«‹å¾Œçš„é‡‘é‘°ä½ç½®æœƒåœ¨ä½ ç•¶å‰ä½¿ç”¨è€…çš„å®¶ç›®éŒ„/.sshç›®éŒ„åº•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ssh-copy-idæ–¹å¼æˆäºˆé ç«¯ä¼ºæœå™¨é‡‘é‘°"><a href="#ä½¿ç”¨ssh-copy-idæ–¹å¼æˆäºˆé ç«¯ä¼ºæœå™¨é‡‘é‘°" class="headerlink" title="ä½¿ç”¨ssh-copy-idæ–¹å¼æˆäºˆé ç«¯ä¼ºæœå™¨é‡‘é‘°"></a>ä½¿ç”¨ssh-copy-idæ–¹å¼æˆäºˆé ç«¯ä¼ºæœå™¨é‡‘é‘°</h4><p>ssh-copy-idå¯ä»¥è·Ÿé ç«¯ä¼ºæœå™¨èªªé€™å€‹é‡‘é‘°æ˜¯ä»¥å¾Œç™»å…¥ç”¨çš„, è€Œé ç«¯ä¼ºæœå™¨å°±æœƒå°‡æ­¤é‡‘é‘°å¯«å…¥è‡³authorized_keysæª”æ¡ˆä¸­<br>authorized_keysæª”æ¡ˆç´€éŒ„å¯ä»¥å­˜å–çš„ä½¿ç”¨è€…å…¬é–‹é‡‘é‘°<br>è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å¾Œï¼Œæœƒè¦æ±‚è¼¸å…¥é ç«¯ç™»å…¥å¯†ç¢¼ï¼Œç¢ºèªä½ æœ‰æ¬Šé™ç™»å…¥<br>è‹¥æˆåŠŸæœƒæç¤ºèªªå¯ä»¥ç”¨ ssh username@remote_ip  æ–¹å¼ç™»å…¥ï¼Œè€Œä¸”ç„¡é ˆè¼¸å…¥å¯†ç¢¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id username@remote_ip </span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨sshç™»å…¥ç¢ºèªå¯ç„¡å¯†ç¢¼è¼¸å…¥ç™»å…¥"><a href="#ä½¿ç”¨sshç™»å…¥ç¢ºèªå¯ç„¡å¯†ç¢¼è¼¸å…¥ç™»å…¥" class="headerlink" title="ä½¿ç”¨sshç™»å…¥ç¢ºèªå¯ç„¡å¯†ç¢¼è¼¸å…¥ç™»å…¥"></a>ä½¿ç”¨sshç™»å…¥ç¢ºèªå¯ç„¡å¯†ç¢¼è¼¸å…¥ç™»å…¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@remote_ip</span><br></pre></td></tr></table></figure><div class="note info flat"><p>è‹¥ä¼ºæœå™¨æœªå®‰è£openssh-serveréœ€å®‰è£</p></div><h2 id="è‡ªå‹•åŒ–å‚™ä»½"><a href="#è‡ªå‹•åŒ–å‚™ä»½" class="headerlink" title="è‡ªå‹•åŒ–å‚™ä»½"></a>è‡ªå‹•åŒ–å‚™ä»½</h2><p>åœ¨Linuxä¸Šæˆ‘å€‘å¯ä»¥æ‡‰ç”¨crontabè¨­ç½®å®šæ™‚ä»»å‹™ä¾†é”åˆ°è‡ªå‹•åŒ–çš„æ•ˆæœ</p><p>åœ¨é€™ä¹‹å‰ï¼Œborg github repoä¸Šæœ‰çµ¦äºˆä¸€å€‹è‡ªå‹•åŒ–å‚™ä»½çš„sample shell script<br><a href="https://github.com/borgbackup/borg/blob/master/docs/quickstart.rst">https://github.com/borgbackup/borg/blob/master/docs/quickstart.rst</a><br>é€™å€‹shell scriptå¯ä»¥åˆ†ç‚ºå¹¾é»ä¾†çœ‹</p><ol><li>å‚™ä»½å€ç›®éŒ„è¨­å®šï¼šborgé€éç’°å¢ƒè®Šæ•¸æ–¹å¼ï¼Œåªè¦è¨­å®šå¥½BORG_REPOå°±å¯ä»¥çœå»æ“ä½œæŒ‡ä»¤æ™‚çš„è¼¸å…¥</li><li>å‚™ä»½å€å¯†èªè¨­å®šï¼šborgé€éç’°å¢ƒè®Šæ•¸æ–¹å¼ï¼Œåªè¦è¨­å®šå¥½BORG_PASSPHRASEå°±å¯ä»¥çœå»éœ€è¦è¼¸å…¥å¯†èªçš„æ­¥é©Ÿ</li><li>å‚™ä»½å»ºç«‹æŒ‡ä»¤ï¼šå°±æ˜¯æˆ‘å€‘ä¸»è¦çš„å‚™ä»½å‹•ä½œ</li><li>å‚™ä»½æ­¸æª”å‰ªææŒ‡ä»¤ï¼šæ¯æ¬¡å‚™ä»½å®Œå¾Œï¼Œå¯ä»¥é€²è¡Œå‰ªæä¾†ç¸®æ¸›å‚™ä»½å ç”¨çš„ç©ºé–“</li><li>å‚™ä»½å£“ç¸®æŒ‡ä»¤ï¼šå¯ä»¥ç•¶ä½œæ˜¯å„ªåŒ–å„²å­˜å£“ç¸®çš„ç©ºé–“ï¼Œå°‡é‡è¤‡çš„è³‡æ–™é‡æ–°çµ„ç¹”é”åˆ°æ›´å¥½çš„å£“ç¸®èˆ‡å„²å­˜æ•ˆæœ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Setting this, so the repo does not need to be given on the commandline:</span></span><br><span class="line">export BORG_REPO=ssh://username@example.com:2022/~/backup/main</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> See the section <span class="string">&quot;Passphrase notes&quot;</span> <span class="keyword">for</span> more infos.</span></span><br><span class="line">export BORG_PASSPHRASE=&#x27;XYZl0ngandsecurepa_55_phrasea&amp;&amp;123&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> some helpers and error handling:</span></span><br><span class="line">info() &#123; printf &quot;\n%s %s\n\n&quot; &quot;$( date )&quot; &quot;$*&quot; &gt;&amp;2; &#125;</span><br><span class="line">trap &#x27;echo $( date ) Backup interrupted &gt;&amp;2; exit 2&#x27; INT TERM</span><br><span class="line"></span><br><span class="line">info &quot;Starting backup&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Back up the most important directories into an archive named after</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the machine this script is currently running on:</span></span><br><span class="line"></span><br><span class="line">borg create                         \</span><br><span class="line">    --verbose                       \</span><br><span class="line">    --filter AME                    \</span><br><span class="line">    --list                          \</span><br><span class="line">    --stats                         \</span><br><span class="line">    --show-rc                       \</span><br><span class="line">    --compression lz4               \</span><br><span class="line">    --exclude-caches                \</span><br><span class="line">    --exclude &#x27;home/*/.cache/*&#x27;     \</span><br><span class="line">    --exclude &#x27;var/tmp/*&#x27;           \</span><br><span class="line">                                    \</span><br><span class="line">    ::&#x27;&#123;hostname&#125;-&#123;now&#125;&#x27;              \</span><br><span class="line">    /etc                            \</span><br><span class="line">    /home                           \</span><br><span class="line">    /root                           \</span><br><span class="line">    /var</span><br><span class="line"></span><br><span class="line">backup_exit=$?</span><br><span class="line"></span><br><span class="line">info &quot;Pruning repository&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use the `prune` subcommand to maintain 7 daily, 4 weekly and 6 monthly</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> archives of THIS machine. The <span class="string">&#x27;&#123;hostname&#125;-*&#x27;</span> globbing is very important to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> prune<span class="string">&#x27;s operation to this machine&#x27;</span>s archives and not apply to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> other machines<span class="string">&#x27; archives also:</span></span></span><br><span class="line"></span><br><span class="line">borg prune                              \</span><br><span class="line">    --list                              \</span><br><span class="line">    --glob-archives &#x27;&#123;hostname&#125;-*&#x27;  \</span><br><span class="line">    --show-rc                           \</span><br><span class="line">    --keep-daily    7                   \</span><br><span class="line">    --keep-weekly   4                   \</span><br><span class="line">    --keep-monthly  6</span><br><span class="line"></span><br><span class="line">prune_exit=$?</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> actually free repo disk space by compacting segments</span></span></span><br><span class="line"></span><br><span class="line">info &quot;Compacting repository&quot;</span><br><span class="line"></span><br><span class="line">borg compact</span><br><span class="line"></span><br><span class="line">compact_exit=$?</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> use highest exit code as global exit code</span></span></span><br><span class="line">global_exit=$(( backup_exit &gt; prune_exit ? backup_exit : prune_exit ))</span><br><span class="line">global_exit=$(( compact_exit &gt; global_exit ? compact_exit : global_exit ))</span><br><span class="line"></span><br><span class="line">if [ $&#123;global_exit&#125; -eq 0 ]; then</span><br><span class="line">    info &quot;Backup, Prune, and Compact finished successfully&quot;</span><br><span class="line">elif [ $&#123;global_exit&#125; -eq 1 ]; then</span><br><span class="line">    info &quot;Backup, Prune, and/or Compact finished with warnings&quot;</span><br><span class="line">else</span><br><span class="line">    info &quot;Backup, Prune, and/or Compact finished with errors&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">exit $&#123;global_exit&#125;</span><br></pre></td></tr></table></figure><h3 id="å»ºç«‹å‚™ä»½è…³æœ¬Shell-script"><a href="#å»ºç«‹å‚™ä»½è…³æœ¬Shell-script" class="headerlink" title="å»ºç«‹å‚™ä»½è…³æœ¬Shell script"></a>å»ºç«‹å‚™ä»½è…³æœ¬Shell script</h3><p>å°‡ä»¥ä¸Šç¨‹å¼ç¢¼è²¼ä¸Šå§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/auto_backup.sh</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ ç¨‹å¼ç¢¼ä¸­éœ€æ›´æ”¹éƒ¨åˆ†æœ‰</p><ol><li>BORG_REPO (éœ€è¦å¡«å¯«æ¬²å­˜æ”¾å‚™ä»½è³‡æ–™çš„ç›®éŒ„ï¼Œä¹Ÿå°±æ˜¯borg initçš„åœ°æ–¹)</li><li>BORG_PASSPHRASE (éœ€å¡«å¯«borg initæ™‚çš„å¯†èªï¼Œé€™æ¨£æ‰æœ‰æ¬Šé™åŸ·è¡Œ)</li><li>borg create æ™‚éœ€è¦çš„å‚™ä»½ç›®éŒ„è·¯å¾‘ (ç¯„ä¾‹ä¸­æ˜¯å‚™ä»½/homeã€/rootã€/varç›®éŒ„)</li><li>borg prune æ™‚éœ€è¦çš„å‰ªæè¨­å®š (ä¾‹å¦‚æƒ³è¦ä¿ç•™å¹´ä»½çš„å‚™ä»½)</li></ol></div><h3 id="è¨­å®šCrontabå®šæ™‚ä»»å‹™"><a href="#è¨­å®šCrontabå®šæ™‚ä»»å‹™" class="headerlink" title="è¨­å®šCrontabå®šæ™‚ä»»å‹™"></a>è¨­å®šCrontabå®šæ™‚ä»»å‹™</h3><p>è‹¥æˆ‘å€‘å¸Œæœ›æ¯æ—¥23:30åŸ·è¡Œé€™å€‹auto_backup.shçš„è©±ï¼Œå¦‚ä»¥ä¸‹æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 23 * * * ~/auto_backup.sh &gt;&gt; ~/auto_backup.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>ğŸ’¡ è‹¥è¦æŸ¥çœ‹æ˜¯å¦æœ‰é †åˆ©å‚™ä»½å¯å‰å¾€auto_backup.logæŸ¥çœ‹ï¼Œé€™é‚Šçš„è¨­ç½®å°‡å‚™ä»½çš„æ“ä½œoutputåˆ°logæª”æ¡ˆä¸­ï¼Œè‹¥æœ‰éŒ¯èª¤ä¹Ÿå¯ä»¥çœ‹åˆ°</p><p>â€» 2&gt;&amp;1Â æ„æ€æ˜¯æŠŠ æ¨™æº–éŒ¯èª¤è¼¸å‡º é‡å®šå‘åˆ° æ¨™æº–è¼¸å‡º</p></div><h2 id="å…¶ä»–æŒ‡ä»¤ä»‹ç´¹"><a href="#å…¶ä»–æŒ‡ä»¤ä»‹ç´¹" class="headerlink" title="å…¶ä»–æŒ‡ä»¤ä»‹ç´¹"></a>å…¶ä»–æŒ‡ä»¤ä»‹ç´¹</h2><h3 id="æ¯”è¼ƒæ­¸æª”å·®ç•°æ€§"><a href="#æ¯”è¼ƒæ­¸æª”å·®ç•°æ€§" class="headerlink" title="æ¯”è¼ƒæ­¸æª”å·®ç•°æ€§"></a>æ¯”è¼ƒæ­¸æª”å·®ç•°æ€§</h3><p>å¦‚æœæƒ³çŸ¥é“Aç‰ˆè·ŸBç‰ˆå¤šäº†ä»€éº¼æª”æ¡ˆæˆ–è€…å°‘äº†ç”šéº¼æª”æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨å·²ä¸‹æŒ‡ä»¤äº†è§£<br>å…ˆå¯«çš„æ˜¯åŸºæº–, å¦‚ä¸‹æ¨™ç±¤1æ˜¯åŸºæº–, æ‰€ä»¥æ¨™ç±¤2å¤šæª”æ¡ˆ, æœƒé¡¯ç¤ºå¤šäº†XXæª”æ¡ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg diff &lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;::&lt;æ¨™ç±¤1&gt; &lt;æ¨™ç±¤2&gt;</span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg diff ~/my_backup::2023_02_22_0219 2023_02_23_0219</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹åœ–é¡¯ç¤ºæ¯”è¼ƒæ­¸æª”å·®ç•°æ€§<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/borg-diff.jpg" alt="Untitled"></p><h3 id="æ¢å¾©è³‡æ–™"><a href="#æ¢å¾©è³‡æ–™" class="headerlink" title="æ¢å¾©è³‡æ–™"></a>æ¢å¾©è³‡æ–™</h3><p>å¦‚æœå› ç‚ºæ„å¤–å› ç´ å°è‡´ï¼ŒæŸäº›è³‡æ–™æå£ç„¡æ³•è®€å–æƒ…å½¢ï¼Œæ­¤æ™‚å¯ä»¥è€ƒæ…®æ¢å¾©éå»è³‡æ–™</p><p><strong>â€»é‚„åŸåˆ°ç•¶å‰ç›®éŒ„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">borg extract &lt;å‚™ä»½è³‡æ–™å­˜æ”¾çš„ç›®éŒ„&gt;::&lt;æ¨™ç±¤&gt; </span><br><span class="line"><span class="comment"># èˆ‰ä¾‹</span></span><br><span class="line">borg extract ~/my_backup::2023_02_22_0219 </span><br></pre></td></tr></table></figure><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>æœ¬ç¯‡å¤§è‡´æ•˜è¿°äº†borgå‚™ä»½å·¥å…·çš„ä½¿ç”¨ï¼Œè‡ªå‹•åŒ–ç•°åœ°å‚™ä»½ä½¿è³‡æ–™ä¸æœƒæ”¾åœ¨åŒä¸€å€‹ç±ƒå­ä¸Šè€Œæ¯€å£ï¼Œå¤§å¹…å¢åŠ ç½é›£æ¢å¾©çš„èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œåœ¨ç½é›£æ¢å¾©ä¸­æœ‰è‘—2å€‹é—œéµçš„æŒ‡æ¨™RTO (Recovery Time Objective, å¾©åŸæ™‚é–“ç›®æ¨™)å’ŒRPO (Recovery Point Objective, å¾©åŸé»ç›®æ¨™)ï¼ŒæœŸæœ›å¾©åŸé»ç›®æ¨™è¶Šè¿‘ï¼Œå‚™ä»½çš„é »ç‡å°±ç›¸å°é«˜ï¼Œè€ŒæœŸæœ›å¾©åŸæ™‚é–“ç›®æ¨™è¶Šå¿«å‰‡éœ€è¦æ›´å¿«é€Ÿçš„æ•…éšœè½‰ç§»(failover)ç­–ç•¥ã€‚é™¤äº†Backup and Restoreï¼ŒPilot Lightã€Warm Standbyã€Multi-siteäº¦æ˜¯æœªä¾†å¯ç ”ç©¶çš„æ–¹å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Backup </tag>
            
            <tag> Disaster Recovery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins Pluginæ’ä»¶é–‹ç™¼å…¥é–€</title>
      <link href="/posts/Jenkins%20Plugin%E6%8F%92%E4%BB%B6%E9%96%8B%E7%99%BC%E5%85%A5%E9%96%80/"/>
      <url>/posts/Jenkins%20Plugin%E6%8F%92%E4%BB%B6%E9%96%8B%E7%99%BC%E5%85%A5%E9%96%80/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>DevOpsæ˜¯ä¸€ç¨®è»Ÿé«”é–‹ç™¼æ–¹æ³•è«–ï¼Œæ—¨åœ¨åŠ é€Ÿè»Ÿé«”ç”Ÿå‘½é€±æœŸï¼Œå¾è¨­è¨ˆåˆ°äº¤ä»˜ï¼Œä¸¦é€éæŒçºŒé›†æˆã€æŒçºŒäº¤ä»˜ã€æŒçºŒç›£æ§ä¾†æé«˜è»Ÿé«”è³ªé‡ã€‚é€éæŒçºŒé›†æˆå’ŒæŒçºŒäº¤ä»˜å¯¦ç¾å¿«é€Ÿã€å¯é åœ°å°‡è»Ÿé«”éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒã€‚</p><p>è€ŒJenkins æ˜¯ä¸€ç¨®ç”¨æ–¼è‡ªå‹•åŒ–æ§‹å»ºå’Œæ¸¬è©¦çš„è»Ÿä»¶å·¥å…·ã€‚å®ƒé€šå¸¸ç”¨æ–¼æŒçºŒé›†æˆå’ŒæŒçºŒäº¤ä»˜æµç¨‹ä¸­ï¼Œå¯ä»¥è‡ªå‹•åŸ·è¡Œç¨‹åºæ§‹å»ºã€æ¸¬è©¦å’Œéƒ¨ç½²ä»»å‹™ã€‚ä½¿ç”¨ Jenkins å¯ä»¥æ¸›å°‘äººç‚ºå¹²é ï¼Œæé«˜æ‡‰ç”¨ç¨‹åºçš„å“è³ªå’Œå¯ç”¨æ€§ã€‚å®ƒé‚„å¯ä»¥é€šéç›£æ§é …ç›®çš„æ§‹å»ºç‹€æ…‹ï¼Œæä¾›å³æ™‚åé¥‹å’Œå ±å‘Šã€‚</p><p>Jenkinsæä¾›Jenkins Pluginçš„æ–¹å¼ä½¿é–‹ç™¼è€…å¯ä»¥é–‹ç™¼éœ€è¦çš„ç¨‹å¼ä»¥æ“´å……è‡³å»ºç½®æµç¨‹ä¸­ï¼Œæ»¿è¶³åœ˜éšŠå°ˆæ¡ˆåœ¨æŒçºŒæ•´åˆæœŸé–“çš„éœ€æ±‚ã€‚</p><div class="note info flat"><p>ç”±æ–¼ç•¶åˆåœ¨æ‰¾Jenkins Pluginæ•™å­¸æ™‚ï¼Œç™¼ç¾å®˜æ–¹è³‡æ–™éå¸¸ç¨€å°‘ï¼Œå¾Œä¾†å¾—çŸ¥å®˜æ–¹æ•™å­¸çš„ç¶²åŸŸæœ‰æ”¹ï¼Œä¹‹å‰çš„æ–‡ç« éƒ½ç„¡æ³•Acessäº†<br>åƒé‡åˆ°æ­¤ç¨®æƒ…æ³ï¼Œç•¶æ™‚å¾ˆæ©Ÿéˆçš„æ‹¿å»ç¶²ç«™æ™‚å…‰æ©Ÿè©¦è©¦çœ‹ï¼Œæ²’æƒ³åˆ°é‚„çœŸæœ‰è³‡æ–™ã€‚ä¸éç¶²ç«™æ™‚å…‰æ©Ÿè¨ªå•æ™‚æœ‰äº›ç·©æ…¢å°±æ˜¯äº†ï¼Œé€™æ˜¯ä¸€å€‹å°ç¼ºé»</p></div><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>å®‰è£Java JDK 8</li><li>å®‰è£Maven</li><li>è¨­å®šç’°å¢ƒè®Šæ•¸</li></ul></li><li>ä½¿ç”¨æ’ä»¶ç¯„æœ¬å»ºç«‹å°ˆæ¡ˆã€æ¸¬è©¦é‹è¡Œèˆ‡ç™¼ä½ˆæ‰“åŒ…<ul><li>ä½¿ç”¨æ¨£æœ¬æ’ä»¶åŸå‹å»ºç«‹å°ˆæ¡ˆçµæ§‹</li><li>ç¢ºèªå¯ä»¥å»ºæ§‹å°ˆæ¡ˆ</li><li>é‹è¡Œæ’ä»¶</li><li>åœ¨Jenkinsä¸Šæ¸¬è©¦ç¯„æœ¬æ’ä»¶</li><li>ç™¼ä½ˆæ‰“åŒ…æ’ä»¶</li></ul></li><li>Pluginçµæ§‹èˆ‡Javaèˆ‡Jellyçš„é—œè¯èªªæ˜<ul><li>ç©ºç™½æ’ä»¶å°ˆæ¡ˆçµæ§‹</li><li>Jenkins é€šéå›ºå®šçš„å‘½åæ–¹å¼ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ</li><li>æ’°å¯«javaèˆ‡jellyæºé€šè®Šæ•¸(ç‰©ä»¶å¸¶æœ‰Descriptors)</li></ul></li><li>Jenkins BuildStepåŠŸèƒ½<ul><li>è¡¨å–®é©—è­‰æ©Ÿåˆ¶</li><li>æ’°å¯«åŸ·è¡Œå…§å®¹ &amp; å–å¾—Workspace(è®€æª”ã€å¯«æª”)</li></ul></li><li>äº†è§£Jelly Tags<ul><li>Jelly namespace</li><li>ä¸€èˆ¬æ–‡å­—(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)</li><li>å¹«åŠ©èªªæ˜(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)</li><li>é è¨­æ•¸å€¼(Default value)</li><li>Jelly ä¸­ä½¿ç”¨è®Šæ•¸è³‡æ–™</li><li>å…¨åŸŸç’°å¢ƒè®Šæ•¸è¨­ç½®</li></ul></li><li>å»ºç½®å ±å‘Šç¨ç«‹é é¢<ul><li>å»ºç«‹HelloWorldAction.javaä»¥å¯¦ä½œRunAction2</li><li>ç¨ç«‹é é¢UIè¨­ç½®</li><li>åœ¨BuilderåŸ·è¡ŒActionä»¥è§¸ç™¼é é¢ç”Ÿæˆ</li></ul></li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><h3 id="å®‰è£Java-JDK-8"><a href="#å®‰è£Java-JDK-8" class="headerlink" title="å®‰è£Java JDK 8"></a>å®‰è£Java JDK 8</h3><p>Jenkinsæ˜¯åŸºæ–¼Javaå»ºæ§‹çš„ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å…ˆå®‰è£Java é–‹ç™¼å¥—ä»¶(JDK)</p><div class="note info flat"><p>è‹¥æœ‰é¡å¤–éœ€æ±‚å¯æŸ¥çœ‹Jenkinså°å„å€‹Javaç‰ˆæœ¬æ”¯æ´ï¼š<br><a href="https://www.jenkins.io/doc/administration/requirements/java/">https://www.jenkins.io/doc/administration/requirements/java/</a></p></div><h3 id="å®‰è£Maven"><a href="#å®‰è£Maven" class="headerlink" title="å®‰è£Maven"></a>å®‰è£Maven</h3><p>Jenkinsæ’ä»¶ä¸»è¦ä½¿ç”¨Mavenå»ºç½®<br>ç‰ˆæœ¬æ³¨æ„ï¼Œè«‹ç¢ºä¿æä¾›æœ€è¿‘ç‰ˆæœ¬çš„ Maven 3ï¼Œæœ€å¥½æ˜¯ 3.3.9 æˆ–è¼ƒæ–°ç‰ˆæœ¬</p><h3 id="è¨­å®šç’°å¢ƒè®Šæ•¸"><a href="#è¨­å®šç’°å¢ƒè®Šæ•¸" class="headerlink" title="è¨­å®šç’°å¢ƒè®Šæ•¸"></a>è¨­å®šç’°å¢ƒè®Šæ•¸</h3><ol><li>PATHï¼š<ol><li>C:\Program Files\Java\jdk1.8.0_202\bin</li><li>C:\apache-maven-3.8.3\bin</li></ol></li><li>JAVA_HOMEï¼šC:\Program Files\Java\jdk1.8.0_202</li></ol><h2 id="ä½¿ç”¨æ’ä»¶ç¯„æœ¬å»ºç«‹å°ˆæ¡ˆã€æ¸¬è©¦é‹è¡Œèˆ‡ç™¼ä½ˆæ‰“åŒ…"><a href="#ä½¿ç”¨æ’ä»¶ç¯„æœ¬å»ºç«‹å°ˆæ¡ˆã€æ¸¬è©¦é‹è¡Œèˆ‡ç™¼ä½ˆæ‰“åŒ…" class="headerlink" title="ä½¿ç”¨æ’ä»¶ç¯„æœ¬å»ºç«‹å°ˆæ¡ˆã€æ¸¬è©¦é‹è¡Œèˆ‡ç™¼ä½ˆæ‰“åŒ…"></a>ä½¿ç”¨æ’ä»¶ç¯„æœ¬å»ºç«‹å°ˆæ¡ˆã€æ¸¬è©¦é‹è¡Œèˆ‡ç™¼ä½ˆæ‰“åŒ…</h2><h3 id="ä½¿ç”¨æ¨£æœ¬æ’ä»¶åŸå‹å»ºç«‹å°ˆæ¡ˆçµæ§‹"><a href="#ä½¿ç”¨æ¨£æœ¬æ’ä»¶åŸå‹å»ºç«‹å°ˆæ¡ˆçµæ§‹" class="headerlink" title="ä½¿ç”¨æ¨£æœ¬æ’ä»¶åŸå‹å»ºç«‹å°ˆæ¡ˆçµæ§‹"></a>ä½¿ç”¨æ¨£æœ¬æ’ä»¶åŸå‹å»ºç«‹å°ˆæ¡ˆçµæ§‹</h3><p>åœ¨æˆ‘å€‘çš„workspaceæ‰“é–‹terminalåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -U archetype:generate -Dfilter=<span class="string">&quot;io.jenkins.archetypes:&quot;</span></span><br></pre></td></tr></table></figure><p>é€éä¸Šè¿°æŒ‡ä»¤æœƒåˆ—å‡ºç¬¦åˆæ¢ä»¶çš„å¹¾å€‹é ç«¯repoè®“æˆ‘å€‘é¸æ“‡ï¼Œæ¥è‘—å¯ä»¥é¸æ“‡æ’ä»¶ç‰ˆæœ¬ã€artifactIdç­‰å°ˆæ¡ˆå±¬æ€§</p><div class="note info flat"><p>ğŸ’¡ åƒæ•¸ä»‹ç´¹<br><strong><code>-U,--update-snapshots</code> å¼·åˆ¶æª¢æŸ¥èˆ‡é ç«¯å­˜å„²åº«çš„ç¼ºå¤±ç‰ˆæœ¬å’Œæ›´æ–°å¿«ç…§<br><code>archetype:generate</code> å¾åŸå‹ç”Ÿæˆä¸€å€‹æ–°çš„å°ˆæ¡ˆï¼Œå¦‚æœä½¿ç”¨éƒ¨åˆ†åŸå‹ï¼Œå‰‡æ›´æ–°ç•¶å‰å°ˆæ¡ˆã€‚<br><code>-D,--define</code> å®šç¾©ç³»çµ±å±¬æ€§<br><code>-filter</code> è¨­å®šéæ¿¾</strong></p></div><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-1.png" alt="Untitled"></p><h3 id="ç¢ºèªå¯ä»¥å»ºæ§‹å°ˆæ¡ˆ"><a href="#ç¢ºèªå¯ä»¥å»ºæ§‹å°ˆæ¡ˆ" class="headerlink" title="ç¢ºèªå¯ä»¥å»ºæ§‹å°ˆæ¡ˆ"></a>ç¢ºèªå¯ä»¥å»ºæ§‹å°ˆæ¡ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv demo demo-plugin </span><br><span class="line"><span class="built_in">cd</span> demo-plugin</span><br><span class="line">mvn verify</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ <code>verify</code> é©—è­‰æª”æ¡ˆpackageæ˜¯å¦æ­£ç¢º<br>åœ¨éç¨‹ä¸­æœƒä¾ç…§mavençš„ç”Ÿå‘½é€±æœŸä¾åºåŸ·è¡Œï¼Œå…¶ä¸­æœƒä¸‹è¼‰è¨±å¤šçš„dependenciesã€åˆ†ææ¸¬è©¦ï¼Œæœ€å¾Œé©—è­‰ï¼Œé æœŸçµæœæœ€å¾Œå¦‚ä¸‹åœ–</p></div><h3 id="é‹è¡Œæ’ä»¶"><a href="#é‹è¡Œæ’ä»¶" class="headerlink" title="é‹è¡Œæ’ä»¶"></a>é‹è¡Œæ’ä»¶</h3><p><strong>maven-hpi-plugin</strong>å¹«æˆ‘å€‘è™•ç†å»ºæ§‹å’Œæ‰“åŒ…jenkins pluginï¼Œä»–é‚„æä¾›äº†ä¾¿åˆ©çš„æ–¹å¼åŸ·è¡ŒJenkins instance(å«æœ‰æˆ‘å€‘çš„æ’ä»¶)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn hpi:run</span><br></pre></td></tr></table></figure><p>ç•¶çœ‹åˆ°ğŸ’¡ <code>INFO: Jenkins is fully up and running</code>æ™‚è¡¨ç¤ºJenkins instanceæˆåŠŸå•Ÿå‹•å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥æ‰“é–‹ç€è¦½å™¨è¨ªå•<a href="http://localhost:8080/jenkins/">http://localhost:8080/jenkins/</a> ç«‹å³æ¸¬è©¦æ’ä»¶</p><div class="note info flat"><p>ğŸ’¡ æˆ‘å€‘é‹è¡Œçš„Jenkins instanceï¼Œjenkins_homeå‰‡ç‚ºå°ˆæ¡ˆç›®éŒ„ä¸­çš„workè³‡æ–™å¤¾ï¼Œå› æ­¤è³‡æ–™éƒ½ä¿ç•™æ–¼é€™</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn hpi:run -Djetty.port=<span class="number">8090</span> # æ›´æ”¹port</span><br><span class="line">mvn hpi:run -Dhpi.prefix=/jenkins # Context path (ç’°å¢ƒè·¯å¾‘)</span><br></pre></td></tr></table></figure></div><h4 id="é—œæ–¼æ¸¬è©¦æ™‚æ›´æ”¹ç¨‹å¼ç¢¼"><a href="#é—œæ–¼æ¸¬è©¦æ™‚æ›´æ”¹ç¨‹å¼ç¢¼" class="headerlink" title="é—œæ–¼æ¸¬è©¦æ™‚æ›´æ”¹ç¨‹å¼ç¢¼"></a>é—œæ–¼æ¸¬è©¦æ™‚æ›´æ”¹ç¨‹å¼ç¢¼</h4><p>æ ¹æ“šä½ çš„æ›´æ”¹ï¼Œä½ å¯ä»¥åœ¨é‹è¡Œå¯¦ä¾‹ä¸­(running instance)çœ‹åˆ°ï¼Œè€Œä¸ç”¨é‡å•Ÿæ•´å€‹Maven Process</p><ul><li><strong>Views</strong>ï¼šæ¯ç•¶ç€è¦½å™¨è«‹æ±‚é é¢æ™‚ï¼Œéƒ½æœƒé‡æ–°ç·¨è­¯(re-compiled) Groovy/Jellyï¼Œå› æ­¤åªè¦é‡æ•´ç€è¦½å™¨ä¸­çš„é é¢å³å¯</li><li><strong>Java code</strong>ï¼š<ul><li>ç•¶ä½ åœ¨debugæ™‚ï¼Œåªè¦ä¸æ¥è§¸<strong>method signature</strong>ï¼ŒJVMçš„ç†±æ’æ‹”(HotSwap)åŠŸèƒ½å°‡æœƒå¹«æˆ‘å€‘é‡æ–°è¼‰å…¥ç¨‹å¼ç¢¼</li><li>æ­¤å¤–ï¼Œæˆ‘å€‘å¯ä»¥åœ¨Maven Processä¸­æŒ‰â€ENTERâ€éµï¼Œå°‡æœƒé‡æ–°è¼‰å…¥Jenkins webappã€‚ä½†é€šå¸¸æœ€å¥½æ˜¯åœæ­¢è©²Processä¸¦é‡æ–°å•Ÿå‹•</li></ul></li><li><strong>POM</strong>ï¼šå¦‚æœæ›´æ”¹ POMï¼Œå‰‡å¿…é ˆåœæ­¢ä¸¦é‡æ–°å•Ÿå‹• Maven æ‰èƒ½çœ‹åˆ°æ›´æ”¹</li></ul><h3 id="åœ¨Jenkinsä¸Šæ¸¬è©¦ç¯„æœ¬æ’ä»¶"><a href="#åœ¨Jenkinsä¸Šæ¸¬è©¦ç¯„æœ¬æ’ä»¶" class="headerlink" title="åœ¨Jenkinsä¸Šæ¸¬è©¦ç¯„æœ¬æ’ä»¶"></a>åœ¨Jenkinsä¸Šæ¸¬è©¦ç¯„æœ¬æ’ä»¶</h3><p>åœ¨ç¯„ä¾‹ä¸­æˆ‘å€‘ä½¿ç”¨hello-world-pluginçš„ç¯„æœ¬ï¼Œå› æ­¤åœ¨å°ˆæ¡ˆè¨­ç½®çš„â€å»ºç½®â€æµç¨‹ä¸­å¯ä»¥æ–°å¢â€Say Hello worldâ€é¸é …ï¼Œä¸¦ä¸”è¨­ç½®é¢æ¿ï¼Œå¦‚ä¸‹åœ–<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-2.png" alt="Untitled"></p><p>å»ºç½®å¾Œç•«é¢<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-3.png" alt="Untitled"></p><h3 id="ç™¼ä½ˆæ‰“åŒ…æ’ä»¶"><a href="#ç™¼ä½ˆæ‰“åŒ…æ’ä»¶" class="headerlink" title="ç™¼ä½ˆæ‰“åŒ…æ’ä»¶"></a>ç™¼ä½ˆæ‰“åŒ…æ’ä»¶</h3><p>å¦‚æœæƒ³è¦æ‰“åŒ…æˆ‘å€‘çš„æ’ä»¶ï¼Œåªè¦åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œè©²æŒ‡ä»¤å°‡æœƒåœ¨targetç›®éŒ„ä¸‹ç”¢ç”Ÿ<code>*.hpi</code>æª”æ¡ˆã€‚</p><p>â€»å…¶ä»–ç”¨æˆ¶å¯ä»¥åœ¨Jenkins Web UIå°‡æ­¤æ’ä»¶æª”æ¡ˆä¸Šå‚³ä½¿ç”¨ï¼Œæˆ–è€…å°‡æª”æ¡ˆæ”¾ç½®åœ¨<code>$JENKINS_HOME/plugins</code>ä¹Ÿå¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure><h2 id="Pluginçµæ§‹èˆ‡Javaèˆ‡Jellyçš„é—œè¯èªªæ˜"><a href="#Pluginçµæ§‹èˆ‡Javaèˆ‡Jellyçš„é—œè¯èªªæ˜" class="headerlink" title="Pluginçµæ§‹èˆ‡Javaèˆ‡Jellyçš„é—œè¯èªªæ˜"></a>Pluginçµæ§‹èˆ‡Javaèˆ‡Jellyçš„é—œè¯èªªæ˜</h2><h3 id="ç©ºç™½æ’ä»¶å°ˆæ¡ˆçµæ§‹"><a href="#ç©ºç™½æ’ä»¶å°ˆæ¡ˆçµæ§‹" class="headerlink" title="ç©ºç™½æ’ä»¶å°ˆæ¡ˆçµæ§‹"></a><strong>ç©ºç™½æ’ä»¶å°ˆæ¡ˆçµæ§‹</strong></h3><ul><li><code>src/main/java</code> ï¼šå¤–æ›çš„ Java åŸå§‹æª”</li><li><code>src/main/resources</code> ï¼šå¤–æ›çš„ Jelly æª”æ¡ˆ(ç”¨æ–¼UIã€Form)ã€configè¨­å®š(åœ‹éš›åŒ–/åœ¨åœ°åŒ–)</li><li><code>src/main/webapp</code> ï¼šå¤–æ›çš„éœæ…‹è³‡æºï¼Œå¦‚åœ–ç‰‡æˆ– HTLM ç­‰</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ .github <span class="comment"># èˆ‡è²¢ç»è‡³jenkins pluginä¸­ç›¸é—œæµç¨‹ </span></span><br><span class="line">â”œâ”€â”€ .mvn <span class="comment"># å®šç¾©å°ˆæ¡ˆè³‡è¨Š</span></span><br><span class="line">â”‚   â”œâ”€â”€ extensions.xml</span><br><span class="line">â”‚   â””â”€â”€ maven.config</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â”œâ”€â”€ main</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ java </span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ io </span><br><span class="line">â”‚   â”‚   â”‚       â””â”€â”€ jenkins</span><br><span class="line">â”‚   â”‚   â”‚           â””â”€â”€ plugins</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resources </span><br><span class="line">â”‚   â”‚       â””â”€â”€ index.jelly</span><br><span class="line">â”‚   â””â”€â”€ <span class="built_in">test</span> </span><br><span class="line">â”‚       â””â”€â”€ java </span><br><span class="line">â”‚           â””â”€â”€ io </span><br><span class="line">â”‚               â””â”€â”€ jenkins</span><br><span class="line">â”‚                   â””â”€â”€ plugins</span><br><span class="line">â”œâ”€â”€ Jenkinsfile</span><br><span class="line">â”œâ”€â”€ LICENSE.md</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â””â”€â”€ README.md</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Jenkins-é€šéå›ºå®šçš„å‘½åæ–¹å¼ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ"><a href="#Jenkins-é€šéå›ºå®šçš„å‘½åæ–¹å¼ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ" class="headerlink" title="Jenkins é€šéå›ºå®šçš„å‘½åæ–¹å¼ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ"></a><strong>Jenkins é€šéå›ºå®šçš„å‘½åæ–¹å¼ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ</strong></h3><p>Jenkins Pluginä¸­çš„UIå…§å®¹éƒ½ç”±Jellyä¾†è™•ç†ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆè®“Pluginä¸­çš„javaæª”èˆ‡ç›¸å°æ‡‰jellyæª”äº’å‹•ï¼Œåœ¨é€™è£¡Jenkinsé€é<strong>å›ºå®šçš„å‘½åæ–¹å¼è™•ç†ï¼Œä¾†ç¢ºå®šå°æ‡‰çš„æª”æ¡ˆ</strong></p><p>åœ¨ç¯„ä¾‹ä¸­æœ‰ä¸€å€‹ç¯„ä¾‹å…ƒä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘åœ¨å‰é¢å»ºç½®é¸æ“‡çš„Say hello worldï¼Œè©²å…ƒä»¶æ˜¯ç”±æ­¤<code>java\io\jenkins\plugins\sample\HelloWorldBuilder.java</code>  æ“´å……çš„</p><p><code>HelloWorldBuilder.java</code>æœƒæ’°å¯«ä½¿ç”¨çš„å»ºç½®æ“´å……é»ä»¥åŠé‹è¡Œçš„ç›¸é—œç¨‹å¼é‚è¼¯</p><p>è€Œè‹¥è¦æ’°å¯«UIæ–¹é¢çš„å…§å®¹å‰‡éœ€ï¼š</p><ol><li>é‚£æˆ‘å€‘å¿…é ˆåœ¨<code>resources</code>ç›®éŒ„ä¸‹å»ºç«‹ç›¸æ‡‰çš„è·¯å¾‘çš„è³‡æ–™å¤¾ <code>resources\io\jenkins\plugins\sample\HelloWorldBuilder</code></li><li>åœ¨è©²ç›®éŒ„ä¸‹å»ºç«‹<code>config.jelly</code><ol><li><code>resources\io\jenkins\plugins\sample\HelloWorldBuilder\config.jelly</code></li></ol></li></ol><div class="note info flat"><p>ğŸ’¡ é€šå¸¸UIå…§å®¹å¯ä»¥ç”¨ä¾†è®“ä½¿ç”¨è€…è¼¸å…¥ä¸€äº›è¨­å®šï¼Œä¾‹å¦‚è·¯å¾‘</p></div><h3 id="æ’°å¯«javaèˆ‡jellyæºé€šè®Šæ•¸-ç‰©ä»¶å¸¶æœ‰Descriptors"><a href="#æ’°å¯«javaèˆ‡jellyæºé€šè®Šæ•¸-ç‰©ä»¶å¸¶æœ‰Descriptors" class="headerlink" title="æ’°å¯«javaèˆ‡jellyæºé€šè®Šæ•¸(ç‰©ä»¶å¸¶æœ‰Descriptors)"></a>æ’°å¯«javaèˆ‡jellyæºé€šè®Šæ•¸(ç‰©ä»¶å¸¶æœ‰Descriptors)</h3><p>åœ¨ä¸Šè¿°æˆ‘å€‘äº†è§£æª”æ¡ˆjavaèˆ‡jellyå°æ‡‰æª”æ¡ˆçš„è¦å‰‡ï¼Œé‚£å…¶ä¸­çš„è®Šæ•¸æ¬„ä½å¦‚ä½•é…å°å‘¢?<br>åœ¨é€™è£¡æˆ‘å€‘å°‡èªªæ˜ç‰©ä»¶å¸¶æœ‰Descriptorsæƒ…æ³ä¸‹ï¼Œéœ€è¦å¯¦ä½œçš„å…§å®¹</p><div class="note info flat"><p>ğŸ’¡ Descriptorsæ˜¯æˆ‘å€‘åœ¨Build stepsä¸­æœƒéœ€è¦ä½¿ç”¨åˆ°çš„<br>Descriptorsåœ¨å¤šå€‹å¯¦ä¾‹çš„æŸå€‹æ“´å±•æœƒè¢«éœ€è¦</p></div><ol><li>Java<ol><li>å®šç¾©ä¸å¯è®Šé¡åˆ¥(immutable class)</li><li>å°‡ <code>@DataBoundConstructor</code> æ”¾åœ¨constructorä¸Šï¼Œå®ƒå°‡å‘Šè¨´ Jenkins å¦‚ä½•å¯¦ä¾‹åŒ–å®ƒ</li><li>ç‚ºéœ€è¦è¨­å®šçš„æ¬„ä½å®šç¾©gettersï¼Œæˆ–æ˜¯å°‡æ¬„ä½è¨­ç½®ç‚º<code>public final</code> ï¼Œé€™æ¨£å°‡å…è¨±Jenkinsè®€å–æ•¸å€¼ä»¥å¡«ç½®è¨­å®šé é¢(é€£åˆ°jelly)</li></ol> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span> <span class="keyword">implements</span> <span class="title">SimpleBuildStep</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> useFrench;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DataBoundConstructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldBuilder</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>Jelly<ol><li>æ’°å¯«Jellyç‰‡æ®µç¨‹å¼ç¢¼(é€šå¸¸å‘½åç‚º config.jelly)</li><li>@fieldç‚ºå±¬æ€§çš„åç¨±(å°æ‡‰constructor parameter name)â€¦é€™æ¨£jenkinsæ‰çŸ¥é“è¦å°‡è³‡æ–™mapåˆ°è©²æ¬„ä½</li></ol> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?jelly escape-by-default=&#x27;true&#x27;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">j:jelly</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;jelly:core&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:st</span>=<span class="string">&quot;jelly:stapler&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:d</span>=<span class="string">&quot;jelly:define&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:l</span>=<span class="string">&quot;/lib/layout&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:t</span>=<span class="string">&quot;/lib/hudson&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:f</span>=<span class="string">&quot;/lib/form&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%Name&#125;&quot;</span> <span class="attr">field</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">f:textbox</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:jelly</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Jenkins-BuildStepåŠŸèƒ½"><a href="#Jenkins-BuildStepåŠŸèƒ½" class="headerlink" title="Jenkins BuildStepåŠŸèƒ½"></a>Jenkins BuildStepåŠŸèƒ½</h2><h3 id="è¡¨å–®é©—è­‰æ©Ÿåˆ¶"><a href="#è¡¨å–®é©—è­‰æ©Ÿåˆ¶" class="headerlink" title="è¡¨å–®é©—è­‰æ©Ÿåˆ¶"></a><strong>è¡¨å–®é©—è­‰æ©Ÿåˆ¶</strong></h3><p>è‹¥æƒ³è¦ç‚ºæˆ‘å€‘çš„UIè¡¨å–®å¢åŠ é©—è­‰åŠŸèƒ½ä¹Ÿæ˜¯å¯ä»¥çš„</p><p>åœ¨<code>HelloWorldBuilder.java</code>çš„descriptorä¸­æˆ‘å€‘å¯ä»¥ä¾ç…§è¦å‰‡å¢åŠ methodï¼Œè®“jenkinsçŸ¥é“è©²æ¬„ä½éœ€è¦ç¶“éè©²methodé©—è­‰</p><p><strong>è¦å‰‡ï¼š</strong>methodåç¨±é ˆç‚º <strong>doCheckâ€FieldNameâ€</strong> â‡’ <code>doCheckName</code> ä¸”å›å‚³å‹æ…‹ç‚ºFormValidationï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Symbol(&quot;greet&quot;)</span></span><br><span class="line"><span class="meta">@Extension</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DescriptorImpl</span> <span class="keyword">extends</span> <span class="title">BuildStepDescriptor</span>&lt;<span class="title">Builder</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> FormValidation <span class="title">doCheckName</span><span class="params">(<span class="meta">@QueryParameter</span> String value, <span class="meta">@QueryParameter</span> <span class="keyword">boolean</span> useFrench)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (value.length() == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> FormValidation.error(Messages.HelloWorldBuilder_DescriptorImpl_errors_missingName());</span><br><span class="line">            <span class="keyword">if</span> (value.length() &lt; <span class="number">4</span>)</span><br><span class="line">                <span class="keyword">return</span> FormValidation.warning(Messages.HelloWorldBuilder_DescriptorImpl_warnings_tooShort());</span><br><span class="line">            <span class="keyword">if</span> (!useFrench &amp;&amp; value.matches(<span class="string">&quot;.*[Ã©Ã¡Ã Ã§].*&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> FormValidation.warning(Messages.HelloWorldBuilder_DescriptorImpl_warnings_reallyFrench());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> FormValidation.ok();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="FormValidationæä¾›æˆ‘å€‘ç°¡å–®æ˜“æ‡‚çš„åŠŸèƒ½ï¼š"><a href="#FormValidationæä¾›æˆ‘å€‘ç°¡å–®æ˜“æ‡‚çš„åŠŸèƒ½ï¼š" class="headerlink" title="FormValidationæä¾›æˆ‘å€‘ç°¡å–®æ˜“æ‡‚çš„åŠŸèƒ½ï¼š"></a>FormValidationæä¾›æˆ‘å€‘ç°¡å–®æ˜“æ‡‚çš„åŠŸèƒ½ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FormValidation.error(String message)</span><br><span class="line"></span><br><span class="line">FormValidation.warning(String message)</span><br><span class="line"></span><br><span class="line">FormValidation.ok()</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ æˆ‘å€‘é‚„å¯ä»¥ç”¨@QueryParameterå®šç¾©å…¶ä»–æ¬„ä½çš„åƒæ•¸ï¼Œå¦‚æœæˆ‘å€‘é€™æ®µmethodé‚„éœ€è¦å…¶ä»–åƒæ•¸ï¼Œé€™å°‡æœƒéå¸¸æœ‰ç”¨<br><strong>ä½¿ç”¨æ–¹å¼ï¼š</strong>å¢åŠ åƒæ•¸æ™‚ï¼Œåƒæ•¸åç¨±ç‚ºfieldåç¨±</p></div><div class="note warning flat"><p>ğŸ’¡ Jenkinsä½¿ç”¨Localizerç”ŸæˆMessages Classï¼Œèƒ½å¤ ä»¥é¡å‹å®‰å…¨çš„æ–¹å¼è¨ªå•Messageè³‡æºã€‚<br>æ‰€ä»¥src/main/resources/**/Messages.propertiesåŒ¹é…çš„æ‰€ä»¥æ–‡ä»¶éƒ½æœƒç”Ÿæˆä¸€å€‹å°æ‡‰çš„Messagesé¡åˆ¥<br>å› æ­¤ç¨‹å¼ç¢¼ä¸­èª¿ç”¨FormValidation.error()æ–¹æ³•çš„åƒæ•¸å…§å®¹å°±æ˜¯å¦‚æ­¤å–å¾—<br>é€éè©²æ–¹æ³•å¯ä»¥ç²å–ç•¶åœ°èªç³»åŒ–çš„æ¶ˆæ¯</p></div><h3 id="æ’°å¯«åŸ·è¡Œå…§å®¹-amp-å–å¾—Workspace-è®€æª”ã€å¯«æª”"><a href="#æ’°å¯«åŸ·è¡Œå…§å®¹-amp-å–å¾—Workspace-è®€æª”ã€å¯«æª”" class="headerlink" title="æ’°å¯«åŸ·è¡Œå…§å®¹ &amp; å–å¾—Workspace(è®€æª”ã€å¯«æª”)"></a>æ’°å¯«åŸ·è¡Œå…§å®¹ &amp; å–å¾—Workspace(è®€æª”ã€å¯«æª”)</h3><p>åœ¨Class ä¸­æˆ‘å€‘ implements <code>jenkins.tasks.SimpleBuildStep</code> é€™å€‹Interface Class,<br>å…¶ä¸­æˆ‘å€‘å¿…é ˆå¯¦ä½œ <code>perform</code> å‡½å¼ï¼Œè©²å‡½å¼æœƒç‚ºæˆ‘å€‘ â€œRun this step.â€ åœ¨è©²æ­¥é©ŸåŸ·è¡Œæˆ‘å€‘çš„pluginæƒ³åšçš„äº‹</p><div class="note info flat"><p>ğŸ’¡ <code>perform</code> å‡½å¼ä¸­æœ‰æä¾›è¨±å¤šåƒæ•¸ï¼Œ<code>FilePath workspace</code> å¯ä»¥è®“æˆ‘å€‘å–å¾—Workspaceçš„è·¯å¾‘ï¼Œæœ‰äº†è·¯å¾‘å¾Œæˆ‘å€‘å°±èƒ½è®€æª”ã€å¯«æª”å•¦<br><code>listener.getLogger().println()</code> å¯ä»¥å°‡å…§å®¹åœ¨jenkins consoleé¢æ¿å°å‡º<br><strong>ä»¥ä¸‹ç¨‹å¼ç¢¼å¯¦ä½œè®€æª”ã€èµ°è¨ªç›®éŒ„æ‰€æœ‰æª”æ¡ˆã€å¯«æª”</strong></p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">perform</span><span class="params">(Run&lt;?, ?&gt; run, FilePath workspace, EnvVars env, Launcher launcher, TaskListener listener)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        listener.getLogger().println(<span class="string">&quot;workspace path:&quot;</span> + workspace.getRemote());</span><br><span class="line">        </span><br><span class="line">        String filePath = workspace.getRemote() + <span class="string">&quot;\\Triangle.java&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// read file and for loop print line</span></span><br><span class="line">        <span class="keyword">try</span> (Stream&lt;String&gt; stream = Files.lines(Paths.get(filePath))) &#123;</span><br><span class="line">        stream.forEach(line -&gt; listener.getLogger().println(line));</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// walk for the directory all file </span></span><br><span class="line">        <span class="keyword">try</span> (Stream&lt;Path&gt; paths = Files.walk(Paths.get(workspace.getRemote()))) &#123;</span><br><span class="line">        paths</span><br><span class="line">            .filter(Files::isRegularFile)</span><br><span class="line">            .forEach(item -&gt; listener.getLogger().println(item));</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// write file</span></span><br><span class="line">        Path path = Paths.get(workspace.getRemote() + <span class="string">&quot;\\plugin-generate.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> doesFileExist = Files.exists(path, <span class="keyword">new</span> LinkOption[]&#123; LinkOption.NOFOLLOW_LINKS &#125;);</span><br><span class="line">        <span class="keyword">if</span>(!doesFileExist) &#123;</span><br><span class="line">        listener.getLogger().println(<span class="string">&quot;before write file.&quot;</span>);</span><br><span class="line">            List&lt;String&gt; lines = Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;jenkins&quot;</span>);</span><br><span class="line">            Files.write(Paths.get(workspace.getRemote() + <span class="string">&quot;\\plugin-generate.txt&quot;</span>), lines, StandardCharsets.UTF_8);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="äº†è§£Jelly-Tags"><a href="#äº†è§£Jelly-Tags" class="headerlink" title="äº†è§£Jelly Tags"></a>äº†è§£Jelly Tags</h2><p> jellyç¨‹å¼æª”ç”±è¨±å¤šä¸åŒçš„ jelly æ¨™ç±¤çµ„æˆã€‚Jenkins ä¸»è¦æ˜¯ç”¨ Jelly ä¾†é€²è¡Œ UI ç®¡ç†ã€‚è€Œ Jelly UI æŠ€è¡“çš„ä¸»è¦åŸç†æ˜¯é€šéä¼ºæœå™¨ç«¯çš„æ¸²æŸ“å¼•æ“å°‡ Jelly å®šç¾©å¥½çš„ XML æª”æ¡ˆæ¸²æŸ“æˆç”¨æˆ¶ç«¯éœ€è¦çš„ HTMLï¼ŒJavascript å’Œ Ajax ç­‰ã€‚</p><h3 id="Jelly-namespace"><a href="#Jelly-namespace" class="headerlink" title="Jelly namespace"></a>Jelly namespace</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?jelly escape-by-default=&#x27;true&#x27;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">j:jelly</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;jelly:core&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:st</span>=<span class="string">&quot;jelly:stapler&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:d</span>=<span class="string">&quot;jelly:define&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:l</span>=<span class="string">&quot;/lib/layout&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:t</span>=<span class="string">&quot;/lib/hudson&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:f</span>=<span class="string">&quot;/lib/form&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%Name&#125;&quot;</span> <span class="attr">field</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">f:textbox</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">f:advanced</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%French&#125;&quot;</span> <span class="attr">field</span>=<span class="string">&quot;useFrench&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">description</span>=<span class="string">&quot;$&#123;%FrenchDescr&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">f:checkbox</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">f:advanced</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:jelly</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ ä¸Šè¿°æ¨™ç±¤å‘Šè¨´æˆ‘å€‘å¯ä»¥æ‰¾åˆ°æŒ‡å®š namespace ä¸­çš„ <strong>jelly æ–‡ä»¶ä¾†æº</strong>å’Œ<strong>å…¶ä»–æ¨™ç±¤çš„å¼•å…¥</strong><br>xmlns:<em>namespace_name</em>=â€<em>where to find resources in that namespace</em>â€œ</p></div><div class="note info flat"><p>ğŸ’¡ å¾ä¸Šæ–¹ç¯„ä¾‹å¯ä»¥çœ‹å‡º <code>f:entry f:textbox f:advanced f:checkbox</code> éƒ½æ˜¯ç”± <code>xmlns:f=&quot;/lib/form&quot;</code> å®£å‘Šä¾†çš„<br>è©³ç´°å¯æŸ¥çœ‹Jenkinsä¸­Jelly Tagsçš„åŸå§‹ç¢¼å°ˆæ¡ˆ</p><div><a class='link-card' title='https://github.com/jenkinsci/jenkins/tree/master/core/src/main/resources/lib' href='https://github.com/jenkinsci/jenkins/tree/master/core/src/main/resources/lib'><div class='left'><i class='fas fa-link'></i></div><div class='right'><p class='text'>Jenkinsä¸­Jelly Tagsçš„åŸå§‹ç¢¼å°ˆæ¡ˆ</p><p class='url'>https://github.com/jenkinsci/jenkins/tree/master/core/src/main/resources/lib</p></div></a></div>æœ‰é—œå®Œæ•´taglibä¾†æºä»‹ç´¹å¯ä»¥çœ‹æ­¤é€£çµ<div><a class='link-card' title='https://reports.jenkins.io/core-taglib/jelly-taglib-ref.html' href='https://reports.jenkins.io/core-taglib/jelly-taglib-ref.html'><div class='left'><i class='fas fa-link'></i></div><div class='right'><p class='text'>Jenkins - Jelly Taglib references</p><p class='url'>https://reports.jenkins.io/core-taglib/jelly-taglib-ref.html</p></div></a></div></div><h3 id="ä¸€èˆ¬æ–‡å­—-åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–"><a href="#ä¸€èˆ¬æ–‡å­—-åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–" class="headerlink" title="ä¸€èˆ¬æ–‡å­—(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)"></a>ä¸€èˆ¬æ–‡å­—(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)</h3><p>åœ¨jenkinsèˆ‡jellyåŸºæœ¬ä½¿ç”¨çš„æ–‡ç« ä¸­æˆ‘å€‘çŸ¥é“ æ¬„ä½èˆ‡è®Šæ•¸ çš„é—œä¿‚ã€‚é™¤æ¬„ä½å¤–ï¼Œæˆ‘å€‘ä¹Ÿæœƒæ“æœ‰ä¸€èˆ¬æ–‡å­—(æ¨™é¡Œã€æ•˜è¿°)éœ€è¦æ’°å¯«åœ¨UIä¸Š</p><p>å°æ­¤jenkinsåœ¨jellyæ”¯æ´åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–ï¼Œè¨­å®šä¸Šæ–¹ä¾¿ç°¡å–®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹æ–¹jellyç¨‹å¼ç¢¼æˆ‘å€‘å¯ä»¥ç™¼ç¾titleè™•æœ‰å€‹`$&#123;%Name&#125;` ï¼Œ**$&#123;%...&#125;é€™å€‹æ¨™è¨˜æ˜¯æŒ‡å®šstaplerè¦å°‹æ‰¾åœ¨åœ°åŒ–è³‡æº(localized resources)**ï¼Œæ‰¾ä¸åˆ°å°±print è©²æ–‡å­—</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%Name&#125;&quot;</span> <span class="attr">field</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">f:textbox</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>é—œæ–¼åœ¨åœ°åŒ–è³‡æºè¦åœ¨å“ªè£¡è¨­å®š?</strong></p><p>åœ¨èˆ‡<code>config.jelly</code>åŒä¸€å€‹ç›®éŒ„ä¸‹æ–°å¢<code>config.properties</code> ï¼Œè¨­å®šæ–¹å¼éå¸¸ç°¡æ˜“(<code>key=value</code>)</p><p><code>config.properties</code>ç‚ºåŸºæœ¬é è¨­ï¼Œè‹¥è¦æ–°å¢å…¶ä»–èªç³»å¯ä»¥æ–°å¢<code>config_zone.properties</code> (ex. <code>config_zh_CN.properties</code>)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name=Name123</span><br><span class="line">French=French</span><br><span class="line">FrenchDescr=Check if we should say hello in French</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-4.png" alt="Untitled"></p><h3 id="å¹«åŠ©èªªæ˜-åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–"><a href="#å¹«åŠ©èªªæ˜-åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–" class="headerlink" title="å¹«åŠ©èªªæ˜(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)"></a>å¹«åŠ©èªªæ˜(åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–)</h3><p>åœ¨è¨­å®šä¸Šæˆ‘å€‘æœƒéœ€è¦æ’°å¯«ä¸€äº›å¹«åŠ©èªªæ˜ï¼Œè¼”åŠ©ä½¿ç”¨è€…ç­è§£è©²æ¬„ä½éœ€å¡«å…¥çš„å…§å®¹ (å¦‚ä¸‹åœ–?æŒ‰éˆ•)<br>å› æ­¤é€™é‚Šæœƒèªªæ˜å¦‚ä½•<strong>å¢åŠ å¹«åŠ©èªªæ˜</strong>èˆ‡<strong>åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–æ–¹å¼</strong></p><blockquote><p><strong>é€™è£¡æä¾›2ç¨®å½¢å¼</strong></p></blockquote><ol><li>æŒ‡å®šæª”æ¡ˆ  å¦‚ä¸‹æ–¹ç¨‹å¼ç¢¼ï¼Œåœ¨tagå…§è¼¸å…¥helpå±¬æ€§ä¸¦æŒ‡å®šhtmlæª”æ¡ˆ <strong>åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–</strong>ï¼šåœ¨æª”åå¾Œé¢æŒ‰è¦å‰‡å¢åŠ èªç³» (å¦‚<code>help_de.html</code>) <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%title&#125;&quot;</span> <span class="attr">help</span>=<span class="string">&quot;/plugin/myPlugin/help.html&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>ä»¥æ¬„ä½fieldè¦å‰‡å»ºç«‹ ä¸€æ¨£åœ¨config.jellyç›®éŒ„ä¸‹ï¼Œæˆ‘å€‘ä¾ç…§æ‰€éœ€çš„æ¬„ä½field(é€™è£¡ä»¥fieldç‚ºnameç‚ºä¾‹)ï¼Œå»ºç«‹<code>help-name.html</code> <strong>åœ‹éš›åŒ–èˆ‡åœ¨åœ°åŒ–</strong>ï¼šåœ¨help-fieldå¾ŒæŒ‰è¦å‰‡å¢åŠ èªç³» (å¦‚<code>help-name_zh_CN.html</code>)</li></ol><p>é—œæ–¼htmlå…§å®¹ï¼Œæˆ‘å€‘æ’°å¯«htmlèªæ³•çš„å…§å®¹å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    Your name.</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é è¨­æ•¸å€¼-Default-value"><a href="#é è¨­æ•¸å€¼-Default-value" class="headerlink" title="é è¨­æ•¸å€¼(Default value)"></a>é è¨­æ•¸å€¼(<strong>Default value)</strong></h3><p>å¦‚æœæˆ‘å€‘å¸Œæœ›è¼¸å…¥æ¡†ä¸­æœ‰é è¨­çš„æ•¸å€¼ï¼Œåªè¦å¢åŠ <code>default</code>å±¬æ€§å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">j:jelly</span> <span class="attr">xmlns:j</span>=<span class="string">&quot;jelly:core&quot;</span> <span class="attr">xmlns:f</span>=<span class="string">&quot;/lib/form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;$&#123;%Port&#125;&quot;</span> <span class="attr">field</span>=<span class="string">&quot;port&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">f:textbox</span> <span class="attr">default</span>=<span class="string">&quot;80&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:jelly</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Jelly-ä¸­ä½¿ç”¨è®Šæ•¸è³‡æ–™"><a href="#Jelly-ä¸­ä½¿ç”¨è®Šæ•¸è³‡æ–™" class="headerlink" title="Jelly ä¸­ä½¿ç”¨è®Šæ•¸è³‡æ–™"></a>Jelly ä¸­ä½¿ç”¨è®Šæ•¸è³‡æ–™</h3><p>åœ¨ä¸Šè¿°ä¸­æˆ‘å€‘çŸ¥é“äº†Jelly æ–‡ä»¶èˆ‡Java Classæœ‰ç›´æ¥é—œè¯ï¼Œé€™æ„å‘³è‘—æˆ‘å€‘å¯ä»¥èª¿ç”¨é€™äº›classçš„æ–¹æ³•æˆ–æ˜¯è®Šæ•¸è³‡æ–™</p><p>å¦‚ä½•ä½¿ç”¨? </p><ul><li>åœ¨Jellyä¸­æˆ‘å€‘ä½¿ç”¨â€<strong>it</strong>â€œé—œéµå­—å¯ä»¥èª¿ç”¨æ–¹æ³•method</li><li>è‹¥è¦å®šç¾©è®Šæ•¸varå‰‡ä½¿ç”¨${insert code here}</li></ul><ol><li>åœ¨ <code>java\io\jenkins\plugins\sample\HelloWorldBuilder.java</code>  ä¸­æˆ‘å€‘å®šç¾©äº†ä¸€å€‹method <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getMyString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello Jenkins!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åœ¨<code>resources\io\jenkins\plugins\sample\HelloWorldBuilder\config.jelly</code> ä¸­å°‡ getMyString èª¿ç”¨ <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">j:jelly</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:j</span>=<span class="string">&quot;jelly:core&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:st</span>=<span class="string">&quot;jelly:stapler&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:d</span>=<span class="string">&quot;jelly:define&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:l</span>=<span class="string">&quot;/lib/layout&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:t</span>=<span class="string">&quot;/lib/hudson&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:f</span>=<span class="string">&quot;/lib/form&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    $&#123;it.myString&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">j:jelly</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>æ¥è‘—è‹¥æˆ‘å€‘åŸ·è¡Œå¯ä»¥çœ‹åˆ°â€™Hello Jenkins!â€™ æˆåŠŸå‡ºç¾åœ¨UIä¸Šå•¦</li></ol><div class="note info flat"><p>ğŸ’¡ æ³¨æ„ï¼šâ€™getâ€™ è¢«è‡ªå‹•å¾æ–¹æ³•åç¨±ä¸­å»é™¤ï¼Œå‰©ä¸‹çš„method nameç¬¬ä¸€å€‹å­—æ¯æ˜¯å°å¯«çš„ã€‚<br>å»ºè­°method nameéƒ½ä½¿ç”¨é§±é§å³°å¼(CamelCase)å‘½åï¼Œä»¥ä¾¿ Jelly å§‹çµ‚å¯ä»¥æ‰¾åˆ°é€™äº›æ–¹æ³•ã€‚</p><p>è®Šæ•¸åªè¦${it.è®Šæ•¸åç¨±}ä¹Ÿå¯æ˜¯èª¿ç”¨</p></div><div class="note info flat"><p>ğŸ’¡ <strong>å…¶ä»–çš„é å®šç¾©ç‰©ä»¶(predefined objects)</strong></p><p>é™¤äº†itç‰©ä»¶ï¼ŒJenkins é‚„æœ‰å®šç¾©äº†ä»¥ä¸‹ç‰©ä»¶ï¼š</p><ul><li>appï¼šthe instance ofÂ JenkinsÂ (orÂ Hudson)</li><li>instanceï¼šJelly UI æ‰€å°æ‡‰çš„æ­£åœ¨è¢«è¨­å®šçš„ç‰©ä»¶</li><li>descriptorï¼šèˆ‡ instance æ‰€å°æ‡‰çš„ Descriptor</li><li>hï¼šan instance of hudson.Functions, with various useful functions</li></ul></div><h3 id="å…¨åŸŸç’°å¢ƒè®Šæ•¸è¨­ç½®"><a href="#å…¨åŸŸç’°å¢ƒè®Šæ•¸è¨­ç½®" class="headerlink" title="å…¨åŸŸç’°å¢ƒè®Šæ•¸è¨­ç½®"></a>å…¨åŸŸç’°å¢ƒè®Šæ•¸è¨­ç½®</h3><p>å…ˆå‰çš„ä¾‹å­éƒ½æ˜¯ä»¥å»ºç½®å…ƒä»¶çš„è¨­ç½®ä»‹ç´¹ï¼Œè‹¥éœ€è¦å…¨åŸŸçš„ç’°å¢ƒè®Šæ•¸è¨­ç½®ä¹Ÿæœ‰æä¾›æ–¹æ³•</p><p>å…¨åŸŸçš„jellyç¨‹å¼æª”åæœƒæ˜¯global.jellyï¼Œè€Œè·¯ç¶“åœ¨å…ƒä»¶ç›®éŒ„åº•ä¸‹ï¼Œä¹Ÿå°±ç­‰åŒæ˜¯è©²å…ƒä»¶çš„å…¨åŸŸè®Šæ•¸</p><p><code>resources\io\jenkins\plugins\sample\HelloWorldBuilder\global.jelly</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?jelly escape-by-default=&#x27;true&#x27;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">j:jelly</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:j</span>=<span class="string">&quot;jelly:core&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:st</span>=<span class="string">&quot;jelly:stapler&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:d</span>=<span class="string">&quot;jelly:define&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:l</span>=<span class="string">&quot;/lib/layout&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:t</span>=<span class="string">&quot;/lib/hudson&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:f</span>=<span class="string">&quot;/lib/form&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">f:section</span> <span class="attr">title</span>=<span class="string">&quot;Hello World&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">f:entry</span> <span class="attr">title</span>=<span class="string">&quot;Age&quot;</span> <span class="attr">field</span>=<span class="string">&quot;age&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;i am description&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">f:textbox</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">f:entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">f:section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:jelly</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-5.png" alt="Untitled"></p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/jenkins-plugin-6.png" alt="Untitled"></p><h2 id="å»ºç½®å ±å‘Šç¨ç«‹é é¢"><a href="#å»ºç½®å ±å‘Šç¨ç«‹é é¢" class="headerlink" title="å»ºç½®å ±å‘Šç¨ç«‹é é¢"></a>å»ºç½®å ±å‘Šç¨ç«‹é é¢</h2><p>åœ¨ä¸Šè¿°ä»‹ç´¹å·²ç¶“äº†è§£å»ºç½®éç¨‹å¯ä»¥åŠ å…¥æ·»åŠ å…ƒä»¶åŸ·è¡Œç¨‹å¼ï¼Œè‹¥æƒ³è¦å°‡åŸ·è¡Œå¾Œçš„å ±å‘Šå‘Šè¨´ä½¿ç”¨è€…ï¼Œé™¤äº†ä½¿ç”¨<code>listener.getLogger().println()</code>æ–¹æ³•è¼¸å‡ºè‡³Console Outputé é¢ï¼Œä¹Ÿå¯ä»¥é€éå¯¦ä½œRunAction2ä¾†å»ºæ§‹ç¨ç«‹é é¢ã€‚</p><h3 id="å»ºç«‹HelloWorldAction-javaä»¥å¯¦ä½œRunAction2"><a href="#å»ºç«‹HelloWorldAction-javaä»¥å¯¦ä½œRunAction2" class="headerlink" title="å»ºç«‹HelloWorldAction.javaä»¥å¯¦ä½œRunAction2"></a>å»ºç«‹HelloWorldAction.javaä»¥å¯¦ä½œRunAction2</h3><p><code>java\io\jenkins\plugins\sample\</code>HelloWorldAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.jenkins.plugins.sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hudson.model.Run;</span><br><span class="line"><span class="keyword">import</span> io.jenkins.plugins.sample.template.SimpleIssue;</span><br><span class="line"><span class="keyword">import</span> jenkins.model.RunAction2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldAction</span> <span class="keyword">implements</span> <span class="title">RunAction2</span> </span>&#123; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Run&lt;?,?&gt; run; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldAction</span><span class="params">(String  msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg= msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttached</span><span class="params">(Run&lt;?, ?&gt; run)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.run = run; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoad</span><span class="params">(Run&lt;?, ?&gt; run)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.run = run; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Run&lt;?,?&gt; getRun() &#123; </span><br><span class="line">        <span class="keyword">return</span> run;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIconFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;document.png&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDisplayName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Greeting&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrlName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Greeting&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ ç›¸é—œèªªæ˜ï¼š<br>å»ºæ§‹å­ä¸­å¯æ”¾å…¥åƒæ•¸ï¼Œå°‡Builderçš„è³‡æ–™å‚³åˆ°Actionï¼Œé€™æ¨£ç¨ç«‹é é¢çš„jellyå°±å¯ä»¥å–å¾—éœ€è¦é¡¯ç¤ºçš„è³‡æ–™<br>getIconFileNameæ–¹æ³•å¯ä»¥è¨­ç½®å´é‚Šæ¬„é …ç›®åœ–ç¤º<br>getDisplayNameæ–¹æ³•å¯ä»¥è¨­ç½®å´é‚Šæ¬„é …ç›®é¡¯ç¤ºåç¨±<br>getUrlNameæ–¹æ³•å¯ä»¥è¨­ç½®ç¨ç«‹é é¢çš„è·¯å¾‘åç¨±</p></div><h3 id="ç¨ç«‹é é¢UIè¨­ç½®"><a href="#ç¨ç«‹é é¢UIè¨­ç½®" class="headerlink" title="ç¨ç«‹é é¢UIè¨­ç½®"></a>ç¨ç«‹é é¢UIè¨­ç½®</h3><p>ç¨ç«‹é é¢çš„è©±éœ€è¦è¨­ç½®index.jellyæª”æ¡ˆï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š<br><code>resources\io\jenkins\plugins\sample\HelloWorldAction\index.jelly</code></p><p>è‹¥è¦ä½¿ç”¨è®Šæ•¸è³‡æ–™ä¸€æ¨£${it.è®Šæ•¸åç¨±}é€éé€™æ¨£çš„æ ¼å¼å°±å¯ä»¥èª¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?jelly escape-by-<span class="keyword">default</span>=<span class="string">&#x27;true&#x27;</span>?&gt;</span><br><span class="line">&lt;j:jelly xmlns:j=<span class="string">&quot;jelly:core&quot;</span> xmlns:l=<span class="string">&quot;/lib/layout&quot;</span> xmlns:st=<span class="string">&quot;jelly:stapler&quot;</span>&gt;</span><br><span class="line">    &lt;l:layout title=<span class="string">&quot;Greeting&quot;</span>&gt; </span><br><span class="line">        &lt;l:side-panel&gt; </span><br><span class="line">            &lt;st:include page=<span class="string">&quot;sidepanel.jelly&quot;</span> it=<span class="string">&quot;$&#123;it.run&#125;&quot;</span> optional=<span class="string">&quot;true&quot;</span> /&gt; </span><br><span class="line">        &lt;/l:side-panel&gt;</span><br><span class="line">        &lt;l:main-panel&gt; </span><br><span class="line">     $&#123;it.msg&#125;</span><br><span class="line">        &lt;/l:main-panel&gt;</span><br><span class="line">    &lt;/l:layout&gt;</span><br><span class="line">&lt;/j:jelly&gt;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>ğŸ’¡ 1.ã€Œlayoutã€æ˜¯ Jenkins æ ¸å¿ƒå®šç¾©çš„å¯é‡ç”¨æ¨™ç±¤ï¼Œå®ƒæä¾›é é¢çš„åŸºæœ¬å¸ƒå±€ï¼ŒåŒ…æ‹¬æ¨™é ­ã€å´é‚Šé¢æ¿ã€ä¸»å…§å®¹å€åŸŸå’Œé è…³ã€‚<br>2. ã€Œside-panelã€æ¨™ç±¤ç‚ºåœ¨å´é‚Šé¢æ¿ä¸­é¡¯ç¤º<br>3.ã€Œmain-panelã€æ¨™ç±¤å¯ä»¥æ”¾å…¥ç¨ç«‹é é¢ä¸­è¦é¡¯ç¤ºçš„å…§å®¹ã€‚</p></div><h3 id="åœ¨BuilderåŸ·è¡ŒActionä»¥è§¸ç™¼é é¢ç”Ÿæˆ"><a href="#åœ¨BuilderåŸ·è¡ŒActionä»¥è§¸ç™¼é é¢ç”Ÿæˆ" class="headerlink" title="åœ¨BuilderåŸ·è¡ŒActionä»¥è§¸ç™¼é é¢ç”Ÿæˆ"></a>åœ¨BuilderåŸ·è¡ŒActionä»¥è§¸ç™¼é é¢ç”Ÿæˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">perform</span><span class="params">(Run&lt;?, ?&gt; run, FilePath workspace, EnvVars env, Launcher launcher, TaskListener listener)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123;</span><br><span class="line">run.addAction(<span class="keyword">new</span> HelloWorldAction(<span class="string">&quot;Something input&quot;</span>));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>é›–ç„¶ç¯‡å¹…æœ‰äº›é•·ï¼Œä¸éåœ¨é€™ç¯‡ç« ç¯€è£¡ï¼Œå·²ç¶“å¯ä»¥äº†è§£Jenkins Pluginçš„åŸºæœ¬æ¶æ§‹ä»¥åŠé—œè¯é‚è¼¯ï¼Œä¸éé™¤äº†å»ºç½®åŸ·è¡Œä¹‹å¤–é‚„æœ‰è¨±å¤šæ“´å±•é»å¯ä»¥ç ”ç©¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
            <tag> jenkins </tag>
            
            <tag> jenkins plugin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Docker Compose ä¸€æ¬¡å»ºç«‹ Nginx ä¼ºæœå™¨ èˆ‡ Cerbot(SSLè‡ªå‹•æ†‘è­‰)</title>
      <link href="/posts/%E4%BD%BF%E7%94%A8%20Docker%20Compose%20%E4%B8%80%E6%AC%A1%E5%BB%BA%E7%AB%8B%20Nginx%20%E4%BC%BA%E6%9C%8D%E5%99%A8%20%E8%88%87%20Cerbot(SSL%E8%87%AA%E5%8B%95%E6%86%91%E8%AD%89)/"/>
      <url>/posts/%E4%BD%BF%E7%94%A8%20Docker%20Compose%20%E4%B8%80%E6%AC%A1%E5%BB%BA%E7%AB%8B%20Nginx%20%E4%BC%BA%E6%9C%8D%E5%99%A8%20%E8%88%87%20Cerbot(SSL%E8%87%AA%E5%8B%95%E6%86%91%E8%AD%89)/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¶²è·¯ç™¼å±•è¿…é€Ÿï¼Œäººå€‘ä½¿ç”¨ç¶²éš›ç¶²è·¯æ–¼ç¶²é ä¸Šç²å–æ–°çŸ¥ï¼Œç¶²ç«™ä¹‹é–“å‚³è¼¸éœ€ç¶“ç”±å®‰å…¨åŠ å¯†ä»¥é¿å…æœ‰å¿ƒäººå£«å¾ä¸­åšå£ï¼Œå› æ­¤SSLï¼ˆSecure Sockets Layerï¼‰æ†‘è­‰æ˜¯ä¸€ç¨®ç”¨æ–¼ç¶²ç«™çš„å®‰å…¨è­‰æ›¸ï¼Œå®ƒå¯ä»¥ä¿è­‰åœ¨å‚³é€æ•¸æ“šæ™‚ä¿æŒå®‰å…¨æ€§ã€‚é€šå¸¸SSLæ†‘è­‰ä¾†æºå¯ä»¥ç”±SSLæ†‘è­‰ä¾›æ‡‰å•†å–å¾—ï¼Œä¸éå¯èƒ½éœ€è¦ä»˜å‡ºä¸€å®šéç”¨ã€‚ç•¶ç„¶ä¹Ÿæœ‰å…è²»çš„ä¾†æºï¼Œè€Œå…è²»çš„æ†‘è­‰æœå‹™æœ‰æ•ˆæœŸé™ç‚º90å¤©ï¼Œä¸€æ®µæ™‚é–“å°±å¾—é‡è¤‡åŒæ¨£æ“ä½œå…¶å¯¦æµªè²»æ™‚é–“èˆ‡å¿ƒåŠ›ï¼Œè‹¥æœ‰è‡ªå‹•åŒ–çš„æ–¹å¼ä½•ä¸ç‚ºæ¨‚å‘¢ã€‚å› æ­¤é€™æ¬¡å¸¶ä¾†å®¹å™¨åŒ–æ–¹å¼ä¸€æ¬¡å°‡æ‰€æœ‰æœå‹™è¨­ç½®å®Œæˆã€‚</p><h3 id="ä»€éº¼æ˜¯Docker-amp-Docker-Compose"><a href="#ä»€éº¼æ˜¯Docker-amp-Docker-Compose" class="headerlink" title="ä»€éº¼æ˜¯Docker &amp; Docker Compose?"></a>ä»€éº¼æ˜¯Docker &amp; Docker Compose?</h3><p>Docker å°‡è»Ÿé«”å°è£åˆ°åç‚ºå®¹å™¨çš„æ¨™æº–åŒ–å–®ä½ï¼Œå®¹å™¨æ˜¯åœ¨ä½œæ¥­ç³»çµ±å±¤ä¸Šè™›æ“¬åŒ–ï¼Œä¸¦å°‡å®¹å™¨ç¨ç«‹ç’°å¢ƒä¸”ç›´æ¥ä½¿ç”¨ç³»çµ±OSè³‡æºï¼Œç„¡é ˆå®‰è£/è™›æ“¬åŒ–ä½œæ¥­ç³»çµ±ã€‚é€éDockerå¯ä»¥æœ€å°åŒ–æ–¹å¼å»ºç«‹å¾®æœå‹™ä¸”èƒ½å¿«é€Ÿå•Ÿå‹•ã€åœæ­¢ã€åˆªé™¤ç­‰æ“ä½œã€‚å…¶ä¸­Jekinsèˆ‡SonarQubeéƒ½æœ‰å„è‡ªçš„imageæä¾›åœ¨Docker hubä¸Šã€‚</p><p>Docker Composeæ˜¯ç‚ºäº†å”åŠ©å®šç¾©å’Œé‹è¡Œå¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼è€Œé–‹ç™¼çš„å·¥å…·ï¼Œåˆ©ç”¨ YAML æª”æ¡ˆä¾†é…ç½®éœ€è¦çš„æœå‹™ä»¥åŠæœå‹™çš„ç’°å¢ƒè¨­å®šã€‚</p><h3 id="ä»€éº¼æ˜¯Nginx"><a href="#ä»€éº¼æ˜¯Nginx" class="headerlink" title="ä»€éº¼æ˜¯Nginx?"></a>ä»€éº¼æ˜¯Nginx?</h3><p>Nginxæ˜¯éåŒæ­¥æ¡†æ¶çš„ç¶²é ä¼ºæœå™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†ã€è² è¼‰å¹³è¡¡å™¨å’ŒHTTPå¿«å–ã€‚èˆ‡Apacheç¶²é ä¼ºæœå™¨éƒ½ç›¸ç•¶çŸ¥åï¼ŒNginxè¨­ç½®ç°¡æ˜“ï¼Œè¨˜æ†¶é«”æ¶ˆè€—ä½ï¼Œåå‘ä»£ç†ï¼†è² è¼‰å¹³è¡¡åŠŸèƒ½ä¹Ÿå¾ˆä¸éŒ¯</p><h4 id="ä»€éº¼æ˜¯SSLæ†‘è­‰"><a href="#ä»€éº¼æ˜¯SSLæ†‘è­‰" class="headerlink" title="ä»€éº¼æ˜¯SSLæ†‘è­‰?"></a>ä»€éº¼æ˜¯SSLæ†‘è­‰?</h4><p>SSLæ˜¯Secure Socket Layerçš„ç¸®å¯«ï¼Œæ˜¯ä¸€ç¨®è³‡è¨Šå‚³è¼¸çš„åŠ å¯†æŠ€è¡“ï¼Œèƒ½å¤ åŠ å¯†å…©å€‹ç¶²ç«™ä¹‹é–“äº’ç›¸å‚³è¼¸çš„è³‡æ–™ï¼Œè®“ä»–äººç„¡æ³•å–å¾—æ‚¨çš„ç¶²ç«™èˆ‡å®¢æˆ¶ä¹‹é–“çš„éš±ç§è¨Šæ¯ã€‚ç¶“éSSLæ†‘è­‰åŠ å¯†æˆåŠŸçš„ç¶²ç«™ï¼Œç¶²å€æœƒç”±httpè®Šæˆhttpsã€‚</p><h3 id="ç‚ºä»€éº¼éœ€è¦SSLæ†‘è­‰"><a href="#ç‚ºä»€éº¼éœ€è¦SSLæ†‘è­‰" class="headerlink" title="ç‚ºä»€éº¼éœ€è¦SSLæ†‘è­‰?"></a>ç‚ºä»€éº¼éœ€è¦SSLæ†‘è­‰?</h3><p>å‰›å‰›æåˆ°SSLæ˜¯è³‡æ–™å‚³è¼¸çš„åŠ å¯†æŠ€è¡“ï¼Œå¯ä»¥çŸ¥é“ç•¶ç¶²ç«™èˆ‡ä½¿ç”¨è€…äº’å‹•æ™‚è¼¸å…¥çš„è³‡æ–™æ˜¯æœ‰è¢«åŠ å¯†éçš„ã€‚é‚£åä¹‹ï¼Œå¦‚æœæ²’æœ‰SSLä¸å°±æ„è¬‚è‘—ä½ çš„è³‡æ–™æ˜¯è£¸éœ²çš„ï¼Œæœ‰å¿ƒäººå£«è‹¥æ””æˆªå°åŒ…ï¼Œå°±å¯ä»¥è¼•æ˜“å–å¾—ä½ çš„è³‡æ–™ï¼Œå› ç‚ºæ²’æœ‰åŠ å¯†ï¼Œä¸éœ€è¦è§£å¯†éç¨‹ã€‚</p><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>ç’°å¢ƒæº–å‚™<ul><li>æº–å‚™åŸŸå</li><li>å®‰è£Docker</li><li>å®‰è£Docker-Compose</li></ul></li><li>æœå‹™æ¶è¨­ for ä¸€èˆ¬åŸŸåæ†‘è­‰ç”³è«‹æ–¹å¼<ul><li>è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®</li><li>å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™</li><li>è¨­ç½®docker-composeLE.ymlï¼Œé¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™</li><li>å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹</li><li>Nginx SSLè¨­ç½®</li><li>åˆ‡æ›å®¹å™¨æœå‹™å•Ÿå‹•è‡ªå‹•SSLæ†‘è­‰ç”³è«‹</li></ul></li><li>æœå‹™æ¶è¨­ for è¬ç”¨å­åŸŸæ†‘è­‰ç”³è«‹æ–¹å¼<ul><li>DNSæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹</li><li>è¨­ç½®docker-compose.ymlã€docker-composeLE.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®</li><li>å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™</li><li>å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹</li><li>Nginx SSLè¨­ç½®</li><li>åˆ‡æ›å®¹å™¨æœå‹™å•Ÿå‹•è‡ªå‹•SSLæ†‘è­‰ç”³è«‹</li></ul></li></ul><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><p>ç’°å¢ƒåªè¦å®‰è£Dockerè·ŸDocker-Composeè€Œå·²ï¼Œå¯ä»¥çŸ¥é“æ¥ä¸‹ä¾†çš„è¨­ç½®éƒ½æœƒåœ¨å®¹å™¨ä¸­ï¼Œå¤§å¹…é™ä½ç’°å¢ƒæ±™æŸ“</p><h3 id="æº–å‚™åŸŸå"><a href="#æº–å‚™åŸŸå" class="headerlink" title="æº–å‚™åŸŸå"></a>æº–å‚™åŸŸå</h3><p>åŸŸåå°±è·Ÿè»Šç‰Œä¸€æ¨£æœ‰è²´çš„æœ‰ä¾¿å®œçš„ï¼Œè€Œå…è²»ä¹Ÿæœ‰ã€‚freenomæä¾›è¨±å¤šå…è²»ä¸€å¹´çš„åŸŸåä¾›ä½¿ç”¨è€…ç”³è«‹ã€‚</p><p>è¼¸å…¥ä½ æƒ³è¦çš„åŸŸåï¼Œå¾åœ–ä¸­å¯ä»¥çœ‹åˆ°freenomçµ¦äºˆä¸€äº›é¸æ“‡, æœ‰äº›å¯ä»¥ä½¿ç”¨æœ‰äº›å·²ç¶“è¢«ä½¿ç”¨éäº†<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/freenom-1.jpg" alt="Untitled"></p><p>æ¥è‘—é¸æ“‡ä½¿ç”¨æœŸé™ï¼Œä¸€å¹´ä¹‹å‰éƒ½æ˜¯å…è²»çš„ã€‚å¦‚æœä¸€å¹´åˆ°æœŸçš„è©±å…¶å¯¦é‚„å¯ä»¥ç¹¼çºŒç”³è«‹åŒä¸€å€‹ï¼Œä¹Ÿé‚„æ˜¯å…è²»ã€‚è€Œä¸”åœ¨éæœŸå‰ä¸€å€‹æœˆå°±å¯ä»¥å…ˆçºŒç´„ï¼Œç›¸ç•¶æ–¼å„ªå…ˆæ¬Šã€‚<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/freenom-2.jpg" alt="Untitled"></p><p>ç”³è«‹å®Œç•¢å¾Œï¼Œå‰å¾€æˆ‘çš„åŸŸåä»¥ç®¡ç†åŸŸå<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/freenom-3.jpg" alt="Untitled"></p><p>åœ¨åŸŸåé€™é‚Šæˆ‘å€‘å¯ä»¥è¨­å®šè©²åŸŸåæŒ‡å‘çš„IPä½ç½®ï¼Œæˆ‘çš„åŸŸåæ˜¯æŒ‡åˆ°github pageçš„æœå‹™ä¸Šï¼Œè‹¥è‡ªå·±æœ‰è™›æ“¬æ©Ÿä¹Ÿå¯ä»¥æŒ‡å‘è‡ªå·±çš„å…¬é–‹IPä¸Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/freenom-4.jpg" alt="Untitled"></p><h3 id="å®‰è£Docker"><a href="#å®‰è£Docker" class="headerlink" title="å®‰è£Docker"></a>å®‰è£Docker</h3><p>Dockerå®‰è£æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ç§»é™¤èˆŠç‰ˆæœ¬çš„docker</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure><p>çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°‡$USERåŠ å…¥dockerç¾¤çµ„</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ›ç¾¤çµ„</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><h3 id="å®‰è£Docker-Compose"><a href="#å®‰è£Docker-Compose" class="headerlink" title="å®‰è£Docker-Compose"></a>å®‰è£Docker-Compose</h3><p>Docker Composeå®‰è£æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h2 id="æœå‹™æ¶è¨­-for-ä¸€èˆ¬åŸŸåæ†‘è­‰ç”³è«‹æ–¹å¼"><a href="#æœå‹™æ¶è¨­-for-ä¸€èˆ¬åŸŸåæ†‘è­‰ç”³è«‹æ–¹å¼" class="headerlink" title="æœå‹™æ¶è¨­ for ä¸€èˆ¬åŸŸåæ†‘è­‰ç”³è«‹æ–¹å¼"></a>æœå‹™æ¶è¨­ for ä¸€èˆ¬åŸŸåæ†‘è­‰ç”³è«‹æ–¹å¼</h2><p>ä¸€èˆ¬åŸŸååœ¨æ†‘è­‰ç”³è«‹ä¸Šåªè¦è­‰æ˜è©²åŸŸåæ˜¯ä½ çš„å³å¯ï¼Œé€šå¸¸åªè¦ä¾ç…§è¦å®šåœ¨ä¼ºæœå™¨å…§è¨­ç½®è·¯ç”±ï¼Œæ†‘è­‰æ©Ÿå™¨äººæœƒåœ¨è©²è·¯ç”±è™•ç”¢ç”Ÿä¸€å€‹tokenæª”ï¼Œè®“å®ƒé©—è­‰æ˜¯å¦èƒ½å¤ é †åˆ©è¨ªå•ï¼Œè‹¥è¨ªå•æˆåŠŸæ†‘è­‰æ©Ÿå™¨äººå°±èªå¯è©²åŸŸåæ˜¯ä½ æ“æœ‰çš„ã€‚</p><h3 id="è¨­ç½®docker-compose-ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®"><a href="#è¨­ç½®docker-compose-ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®" class="headerlink" title="è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®"></a>è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®</h3><p>æˆ‘å€‘çš„docker-compose.ymlç¸½å…±æœƒæœ‰3å€‹è§’è‰²</p><ol><li>ç¶²é ä¼ºæœå™¨: Nginx</li><li>é–‹ç™¼çš„æœå‹™: å‰ç«¯ã€å¾Œç«¯ç­‰ç­‰</li><li>è­‰æ›¸æ©Ÿå™¨äºº: Cerbot</li></ol><p>è‡³å°‘æœƒæœ‰3å€‹å®¹å™¨æœå‹™ï¼Œé€™æ¬¡é–‹ç™¼çš„æœå‹™æˆ‘ä½¿ç”¨Jenkinsä½œç‚ºç¯„ä¾‹ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„docker-compose.ymlï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Taipei</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx:/etc/nginx/conf.d</span>    </span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/certbot/conf:/etc/nginx/ssl</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;/bin/sh -c &#x27;while :; do sleep 6h &amp; wait $$&#123;!&#125;; nginx -s reload; done &amp; nginx -g \&quot;daemon off;\&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">jenkins:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">jenkins/jenkins:lts</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">&#x27;jenkins&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;50000:50000&quot;</span></span><br><span class="line"><span class="attr">mem_limit:</span> <span class="string">1024m</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./jenkins:/var/jenkins_home</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">9000</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">certbot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">certbot/certbot</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">certbot</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/certbot/conf:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/certbot/logs:/var/log/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/ssl:/secrets</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&quot;/bin/sh -c &#x27;trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $$&#123;!&#125;; done;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br></pre></td></tr></table></figure><div class="note info flat no-icon flat"><p>ğŸ’¡ åœ¨docker-compose.ymlè¨­å®šæª”ä¸­å¯ä»¥çœ‹åˆ°æ¯å€‹å®¹å™¨çš„volumeséƒ½æœ‰è¨­ç½®æ˜ å°„çš„ç›®æ¨™ï¼Œé€™é‚Šåˆ†åˆ¥ä»‹ç´¹ä¸€ä¸‹</p><ol><li>./logs:/var/log/nginxï¼šä¼ºæœå™¨æ—¥èªŒ</li><li>./nginx:/etc/nginx/conf.dï¼šä¼ºæœå™¨è¨­å®šæª”</li><li>./nginx/certbot/conf:/etc/nginx/sslï¼šä¼ºæœå™¨æ†‘è­‰ (é€™é‚Šèˆ‡cerbotä¸²è¯)</li><li>./nginx/certbot/data:/var/www/certbotï¼šæ†‘è­‰æ©Ÿå™¨äººè³‡æ–™ (æ©Ÿå™¨äººç”¢ç”Ÿçš„åŠ å¯†é©—è­‰æª”æœƒå­˜èˆ‡æ­¤)</li></ol></div><h3 id="è¨­ç½®Nginxä¼ºæœå™¨è¨­å®šæª”"><a href="#è¨­ç½®Nginxä¼ºæœå™¨è¨­å®šæª”" class="headerlink" title="è¨­ç½®Nginxä¼ºæœå™¨è¨­å®šæª”"></a>è¨­ç½®Nginxä¼ºæœå™¨è¨­å®šæª”</h3><p>å¾docker-compose.ymlè¨­å®šæª”ä¸­å¯ä»¥å¾—çŸ¥ï¼Œæª”æ¡ˆéœ€æ’°å¯«æ–¼nginxç›®éŒ„ä¸‹ï¼Œåœ¨é¦–æ¬¡æœå‹™é‹è¡Œæ™‚æˆ‘å€‘æœƒåšé¦–æ¬¡æ†‘è­‰ç”³è«‹ï¼Œå› æ­¤é€™é‚Šçš„è¨­å®šåªç‚ºäº†ç¬¬ä¸€æ¬¡çš„æ†‘è­‰è¨ªå•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">     listen [::]:80;</span><br><span class="line">     listen 80;</span><br><span class="line"></span><br><span class="line">     server_name your_domain.com;</span><br><span class="line"></span><br><span class="line">     location ~ /.well-known/acme-challenge &#123;</span><br><span class="line">         allow all; </span><br><span class="line">         root /var/www/certbot;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™"><a href="#å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™" class="headerlink" title="å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™"></a>å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™</h3><p>æˆ‘å€‘å·²ç¶“å»ºç«‹å¥½éœ€è¦çš„æœå‹™åœ¨docker-compose.ymlä¸Šäº†ï¼Œæ¥è‘—åªè¦ä½¿ç”¨docker-composeçš„æŒ‡ä»¤å°±å¯ä»¥ä¸€æ¬¡å»ºç«‹å¥½å®¹å™¨ã€‚</p><p>é€šå¸¸å–®ä¸€åŸŸåçš„æ†‘è­‰ç”³è«‹æœƒé ˆè¦é©—è­‰ç‰¹å®šç›®éŒ„æ˜¯å¦èƒ½æ­£å¸¸è¨ªå•ä¸”å«æœ‰æœå‹™å»ºç«‹å¥½çš„æ¨™èªŒï¼Œå› æ­¤å…ˆå•Ÿå‹•å®¹å™¨æœå‹™è®“ç€è¦½å™¨è¼¸å…¥åŸŸåå¯ä»¥æ­£å¸¸è¨ªå•</p><p>åœ¨docker-compose.ymlæª”æ¡ˆçš„ç›®éŒ„ä¸‹åŸ·è¡Œå»ºç½®æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸ·è¡Œå·²å¯«å¥½çš„docker-compose.yml</span></span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><div class="note info flat no-icon flat"><p>ğŸ’¡ åŸ·è¡Œéç¨‹ä¸­ä¸€é–‹å§‹localç«¯å°šæœªæ“æœ‰nginxã€jenkinsã€cerbotçš„imagesï¼Œå› æ­¤ä¸€é–‹å§‹æœƒå…ˆé€²è¡Œpullä¸‹è¼‰</p></div><h3 id="è¨­ç½®docker-composeLE-ymlï¼Œé¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™"><a href="#è¨­ç½®docker-composeLE-ymlï¼Œé¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™" class="headerlink" title="è¨­ç½®docker-composeLE.ymlï¼Œé¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™"></a>è¨­ç½®docker-composeLE.ymlï¼Œé¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™</h3><ol><li><p>æ’°å¯«docker-composeLE.yml</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">certbot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">certbot/certbot</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">certonly</span> <span class="string">--webroot</span> <span class="string">--webroot-path</span> <span class="string">/var/www/certbot/</span> <span class="string">-d</span> <span class="string">$&#123;HOST_DOMAIN&#125;</span> <span class="string">--email</span> <span class="string">$&#123;HOST_EMAIL&#125;</span> <span class="string">--agree-tos</span> </span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/certbot/www/:/var/www/certbot/:rw</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/certbot/conf/:/etc/letsencrypt/:rw</span></span><br></pre></td></tr></table></figure> <div class="note info flat no-icon flat"><p>ğŸ’¡ åƒæ•¸ä»‹ç´¹<br>webrootï¼šé€šéå°‡æ–‡ä»¶æª”æ”¾åœ¨ç¶²é è·Ÿç›®éŒ„ä¸­ä»¥é©—è­‰æ†‘è­‰çš„æ–¹å¼ï¼Œå¦‚æ­¤cerboté€éè¨ªå•domain.com/.well-known/acme-challengeä¾†æŸ¥çœ‹æ˜¯å¦æœ‰è©²æª”æ¡ˆï¼Œä»¥é©—è­‰è©²åŸŸåçš„ä½¿ç”¨è€…æ˜¯å¦å±¬æ–¼ä½ <br>dï¼šè¦ç”³è«‹çš„åŸŸå ( è‹¥ä¸€æ¬¡è¦ç”³è«‹å¤šå€‹åŸŸåï¼Œå¯ä»¥-d abc.domain.com -d xyz.domain.com )<br>emailï¼š è¯ç¹«æˆ–æ¢å¾©ç”¨çš„ä¿¡ç®±<br>agree-tosï¼šåŒæ„ACMEç”¨æˆ¶å”è­°ï¼Œåœ¨ç”³è«‹é€”ä¸­æœƒæœ‰å•ç­”yes/noï¼Œè€Œæˆ‘å€‘ä½¿ç”¨docker-composeçš„éç¨‹æ˜¯è‡ªå‹•åŒ–çš„ï¼Œä¸¦ä¸èƒ½ä½œç­”ï¼Œå› æ­¤é€™é‚Šå¯ä»¥å…ˆè¨­ç½®åŒæ„ã€‚</p></div></li><li><p>æ’°å¯«ç’°å¢ƒè®Šæ•¸(.env)</p><p> åœ¨docker-composeLE.ymlçš„certbot commandå¯ä»¥çœ‹åˆ°æœ‰ä½¿ç”¨åˆ°ç’°å¢ƒè®Šæ•¸ï¼Œè€Œé€™éƒ¨åˆ†å¯ä»¥è¨­å®šåœ¨.envæª”ä¸­ï¼Œè®“docker-composeè‡ªå‹•è®€å–</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HOST_DOMAIN=&lt;è¦è¨»å†Šçš„åŸŸå&gt;</span><br><span class="line">HOST_EMAIL=&lt;ä¿¡ç®±&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹"><a href="#å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹" class="headerlink" title="å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹"></a>å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹</h3><p>æŒ‡å®šå•Ÿå‹•docker-composeLE.ymlçš„æœå‹™ï¼Œæ¥è‘—æœƒåŸ·è¡Œcerboté å…ˆå¯«å¥½çš„command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-composeLE.yml up</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šæˆ‘å€‘åœ¨æ­¤å¯çœ‹åˆ°æ†‘è­‰ç”³è«‹éç¨‹ï¼Œè‹¥å¤±æ•—å‰‡æœƒè¼¸å‡ºç›¸é—œéŒ¯èª¤è¨Šæ¯æ–¼çµ‚ç«¯æ©Ÿä¸Š</p><h3 id="å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx"><a href="#å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx" class="headerlink" title="å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx"></a>å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain.com;</span><br><span class="line">    location ~ /.well-known/acme-challenge &#123;</span><br><span class="line">        allow all;</span><br><span class="line">        root /var/www/certbot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> 301 https://your_domain.com<span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name your_domain.com;</span><br><span class="line">    </span><br><span class="line">    ssl_certificate /etc/nginx/ssl/live/gcp12893678.tk/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/live/gcp12893678.tk/privkey.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆå¾Œé‡æ–°æ•´ç†nginxä¼ºæœå™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p>è¨ªå•è‡ªå·±çš„åŸŸåçœ‹çœ‹æœ‰æ²’æœ‰æˆåŠŸé–‹å•ŸSSLæ†‘è­‰å§</p><h3 id="æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰"><a href="#æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰" class="headerlink" title="æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰"></a>æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰</h3><p>é‚„è¨˜å¾—docker-compose.ymlä¸Šæœ‰æ’°å¯«cerbotå®¹å™¨å—ï¼Œé€éå†æ¬¡å•Ÿå‹•ä¸‹æ–¹æŒ‡ä»¤ï¼Œå°‡é¦–æ¬¡ç”³è«‹ç”¨çš„å®¹å™¨æ›¿ä»£å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h2 id="æœå‹™æ¶è¨­-for-è¬ç”¨å­åŸŸæ†‘è­‰ç”³è«‹æ–¹å¼"><a href="#æœå‹™æ¶è¨­-for-è¬ç”¨å­åŸŸæ†‘è­‰ç”³è«‹æ–¹å¼" class="headerlink" title="æœå‹™æ¶è¨­ for è¬ç”¨å­åŸŸæ†‘è­‰ç”³è«‹æ–¹å¼"></a>æœå‹™æ¶è¨­ for è¬ç”¨å­åŸŸæ†‘è­‰ç”³è«‹æ–¹å¼</h2><div class="note warning flat no-icon flat"><p>ğŸ’¡ è‹¥æƒ³è¦è¬ç”¨å­åŸŸé©—è­‰çš„è©±ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä½ çš„DNSä¾›æ‡‰å•†ï¼Œä¸åŒçš„ä¾›æ‡‰å•†éœ€è¦æ›´æ”¹ä¸åŒçš„imageï¼Œå› ç‚ºè¬ç”¨å­åŸŸé©—è­‰éœ€è¦ç¶“éâ€DNSæŒ‘æˆ°â€ï¼ŒDNSæŒ‘æˆ°æ˜¯è¦è­‰æ˜ä½ æ“æœ‰è©²DNSçš„æ¬Šé™ï¼Œé€™æ¨£æ‰æ•¢ç™¼è¬ç”¨å­åŸŸçš„æ†‘è­‰çµ¦ä½ ã€‚</p><p>Cerbotå·²ç¶“åœ¨å„åˆ¥çš„imageå»ºç«‹å¥½ä¸åŒä¾›æ‡‰å•†çš„APIï¼Œå°æˆ‘å€‘ä½¿ç”¨è€…ä¾†èªªåªè¦å°‡ä¾›æ‡‰å•†APIçš„æ¬Šé™é‡‘é‘°çµ¦ä»–å³å¯ï¼Œç•¶ç„¶æ€•ä¸å®‰å…¨çš„è©±ï¼Œå»ºç«‹é‡‘é‘°æ™‚ï¼Œå¯ä»¥é¸æ“‡è©²é‡‘é‘°æ“æœ‰çš„æ¬Šé™ã€‚</p></div><h3 id="DNSæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹"><a href="#DNSæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹" class="headerlink" title="DNSæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹"></a>DNSæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹</h3><div class="tabs" id="dnsæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#dnsæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹-1">è‹¥dnsä½¿ç”¨cloudflare</button></li><li class="tab"><button type="button" data-href="#dnsæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹-2">è‹¥dnsä½¿ç”¨cloudflare</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="dnsæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹-1"><p>é¦–å…ˆå‰å¾€cloudflareç¶²ç«™ç™»å…¥å¾Œï¼Œé»é¸å€‹äººå¸³æˆ¶çš„API Token(å¦‚åœ–)<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-api-token-page.jpg" alt="Untitled"></p><p>æ¥è‘—é»é¸å»ºç«‹Tokenï¼Œæœƒåˆ°ä¸‹åœ–é é¢ï¼Œæˆ‘å€‘éœ€è¦çµ¦äºˆDNSç·¨è¼¯æ¬Šé™ä¸¦ä¸”è¨­å®šå€åŸŸè³‡æºçµ¦äºˆæˆ‘å€‘è¦ä½¿ç”¨çš„ç¶²åŸŸDomin<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/cloudflare-api-token-edit-page.jpg" alt="Untitled"></p><p>å»ºç«‹å®Œæˆå¾Œæˆ‘å€‘æœƒç²å¾—ä¸€ä¸²é‡‘é‘°tokenï¼Œå°‡é€™ä¸²é‡‘é‘°tokenå¡«å¯«åˆ° <code>nginx/ssl/cloudflare.ini</code> ï¼Œè¦†è“‹æ‰â€your_tokenâ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dns_cloudflare_api_token = your_token</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dnsæœå‹™ç®¡ç†æ¬Šé™é‡‘é‘°ç”³è«‹-2"><p>å‰å¾€APIå’Œæœå‹™â†’æ†‘è­‰å»ºç«‹æœå‹™å¸³æˆ¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step1.jpg" alt="Untitled"></p><p>è¼¸å…¥åŸºæœ¬è³‡è¨Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step2.jpg" alt="Untitled"></p><p>è¨­å®šå°‡DNSæ¬Šé™çµ¦äºˆæœå‹™<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step3.jpg" alt="Untitled"></p><p>å»ºç«‹å®Œç•¢å¾Œï¼Œé¸å–æˆ‘å€‘å»ºç«‹å¥½çš„æœå‹™å¸³æˆ¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step4.jpg" alt="Untitled"></p><p>å‰å¾€é‡‘é‘°é¸é …ä¸¦æ–°å¢é‡‘é‘°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step5.jpg" alt="Untitled"></p><p>é¸æ“‡JSONæ ¼å¼ï¼Œå»ºç«‹å®Œç•¢å¾Œå°‡è‡ªå‹•ä¸‹è¼‰é‡‘é‘°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/gcp-dns-auth-key-step6.jpg" alt="Untitled"></p><p>ä¸‹è¼‰å®Œæˆå¾Œæˆ‘å€‘å°‡jsonå…§å®¹è¤‡è£½å¡«å¯«åˆ° <code>nginx/ssl/google.json</code> ï¼Œä¸‹æ–¹ç‚ºæˆ‘å€‘éœ€è¦çœ‹åˆ°çš„æ ¼å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;project_id&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private_key_id&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private_key&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_email&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_id&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;auth_uri&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_uri&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;auth_provider_x509_cert_url&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_x509_cert_url&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="è¨­ç½®docker-compose-ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-1"><a href="#è¨­ç½®docker-compose-ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-1" class="headerlink" title="è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®"></a>è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®</h3><div class="tabs" id="è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-1">è‹¥dnsä½¿ç”¨cloudflare</button></li><li class="tab"><button type="button" data-href="#è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-2">è‹¥dnsä½¿ç”¨cloudflare</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-1"><ol><li><p>æ’°å¯«docker-composeLE.yml<br> å› ç‚ºä½¿ç”¨çš„dnsæœå‹™å•†ä¸åŒï¼Œæˆ‘å€‘çš„cerbot imageå’ŒæŒ‡ä»¤ä¹Ÿä¸åŒï¼Œ<br> å› æ­¤è¦æª¢æŸ¥ <code>docker/docker-compose.yml</code>ã€<code>docker/docker-composeLE.yml</code> </p><p> å¿…é ˆèˆ‡ä¸‹æ–¹ä¸€è‡´</p><p> <code>docker/docker-compose.yml</code> (é€™è£¡åªåˆ—å‡ºcerbotæœå‹™)</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">certbot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">certbot/dns-cloudflare</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">certbot</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../nginx/certbot/conf:/etc/letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../nginx/certbot/logs:/var/log/letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../nginx/ssl:/secrets</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&quot;/bin/sh -c &#x27;trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $$&#123;!&#125;; done;&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p> <code>docker/docker-composeLE.yml</code> </p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">certbot:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">certbot/dns-cloudflare</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">certonly</span> <span class="string">--expand</span> <span class="string">-d</span> <span class="string">$&#123;HOST_DOMAIN&#125;</span> <span class="string">-d</span> <span class="string">$&#123;WILDCARD_DOMAIN&#125;</span> <span class="string">--preferred-challenges</span> <span class="string">dns</span> <span class="string">--dns-cloudflare</span> <span class="string">--dns-cloudflare-credentials</span> <span class="string">/secrets/cloudflare.ini</span>  <span class="string">--email</span> <span class="string">$&#123;HOST_EMAIL&#125;</span> <span class="string">--agree-tos</span> <span class="string">--server</span> <span class="string">https://acme-v02.api.letsencrypt.org/directory</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../nginx/certbot/conf:/etc/letsencrypt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../nginx/certbot/logs:/var/log/letsencrypt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../nginx/ssl:/secrets</span></span><br></pre></td></tr></table></figure> <div class="note info flat no-icon flat"><p>ğŸ’¡ åƒæ•¸ä»‹ç´¹<br>â€“preferred-challengesï¼šæŒ‡å®š Certbot å®¢æˆ¶ç«¯æ‡‰è©²ä½¿ç”¨å“ªç¨®æ–¹æ³•ä¾†è­‰æ˜æ‚¨æ§åˆ¶è«‹æ±‚è­‰æ›¸çš„åŸŸåã€‚Certbot å®¢æˆ¶ç«¯æ”¯æ´å¤šç¨®ä¸åŒçš„æŒ‘æˆ°é¡å‹ï¼ŒåŒ…æ‹¬ HTTPã€DNS å’Œ TLS-SNIï¼Œå¦‚æœæŒ‡å®š â€“preferred-challenges dnsï¼ŒCertbot å®¢æˆ¶ç«¯å°‡é¦–å…ˆå˜—è©¦é€šéå°‡ç‰¹å®šçš„ DNS è¨˜éŒ„æ·»åŠ åˆ°æ‚¨çš„åŸŸåçš„ DNS é…ç½®ä¸­ä¾†è­‰æ˜æ‚¨çš„åŸŸåæ§åˆ¶æ¬Šã€‚<br>â€“dns-cloudflareï¼šå…è¨± Certbot é€šéä½¿ç”¨ Cloudflare API å‰µå»ºå’Œä¿®æ”¹ DNS è¨˜éŒ„ä¾†é©—è­‰æ‚¨å°åŸŸçš„æ‰€æœ‰æ¬Šã€‚<br>â€“dns-cloudflare-credentialsï¼š æŒ‡æ§åˆ¶DNSæœå‹™é‡‘é‘°çš„æª”æ¡ˆä½ç½®</p></div></li><li><p>æ’°å¯«ç’°å¢ƒè®Šæ•¸(.env)</p><p> åœ¨docker-composeLE.ymlçš„certbot commandå¯ä»¥çœ‹åˆ°æœ‰ä½¿ç”¨åˆ°ç’°å¢ƒè®Šæ•¸ï¼Œè€Œé€™éƒ¨åˆ†å¯ä»¥è¨­å®šåœ¨.envæª”ä¸­ï¼Œè®“docker-composeè‡ªå‹•è®€å–</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HOST_DOMAIN=&lt;è¦è¨»å†Šçš„åŸŸå&gt;</span><br><span class="line">WILDCARD_DOMAIN=&lt;è¦è¨»å†Šçš„è¬ç”¨åŸŸå&gt;</span><br><span class="line">HOST_EMAIL=&lt;ä¿¡ç®±&gt;</span><br></pre></td></tr></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="è¨­ç½®docker-compose.ymlå®¹å™¨åŒ–æœå‹™çš„ç’°å¢ƒèˆ‡é…ç½®-2"><ol><li><p>æ’°å¯«docker-composeLE.yml</p><p> å› ç‚ºä½¿ç”¨çš„dnsæœå‹™å•†ä¸åŒï¼Œæˆ‘å€‘çš„cerbot imageå’ŒæŒ‡ä»¤ä¹Ÿä¸åŒï¼Œ<br> å› æ­¤è¦æª¢æŸ¥ <code>docker/docker-compose.yml</code>ã€<code>docker/docker-composeLE.yml</code> </p><p> å¿…é ˆèˆ‡ä¸‹æ–¹ä¸€è‡´</p><p> <code>docker/docker-compose.yml</code> (é€™è£¡åªåˆ—å‡ºcerbotæœå‹™)</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">certbot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">certbot/dns-google</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">certbot</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/certbot/conf:/etc/letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/certbot/logs:/var/log/letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./nginx/ssl:/secrets</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&quot;/bin/sh -c &#x27;trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $$&#123;!&#125;; done;&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p> <code>docker/docker-composeLE.yml</code> </p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">certbot:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">certbot/dns-google</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">certonly</span> <span class="string">--expand</span> <span class="string">-d</span> <span class="string">$&#123;HOST_DOMAIN&#125;</span> <span class="string">-d</span> <span class="string">$&#123;WILDCARD_DOMAIN&#125;</span> <span class="string">--preferred-challenges</span> <span class="string">dns</span> <span class="string">--dns-google</span> <span class="string">--dns-google-credentials</span> <span class="string">/secrets/google.json</span> <span class="string">--email</span> <span class="string">$&#123;HOST_EMAIL&#125;</span> <span class="string">--agree-tos</span> <span class="string">--server</span> <span class="string">https://acme-v02.api.letsencrypt.org/directory</span> <span class="string">--dry-run</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./nginx/certbot/conf:/etc/letsencrypt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./nginx/certbot/logs:/var/log/letsencrypt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./nginx/certbot/data:/var/www/certbot</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./nginx/ssl:/secrets</span></span><br></pre></td></tr></table></figure> <div class="note info flat no-icon flat"><p>ğŸ’¡ åƒæ•¸ä»‹ç´¹<br>â€“preferred-challengesï¼šæŒ‡å®š Certbot å®¢æˆ¶ç«¯æ‡‰è©²ä½¿ç”¨å“ªç¨®æ–¹æ³•ä¾†è­‰æ˜æ‚¨æ§åˆ¶è«‹æ±‚è­‰æ›¸çš„åŸŸåã€‚Certbot å®¢æˆ¶ç«¯æ”¯æ´å¤šç¨®ä¸åŒçš„æŒ‘æˆ°é¡å‹ï¼ŒåŒ…æ‹¬ HTTPã€DNS å’Œ TLS-SNIï¼Œå¦‚æœæŒ‡å®š â€“preferred-challenges dnsï¼ŒCertbot å®¢æˆ¶ç«¯å°‡é¦–å…ˆå˜—è©¦é€šéå°‡ç‰¹å®šçš„ DNS è¨˜éŒ„æ·»åŠ åˆ°æ‚¨çš„åŸŸåçš„ DNS é…ç½®ä¸­ä¾†è­‰æ˜æ‚¨çš„åŸŸåæ§åˆ¶æ¬Šã€‚<br>â€“dns-googleï¼šå‘Šè¨´ Certbot å®¢æˆ¶ç«¯ä½¿ç”¨ Google Cloud DNS API åœ¨è­‰æ›¸ç™¼è¡Œéç¨‹ä¸­æ·»åŠ å’Œåˆªé™¤ç”¨æ–¼åŸŸåé©—è­‰çš„ DNS è¨˜éŒ„<br>â€“dns-google-credentialsï¼š æŒ‡æ§åˆ¶DNSæœå‹™é‡‘é‘°çš„æª”æ¡ˆä½ç½®</p></div></li><li><p>æ’°å¯«ç’°å¢ƒè®Šæ•¸(.env)</p><p> åœ¨docker-composeLE.ymlçš„certbot commandå¯ä»¥çœ‹åˆ°æœ‰ä½¿ç”¨åˆ°ç’°å¢ƒè®Šæ•¸ï¼Œè€Œé€™éƒ¨åˆ†å¯ä»¥è¨­å®šåœ¨.envæª”ä¸­ï¼Œè®“docker-composeè‡ªå‹•è®€å–</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HOST_DOMAIN=&lt;è¦è¨»å†Šçš„åŸŸå&gt;</span><br><span class="line">WILDCARD_DOMAIN=&lt;è¦è¨»å†Šçš„è¬ç”¨åŸŸå&gt;</span><br><span class="line">HOST_EMAIL=&lt;ä¿¡ç®±&gt;</span><br></pre></td></tr></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™-1"><a href="#å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™-1" class="headerlink" title="å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™"></a>å•Ÿå‹•ä¸»è¦å®¹å™¨æœå‹™</h3><p>æˆ‘å€‘å·²ç¶“å»ºç«‹å¥½éœ€è¦çš„æœå‹™åœ¨docker-compose.ymlä¸Šäº†ï¼Œæ¥è‘—åªè¦ä½¿ç”¨docker-composeçš„æŒ‡ä»¤å°±å¯ä»¥ä¸€æ¬¡å»ºç«‹å¥½å®¹å™¨ã€‚</p><p>é€šå¸¸å–®ä¸€åŸŸåçš„æ†‘è­‰ç”³è«‹æœƒé ˆè¦é©—è­‰ç‰¹å®šç›®éŒ„æ˜¯å¦èƒ½æ­£å¸¸è¨ªå•ä¸”å«æœ‰æœå‹™å»ºç«‹å¥½çš„æ¨™èªŒï¼Œå› æ­¤å…ˆå•Ÿå‹•å®¹å™¨æœå‹™è®“ç€è¦½å™¨è¼¸å…¥åŸŸåå¯ä»¥æ­£å¸¸è¨ªå•</p><p>åœ¨docker-compose.ymlæª”æ¡ˆçš„ç›®éŒ„ä¸‹åŸ·è¡Œå»ºç½®æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸ·è¡Œå·²å¯«å¥½çš„docker-compose.yml</span></span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><div class="note info flat no-icon flat"><p>ğŸ’¡ åŸ·è¡Œéç¨‹ä¸­ä¸€é–‹å§‹localç«¯å°šæœªæ“æœ‰nginxã€jenkinsã€cerbotçš„imagesï¼Œå› æ­¤ä¸€é–‹å§‹æœƒå…ˆé€²è¡Œpullä¸‹è¼‰</p></div><h3 id="å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹-1"><a href="#å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹-1" class="headerlink" title="å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹"></a>å•Ÿå‹•é¦–æ¬¡æ†‘è­‰ç”³è«‹å®¹å™¨æœå‹™ï¼Œå®ŒæˆSSLæ†‘è­‰ç”³è«‹</h3><p>æŒ‡å®šå•Ÿå‹•docker-composeLE.ymlçš„æœå‹™ï¼Œæ¥è‘—æœƒåŸ·è¡Œcerboté å…ˆå¯«å¥½çš„command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-composeLE.yml up</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šæˆ‘å€‘åœ¨æ­¤å¯çœ‹åˆ°æ†‘è­‰ç”³è«‹éç¨‹ï¼Œè‹¥å¤±æ•—å‰‡æœƒè¼¸å‡ºç›¸é—œéŒ¯èª¤è¨Šæ¯æ–¼çµ‚ç«¯æ©Ÿä¸Š</p><h3 id="å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx-1"><a href="#å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx-1" class="headerlink" title="å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx"></a>å°‡Nginxä¼ºæœå™¨è¨­å®šæ”¹ç‚ºSSLï¼Œä¸¦é‡æ–°è¼‰å…¥Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain.com;</span><br><span class="line">    location ~ /.well-known/acme-challenge &#123;</span><br><span class="line">        allow all;</span><br><span class="line">        root /var/www/certbot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> 301 https://your_domain.com<span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name your_domain.com;</span><br><span class="line">    </span><br><span class="line">    ssl_certificate /etc/nginx/ssl/live/gcp12893678.tk/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/live/gcp12893678.tk/privkey.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆå¾Œé‡æ–°æ•´ç†nginxä¼ºæœå™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p>è¨ªå•è‡ªå·±çš„åŸŸåçœ‹çœ‹æœ‰æ²’æœ‰æˆåŠŸé–‹å•ŸSSLæ†‘è­‰å§</p><h3 id="æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰-1"><a href="#æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰-1" class="headerlink" title="æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰"></a>æ›´æ–°æ†‘è­‰å®¹å™¨ï¼Œå®Œæˆè‡ªå‹•åŒ–æ›´æ–°SSLæ†‘è­‰</h3><p>é‚„è¨˜å¾—docker-compose.ymlä¸Šæœ‰æ’°å¯«cerbotå®¹å™¨å—ï¼Œé€éå†æ¬¡å•Ÿå‹•ä¸‹æ–¹æŒ‡ä»¤ï¼Œå°‡é¦–æ¬¡ç”³è«‹ç”¨çš„å®¹å™¨æ›¿ä»£å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>é€éDocker composeæ–¹å¼ä½¿æˆ‘å€‘ç„¡é ˆæ‰‹å‹•å®‰è£Nginxä»¥åŠæ†‘è­‰æœå‹™ï¼Œå¤§éƒ¨åˆ†é€éè¨­å®šå³å¯ã€‚ç”šè‡³ä»Šå¾Œåªéœ€è¦åšå¥½ç¯„æœ¬ï¼Œå°±å¯ä»¥å¾ˆä¾¿æ·ä½ˆç½²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webä¼ºæœå™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> ssl </tag>
            
            <tag> dns </tag>
            
            <tag> certbot </tag>
            
            <tag> cloudflare </tag>
            
            <tag> google cloud </tag>
            
            <tag> docker compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLab + Jenkins å»ºç½®CICDæµç¨‹</title>
      <link href="/posts/GitLab%20%E5%92%8C%20Jenkins%20%E5%BB%BA%E7%BD%AECICD%E6%B5%81%E7%A8%8B/"/>
      <url>/posts/GitLab%20%E5%92%8C%20Jenkins%20%E5%BB%BA%E7%BD%AECICD%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨è»Ÿé«”å·¥ç¨‹ä¸­ï¼Œé »ç¹çš„äº¤ä»˜æ–°çš„è»Ÿé«”ç‰ˆæœ¬æ˜¯å¸¸è¦‹çš„ç¾è±¡ã€‚è€Œ <mark class="hl-label default">åœ¨è»Ÿé«”ç‰ˆæœ¬æŒçºŒæ›´æ–°çš„åŒæ™‚ï¼Œå¦‚ä½•ä¿è­‰ç¨‹å¼ä¿æŒä¸€å®šçš„å“è³ªå‘¢ï¼Ÿ</mark>  è‹¥æ¯ä¸€æ¬¡çš„å°éƒ¨åˆ†æ›´å‹•éƒ½äº¤ç”±äººåŠ›ä¾†ç›£ç®¡å“è³ªï¼Œå‰‡æ¶ˆè€—å¤§é‡äººåŠ›æˆæœ¬ï¼Œä¸”è€—è²»æ™‚é–“ä¹Ÿå°‡æå‡ã€‚å› æ­¤åœ¨æ‡‰ç”¨ç¨‹å¼çš„æäº¤ã€å»ºç½®ã€æ¸¬è©¦å’Œéƒ¨ç½²ä¸­å¯¦æ–½è‡ªå‹•åŒ–ï¼Œé€éæ¯æ¬¡è‡ªå‹•åŒ–çš„æµç¨‹é”æˆæŒçºŒæ•´åˆã€æŒçºŒäº¤ä»˜èˆ‡æŒçºŒä½ˆç½²ã€‚</p><h3 id="ä»€éº¼æ˜¯CI-Continuous-Integration-æŒçºŒæ•´åˆ"><a href="#ä»€éº¼æ˜¯CI-Continuous-Integration-æŒçºŒæ•´åˆ" class="headerlink" title="ä»€éº¼æ˜¯CI(Continuous Integration, æŒçºŒæ•´åˆ)?"></a>ä»€éº¼æ˜¯CI(Continuous Integration, æŒçºŒæ•´åˆ)?</h3><p>æŒçºŒæ•´åˆ(CI)æ˜¯é–‹ç™¼äººå“¡å°‡è»Ÿé«”ç³»çµ±æ¯å€‹è®Šå‹•å¯¦è¡Œè‡ªå‹•åŒ–é©—è­‰ï¼Œå…¶ä¸­é©—è­‰åŒ…å«ï¼šå°ˆæ¡ˆå»ºç½®(build)ã€æ¸¬è©¦(test)ã€ç¨‹å¼ç¢¼å®‰å…¨åˆ†æ(analysis)ç­‰ç­‰ï¼Œè‹¥é©—è­‰é€šéä»£è¡¨æ­¤æ¬¡æäº¤çš„æ›´å‹•ç‰ˆæœ¬å°éå»è¨­ç½®çš„æ¨™æº–ï¼Œå¯ä»¥ç¢ºå®šæ–°ç‰ˆç¨‹å¼ç¢¼å’ŒåŸæœ‰çš„èƒ½å¦æ­£ç¢ºåœ°æ•´åˆåœ¨ä¸€èµ·ã€‚é€™ä¸€ç³»åˆ—çš„é©—è­‰æœƒäº¤ç”±è‡ªå‹•åŒ–å·¥å…·åŸ·è¡Œï¼ŒDevOpsäººå“¡åªéœ€è¦å°‡å·¥å…·çš„è§¸ç™¼ã€åŸ·è¡Œç­‰è¨­å®šå®Œæˆå³å¯è‡ªå‹•åŒ–é‹ä½œã€‚å¸¸è¦‹çš„CIå·¥å…·å¦‚ä¸‹ï¼š</p><ul><li>Jenkins</li><li>Drone</li><li>Circle CI</li><li>GitLab CI</li></ul><h3 id="ä»€éº¼æ˜¯CD-Continuous-delivery-Continuous-deployment-æŒçºŒäº¤ä»˜-æŒçºŒä½ˆç½²"><a href="#ä»€éº¼æ˜¯CD-Continuous-delivery-Continuous-deployment-æŒçºŒäº¤ä»˜-æŒçºŒä½ˆç½²" class="headerlink" title="ä»€éº¼æ˜¯CD(Continuous delivery / Continuous deployment, æŒçºŒäº¤ä»˜/æŒçºŒä½ˆç½²)?"></a>ä»€éº¼æ˜¯CD(Continuous delivery / Continuous deployment, æŒçºŒäº¤ä»˜/æŒçºŒä½ˆç½²)?</h3><p>æŒçºŒäº¤ä»˜(CD)æ˜¯åœ¨æŒçºŒæ•´åˆçš„åŸºç¤ä¸Šï¼Œå°‡æ•´åˆçš„å°ˆæ¡ˆé€²ä¸€æ­¥æ¸¬è©¦ï¼Œå˜—è©¦å°‡å°ˆæ¡ˆä½ˆç½²è‡³èˆ‡æ­£å¼ç‰ˆæœ¬ç’°å¢ƒç›¸ä¼¼çš„ç’°å¢ƒä¸Šï¼Œä¸¦ä¸”ä¿æŒåœ¨éš¨æ™‚å¯ä»¥ç”¢å‡ºçš„ç‹€æ³ã€‚ä¾‹å¦‚å°‡ç¨‹å¼ä½ˆç½²å¾Œåœ¨æ¸¬è©¦ç’°å¢ƒé€²è¡Œå‹•æ…‹æ¸¬è©¦ï¼Œæª¢é©—å¯¦éš›é‹è¡Œæ˜¯å¦æµæš¢ã€‚åœ¨å®ŒæˆæŒçºŒäº¤ä»˜å¾Œå¯ä»¥é¸æ“‡è‡ªå‹•/æ‰‹å‹•é€²è¡Œæ¥çºŒçš„è‡ªå‹•ä½ˆç½²è‡³æ­£å¼ç’°å¢ƒï¼Œä»¥å•Ÿç”¨æ–°ç‰ˆæœ¬å…§å®¹ã€‚</p><p>æŒçºŒä½ˆç½²(CD)æ˜¯åœ¨å®ŒæˆæŒçºŒäº¤ä»˜å¾Œé€²è¡Œè‡ªå‹•ä½ˆç½²è‡³ç”Ÿç”¢ç’°å¢ƒçš„æµç¨‹ï¼Œä»£è¡¨å°ˆæ¡ˆçš„è®Šå‹•å°‡å¥—ç”¨è‡³ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œæ­¤å¤–ä¹Ÿå°‡åŸ·è¡Œç›£æ§ç³»çµ±éš¨æ™‚æª¢æ¸¬ç³»çµ±æœ‰ç„¡ç•°å¸¸ã€‚</p><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>æµç¨‹åˆ†æ</li><li>ç’°å¢ƒæº–å‚™<ul><li>Docker &amp; Docker Composeå®‰è£</li><li>é–‹æºæŒçºŒæ•´åˆCIå·¥å…·ã€Œ Jenkins ã€å®‰è£</li><li>é–‹æºç¨‹å¼ç¢¼åˆ†æç³»çµ±ã€Œ SonarQube ã€å®‰è£</li><li>Jenkins ç’°å¢ƒè¨­ç½® (æ’ä»¶å®‰è£èˆ‡è¨­å®š)</li></ul></li><li>Jenkins å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹<ul><li>è¨­ç½®ç¨‹å¼ç¢¼ç®¡ç†(SCM)</li><li>è¨­å®šå»ºç½®è§¸ç™¼ç¨‹åº(Trigger)</li><li>è¨­å®šå»ºç½®æµç¨‹(Build)</li><li>è¨­ç½®å»ºç½®å¾Œå‹•ä½œ(After Build)</li><li>åŸ·è¡Œå»ºç½®å°ˆæ¡ˆ</li><li>Webhookè‡ªå‹•åŒ–åŸ·è¡Œ</li></ul></li><li>Pipelineå½¢å¼å°ˆæ¡ˆå»ºç½®æµç¨‹<ul><li>æ’°å¯«Jenkins pipelineé…ç½®æª”</li></ul></li><li>Jenkinsåˆ†æ•£å¼å»ºæ§‹èˆ‡ä½ˆç½²<ul><li>ç¯€é»ç’°å¢ƒæº–å‚™</li><li>æ–°å¢ç¯€é»</li><li>åœ¨pipelineä¸ŠæŒ‡å®šç¯€é»åŸ·è¡Œ</li></ul></li></ul><h2 id="æµç¨‹åˆ†æ"><a href="#æµç¨‹åˆ†æ" class="headerlink" title="æµç¨‹åˆ†æ"></a>æµç¨‹åˆ†æ</h2><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-process.jpg" alt="Untitled"></p><h2 id="ç’°å¢ƒæº–å‚™"><a href="#ç’°å¢ƒæº–å‚™" class="headerlink" title="ç’°å¢ƒæº–å‚™"></a>ç’°å¢ƒæº–å‚™</h2><p>é›–ç„¶å¯ä»¥ä½¿ç”¨ä¸€èˆ¬æ–¹å¼å®‰è£Jenkinsèˆ‡SonarQubeï¼Œä½†æƒ³åˆ°ç¹ç‘£çš„å®‰è£æ­¥é©Ÿã€ç‰ˆæœ¬æ›´æ–°ï¼Œå°±é¸æ“‡ä½¿ç”¨Dockerèˆ‡Docker Composeå®‰è£å•¦</p><div class="note info flat"><p>Docker å°‡è»Ÿé«”å°è£åˆ°åç‚ºå®¹å™¨çš„æ¨™æº–åŒ–å–®ä½ï¼Œå®¹å™¨æ˜¯åœ¨ä½œæ¥­ç³»çµ±å±¤ä¸Šè™›æ“¬åŒ–ï¼Œä¸¦å°‡å®¹å™¨ç¨ç«‹ç’°å¢ƒä¸”ç›´æ¥ä½¿ç”¨ç³»çµ±OSè³‡æºï¼Œç„¡é ˆå®‰è£/è™›æ“¬åŒ–ä½œæ¥­ç³»çµ±ã€‚é€éDockerå¯ä»¥æœ€å°åŒ–æ–¹å¼å»ºç«‹å¾®æœå‹™ä¸”èƒ½å¿«é€Ÿå•Ÿå‹•ã€åœæ­¢ã€åˆªé™¤ç­‰æ“ä½œã€‚å…¶ä¸­Jekinsèˆ‡SonarQubeéƒ½æœ‰å„è‡ªçš„imageæä¾›åœ¨Docker hubä¸Šã€‚</p></div><div class="note success flat"><p>Docker Composeæ˜¯ç‚ºäº†å”åŠ©å®šç¾©å’Œé‹è¡Œå¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼è€Œé–‹ç™¼çš„å·¥å…·ï¼Œåˆ©ç”¨ YAML æª”æ¡ˆä¾†é…ç½®éœ€è¦çš„æœå‹™ä»¥åŠæœå‹™çš„ç’°å¢ƒè¨­å®šã€‚åœ¨Docker Composeä¸­å®šç¾©å¥½Jenkinsèˆ‡SonarQubeå’ŒSonarQubeçš„è³‡æ–™åº«æœå‹™å¾Œï¼Œæœ€å¾Œåªéœ€è¦åŸ·è¡Œä¸€è¡ŒæŒ‡ä»¤å³å¯å»ºç½® (è¶…æ–¹ä¾¿ï¼)</p></div><h3 id="å®‰è£Docker"><a href="#å®‰è£Docker" class="headerlink" title="å®‰è£Docker"></a>å®‰è£Docker</h3><p>Dockerå®‰è£æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ç§»é™¤èˆŠç‰ˆæœ¬çš„docker</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure><p>å®‰è£å®Œæˆå¾Œï¼Œéœ€è¦çµ¦äºˆä½¿ç”¨è€…Dockeræ¬Šé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°‡$USERåŠ å…¥dockerç¾¤çµ„</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ›ç¾¤çµ„</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><h3 id="å®‰è£Docker-Compose"><a href="#å®‰è£Docker-Compose" class="headerlink" title="å®‰è£Docker Compose"></a>å®‰è£Docker Compose</h3><p>Docker Composeå®‰è£æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸ</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Docker-Composeå®‰è£Jenkins-amp-SonarQube"><a href="#ä½¿ç”¨Docker-Composeå®‰è£Jenkins-amp-SonarQube" class="headerlink" title="ä½¿ç”¨Docker Composeå®‰è£Jenkins &amp; SonarQube"></a>ä½¿ç”¨Docker Composeå®‰è£Jenkins &amp; SonarQube</h3><p>æˆ‘å€‘åœ¨æƒ³è¦å­˜æ”¾çš„docker-compose.ymlã€jenkinsã€sonarqubeç­‰è³‡æ–™çš„ç›®éŒ„æ–°å¢docker-compose.ymlï¼Œå…¶ä¸­docker-compose.ymlçš„å…§å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-composeçš„ç‰ˆæœ¬</span></span><br><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  jenkins:</span><br><span class="line">    image: jenkins/jenkins:lts</span><br><span class="line">    container_name: <span class="string">&#x27;jenkins&#x27;</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      - <span class="string">&quot;50000:50000&quot;</span></span><br><span class="line">mem_limit: 1024m</span><br><span class="line">    volumes:</span><br><span class="line">      - ./jenkins:/var/jenkins_home</span><br><span class="line">networks:</span><br><span class="line">      - devops</span><br><span class="line">      </span><br><span class="line">  sonarqube:</span><br><span class="line">    image: sonarqube:lts</span><br><span class="line">    container_name: <span class="string">&#x27;sonarqube&#x27;</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    environment:</span><br><span class="line">      SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonar</span><br><span class="line">      SONAR_JDBC_USERNAME: sonar</span><br><span class="line">      SONAR_JDBC_PASSWORD: sonar</span><br><span class="line">    volumes:</span><br><span class="line">      - ./sonarqube/sonarqube_data:/opt/sonarqube/data</span><br><span class="line">      - ./sonarqube/sonarqube_extensions:/opt/sonarqube/extensions</span><br><span class="line">      - ./sonarqube/sonarqube_logs:/opt/sonarqube/logs</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">networks:</span><br><span class="line">      - devops</span><br><span class="line">  db:</span><br><span class="line">    image: postgres:12</span><br><span class="line">    container_name: <span class="string">&#x27;postgres&#x27;</span></span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_USER: sonar</span><br><span class="line">      POSTGRES_PASSWORD: sonar</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db/postgresql:/var/lib/postgresql</span><br><span class="line">      - ./db/postgresql_data:/var/lib/postgresql/data</span><br><span class="line">networks:</span><br><span class="line">      - devops</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  devops:</span><br></pre></td></tr></table></figure><div class="note info flat"><p>åœ¨docker-compose.ymlä¸­è¨­ç½®äº†jenkinsã€sonarqubeã€database(sonarqubeç”¨çš„)æœå‹™ï¼Œè¨­å®šä¸­æ¯å€‹æœå‹™åŒ…å«äº†æ˜ åƒæª”(image)ã€é–‹æ”¾çš„portã€éœ€è¦æ˜ å°„åˆ°ä¸»æ©Ÿçš„è³‡æ–™(volumes)ç­‰ï¼Œä¹‹å¾Œåªè¦åœ¨docker-compose.ymlå°±å¯ä»¥çŸ¥é“ç•¶åˆçš„è¨­å®šï¼Œå¾ŒçºŒçš„æ›´æ”¹æˆ–æ˜¯æ“´å……éƒ½å¾ˆæ–¹ä¾¿</p></div><h3 id="å»ºç½®æœå‹™-amp-æ³¨æ„äº‹é …"><a href="#å»ºç½®æœå‹™-amp-æ³¨æ„äº‹é …" class="headerlink" title="å»ºç½®æœå‹™ &amp; æ³¨æ„äº‹é …"></a>å»ºç½®æœå‹™ &amp; æ³¨æ„äº‹é …</h3><p>åœ¨docker-compose.ymlçš„ç›®éŒ„ä¸‹åŸ·è¡Œå»ºç½®æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸ·è¡Œå·²å¯«å¥½çš„docker-compose.yml</span></span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>åœ¨å»ºç½®éç¨‹å¯èƒ½æœƒç™¼ç¾å®¹å™¨ä¸­é€”å¤±æ•—é€€å‡ºçš„å•é¡Œï¼ŒåŸå› æœ‰å¾ˆå¤šç¨®ï¼Œå¤§éƒ¨åˆ†åœ¨å»ºç½®éç¨‹çš„ç´€éŒ„éƒ½æœƒé¡¯ç¤ºåŸå› </p></div><h4 id="sonarqubeè™›æ“¬è¨˜æ†¶é«”è¨­å®š"><a href="#sonarqubeè™›æ“¬è¨˜æ†¶é«”è¨­å®š" class="headerlink" title="sonarqubeè™›æ“¬è¨˜æ†¶é«”è¨­å®š"></a>sonarqubeè™›æ“¬è¨˜æ†¶é«”è¨­å®š</h4><p>ç”±æ–¼SonarQube ä½¿ç”¨ an embedded Elasticsearch (å…¨æ–‡æª¢ç´¢å¼•æ“)ï¼Œæ‰€ä»¥è™›æ“¬æ©Ÿçš„é…ç½®è¦ç¬¦åˆ Elasticsearch production modeè¦æ±‚å’ŒFile Descriptorsé…ç½®ï¼Œå› æ­¤è™›æ“¬è¨˜æ†¶é«”éœ€è¦é”åˆ°ä»–çš„éœ€æ±‚<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-sonarqube-memory-problem.jpg" alt="Untitled"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ°¸ä¹…æ›´æ”¹çš„è©±ï¼Œéœ€åœ¨/etc/sysctl.confè¨­å®š</span></span><br><span class="line"></span><br><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br><span class="line">sudo sysctl -w fs.file-max=65536</span><br></pre></td></tr></table></figure><h4 id="Jenkinsæ¬Šé™è™•ç†"><a href="#Jenkinsæ¬Šé™è™•ç†" class="headerlink" title="Jenkinsæ¬Šé™è™•ç†"></a>Jenkinsæ¬Šé™è™•ç†</h4><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-problem.jpg" alt="Untitled"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uid 1000 ç‚º jenkinsç”¨æˆ¶ (jenkins image&#x27;s Dockerfile è¨­å®šçš„)</span></span><br><span class="line"><span class="comment"># ç”±æ–¼æˆ‘å€‘åœ¨volumesçš„è·¯å¾‘æ˜¯./jenkinsï¼Œæ‰€ä»¥æ˜¯å°è©²ç›®éŒ„é€²è¡Œæ¬Šé™è¨­å®šï¼Œ/var/jenkins_homeæ˜¯é è¨­ç›®éŒ„</span></span><br><span class="line">sudo mkdir ./jenkins</span><br><span class="line">sudo chown -R 1000:1000 ./jenkins</span><br></pre></td></tr></table></figure><p>æœå‹™å»ºç½®æˆåŠŸå¾Œæˆ‘å€‘å¯ä»¥é€édocker psæŒ‡ä»¤æŸ¥çœ‹ç›®å‰å®¹å™¨é‹è¡Œç‹€æ…‹<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-docker-ps.jpg" alt="Untitled"><br>åœ–ä¸­å¯çœ‹åˆ°Jenkinsé–‹æ”¾çš„portæ˜¯8080ï¼Œsonarqubeå‰‡æ˜¯9000<br>å› æ­¤åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹å°æ‡‰çš„portå¯ä»¥çœ‹åˆ°æœå‹™çš„é é¢</p><ul><li>jenkinsï¼šlocalhost:8080</li><li>sonarqubeï¼šlocalhost:9000</li></ul><div class="note info flat"><p><strong>Sonarqubeé è¨­å¸³è™Ÿå¯†ç¢¼</strong><br>default account: admin<br>default password: admin</p></div><h3 id="Jenkinsç’°å¢ƒè¨­ç½®"><a href="#Jenkinsç’°å¢ƒè¨­ç½®" class="headerlink" title="Jenkinsç’°å¢ƒè¨­ç½®"></a>Jenkinsç’°å¢ƒè¨­ç½®</h3><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>é€²å…¥jenkinsé é¢ä¸­æœƒç™¼ç¾jenkinsè¦æ±‚æˆ‘å€‘è¼¸å…¥åˆå§‹çš„ç®¡ç†å“¡å¯†ç¢¼ä»¥è§£é–jenkinsï¼Œå¯†ç¢¼æˆ‘å€‘å¯ä»¥åœ¨æ˜ å°„åˆ°localç«¯çš„jenkinsç›®éŒ„å¯ä»¥æ‰¾åˆ°(./jenkins/secrets/initialAdminPassword)</p><p>å°‡æª”æ¡ˆè£¡çš„å¯†ç¢¼è²¼ä¸Šå¾Œå°±é€²å…¥åˆ°ä¸‹å€‹é é¢å•¦<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-unlock.jpg" alt="Untitled"><br>Jenkinsæä¾›2ç¨®æ–¹å¼å®¢è£½åŒ–è‡ªå·±çš„Jenkinsï¼Œåˆ†åˆ¥æ˜¯<mark class="hl-label default">å®‰è£å»ºè­°çš„æ’ä»¶</mark>  å’Œ <mark class="hl-label default">è‡ªå·±é¸æ“‡æ’ä»¶å®‰è£</mark> ï¼Œå…©è€…çœ‹å€‹äººå–œå¥½é¸æ“‡ï¼Œä¹‹å¾Œéƒ½å¯ä»¥å†å®‰è£æˆ–åˆªé™¤å€‹åˆ¥æ’ä»¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-install-suggest.jpg" alt="Untitled"><br>é€™é‚Šæˆ‘é¸æ“‡å®‰è£å»ºè­°çš„æ’ä»¶ï¼Œåœ¨ä¸‹åœ–å¯ä»¥çœ‹åˆ°å®ƒå¹«æˆ‘å€‘å…ˆå®‰è£Gitã€Githubã€Gradleã€Piplelineã€Mailerç­‰æ’ä»¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-install-suggest-ing.jpg" alt="Untitled"><br><strong>è¨­å®šç¬¬ä¸€å€‹ç®¡ç†å“¡ä½¿ç”¨è€…</strong><br>å®‰è£æ’ä»¶å®Œæˆå¾Œæœƒè¦æ±‚æˆ‘å€‘è¨­å®šç®¡ç†å“¡çš„å¸³æˆ¶è³‡è¨Šï¼Œä¹Ÿå°±æ˜¯ä¹‹å¾Œç™»å…¥jenkinsçš„å¸³æˆ¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-setting-admin.jpg" alt="Untitled"></p><p><strong>è¨­å®šJenkins serverçš„ç¶²å€</strong><br>jenkinsä»¥åŠæ’ä»¶å¯èƒ½æœƒéœ€è¦ç”¨åˆ°ï¼Œæä¾›çµ¦ä½¿ç”¨è€…æ­£ç¢ºçš„ç¶²å€è·¯å¾‘<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-setting-url.jpg" alt="Untitled"></p><p>è¨­å®šå®Œç•¢å¾Œï¼Œå°±é€²å…¥åˆ°Jenkinsä¸»é é¢å•¦<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-setting-first.jpg" alt="Untitled"></p><h4 id="å®‰è£æ’ä»¶"><a href="#å®‰è£æ’ä»¶" class="headerlink" title="å®‰è£æ’ä»¶"></a>å®‰è£æ’ä»¶</h4><p>åœ¨jenkinså·¦å´é¸å–®ä¸­æœ‰Mange Jenkinsçš„é¸é …ï¼Œå…¶ä¸­åŒ…å«Jenkinsçš„ç›¸é—œè¨­å®šä»¥åŠå„æ’ä»¶è¨­å®š<br>é€™è£¡å°‡é å…ˆå®‰è£ä»¥ä¸‹æ’ä»¶ï¼Œåœ¨æ¥çºŒçš„å¯¦ä½œéç¨‹ä¸­æœƒä½¿ç”¨åˆ°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-manage-jenkins.jpg" alt="Untitled"></p><ol><li>åœ¨é€²å…¥ç®¡ç†æ’ä»¶é é¢å¾Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦é»é¸Availableé¸é …æ‰èƒ½æ‰¾åˆ°å°šæœªå®‰è£çš„æ’ä»¶</li><li>åœ¨ä½¿ç”¨å³ä¸Šçš„æœå°‹æ¬„æ‰¾åˆ°æ‰€éœ€çš„æ’ä»¶å§</li></ol><div class="tabs" id="jenkins-å„æ’ä»¶å®‰è£"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#jenkins-å„æ’ä»¶å®‰è£-1">GitLab</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶å®‰è£-2">SonarQube</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶å®‰è£-3">Jacoco</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶å®‰è£-4">OWASP Dependency Check</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶å®‰è£-5">Slack</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="jenkins-å„æ’ä»¶å®‰è£-1"><p>GitLabæ’ä»¶æ”¯æ´ä½¿ç”¨gitlab webhookä¾†è§¸ç™¼å»ºç½®ç¨‹åº<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-install-gitlab.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶å®‰è£-2"><p>SonarQubeæ’ä»¶æ”¯æ´å»ºç½®æ™‚ï¼Œæƒæç¨‹å¼ç¢¼åˆ†æç¨‹å¼ç¢¼å“è³ªèˆ‡å®‰å…¨<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-install-sonarqub.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶å®‰è£-3"><p>Jacocoæ’ä»¶æ›´æ–¹ä¾¿é¡¯ç¤ºç¨‹å¼ç¢¼è¦†è“‹ç‡å ±å‘Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-install-jacoco.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶å®‰è£-4"><p>OWASP Dependency Checkæ’ä»¶èƒ½æƒæåˆ†æå°ˆæ¡ˆä¾è³´å±éšª<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-install-dependency-check.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶å®‰è£-5"><p>Slackæ’ä»¶å¯ä»¥é€éå»ºç½®å®Œæˆç™¼é€é€šçŸ¥è‡³Slackä¸Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-install-slack.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="æ’ä»¶è¨­å®š"><a href="#æ’ä»¶è¨­å®š" class="headerlink" title="æ’ä»¶è¨­å®š"></a>æ’ä»¶è¨­å®š</h4><p>æœ‰äº›æ’ä»¶åœ¨Jenkinsç³»çµ±è¨­å®šé é¢æœƒæä¾›æ’ä»¶çš„å…¨åŸŸè¨­å®šï¼Œä¾‹å¦‚sonarqubeçš„ä¼ºæœå™¨ä½ç½®ã€æ¬Šé™ã€ç‰ˆæœ¬æˆ–æ˜¯slackçš„å·¥ä½œå€ã€æ¬Šé™ï¼Œé€™äº›å…±ç”¨æ€§çš„è¨­å®šç„¡éœ€åœ¨å°ˆæ¡ˆæµç¨‹ä¸­æ¯æ¬¡ç‰¹åˆ¥è¨­ç½®</p><div class="tabs" id="jenkins-å„æ’ä»¶è¨­å®š"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#jenkins-å„æ’ä»¶è¨­å®š-1">SonarQube</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶è¨­å®š-2">OWASP Dependency Check</button></li><li class="tab"><button type="button" data-href="#jenkins-å„æ’ä»¶è¨­å®š-3">Slack</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="jenkins-å„æ’ä»¶è¨­å®š-1"><p><strong>è¨­ç½®Sonarqube Server</strong><br>Jenkinséœ€è¦çŸ¥é“Sonarqube Serverçš„ç¶²å€ã€æ¬Šé™æ‰èƒ½ä¸²æ¥</p><p><strong>æ­¥é©Ÿ1ï¼š</strong>é¦–å…ˆåˆ°ç®¡ç†Jenkinsé¸å–®é ï¼Œä¸¦é»æ“Šç³»çµ±è¨­ç½®é¸é …<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-menu.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>æ‰¾åˆ°SonarQube serverså€å¡Šï¼Œæ–°å¢sonarqube server<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-server.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3ï¼š</strong>å¡«å…¥SonarQubeç›¸é—œè³‡è¨Š</p><ul><li>Nameï¼šè‡ªè¨‚åç¨± (è¾¨è­˜ä¸åŒserverç”¨é€”)</li><li>Server URLï¼šdocker composeæ¶è¨­çš„sonarqube serverçš„ URL</li><li>Server authentication tokenï¼šsonarqubeæ¬Šé™é‡‘é‘° (éœ€åœ¨sonarqubeå–å¾—é‡‘é‘°)</li></ul><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-server-setting.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3-1ï¼š</strong>å‰å¾€SonarQubeé é¢ç”¢ç”Ÿæ¬Šé™é‡‘é‘°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-sonarqube-security.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3-2ï¼š</strong>è¤‡è£½sonarqubeæ¬Šé™é‡‘é‘°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-sonarqube-auth-token.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3-3ï¼š</strong>è¨­ç½®sonarqubeæ¬Šé™ (é¸æ“‡æ¬Šé™é©—è­‰ç¨®é¡ï¼šSecret text)<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-server-credential.jpg" alt="Untitled"></p><p><strong>è¨­ç½®Sonarqube Scanner</strong><br>Sonarqube Scannerå¹«åŠ©æƒæå°ˆæ¡ˆç¨‹å¼ç¢¼</p><p><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨Jenkinsç®¡ç†é é¢é¸æ“‡å…¨åŸŸå·¥å…·è¨­ç½®<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-scanner.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>æ–°å¢Sonarqube Scannerï¼Œä¸¦é¸æ“‡åˆé©çš„ç‰ˆæœ¬<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-scanner-install.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶è¨­å®š-2"><p>åœ¨é€™é‚Šå°‡è¨­ç½®OWASP Dependency Checkçš„ç‰ˆæœ¬å’Œåç¨±</p><p><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨Jenkinsç®¡ç†é é¢é¸æ“‡å…¨åŸŸå·¥å…·è¨­ç½®<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-sonarqube-scanner.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>æ–°å¢OWASP Dependency Checkï¼Œä¸¦é¸æ“‡åˆé©çš„ç‰ˆæœ¬<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-dependency-check-setting.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="jenkins-å„æ’ä»¶è¨­å®š-3"><p>æˆ‘å€‘éœ€è¦å¾Slackå»ºç«‹æ©Ÿå™¨äººï¼Œä¸¦ä¸”å–å¾—slackä¸Šçš„ç¶²åŸŸå’Œé‡‘é‘°</p><p><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨Slackæ–°å¢Jenkins CIæ‡‰ç”¨ç¨‹å¼<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-slack-jenkins.jpg" alt="Untitled"><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-slack-jenkins-install.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>é¸æ“‡Jenkinsæ©Ÿå™¨äººç™¼é€šçŸ¥çš„é »é“<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-slack-jenkins-install-channel.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3ï¼š</strong>Slackä¸Šè©³ç´°èªªæ˜äº†æ¥çºŒè¨­å®šï¼Œå…¶ä¸­åŒ…å«ç¶²åŸŸå’Œæ¬Šé™<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-slack-jenkins-setting.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ4ï¼š</strong>åœ¨Slackè¨­ç½®ä¸­è¦æ±‚æˆ‘å€‘å¡«å…¥å·¥ä½œå€ç¶²å€ã€æ¬Šé™ã€é è¨­é »é“/æˆå“¡ID<br><strong>æ­¥é©Ÿ5ï¼š</strong>è¨­å®šå®Œæˆå¾Œå¯ä»¥é»æ“Šå³ä¸‹çš„Test Connectionæ¸¬è©¦æœ‰ç„¡æˆåŠŸï¼Œè‹¥æˆåŠŸJenkins botå°‡ç™¼é€ä¸€å‰‡æ¸¬è©¦è¨Šæ¯è‡³ç•¶åˆè¨­å®šçš„Slacké »é“ä¸Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-plugin-slack-setting.jpg" alt="Untitled"></p><p>æ¸¬è©¦å¾ŒJenkinsæ©Ÿå™¨äººå°‡ç™¼é€ä¸€å‰‡æ¸¬è©¦æ¶ˆæ¯åœ¨é »é“ä¸Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-slack-display.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹"><a href="#å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹" class="headerlink" title="å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹"></a>å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹</h2><p>ç’°å¢ƒè¨­å®šå®Œäº†å°±å¯ä»¥æ­£å¼é€²å…¥å»ºç«‹å°ˆæ¡ˆå»ºç½®æµç¨‹å•¦ï¼</p><p><strong>æ­¥é©Ÿ1ï¼š</strong>é¦–å…ˆåœ¨Jenkinsä¸»é é»æ“ŠNew Itemå‰µå»ºé …ç›®<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-homepage-click-new-item.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>è¼¸å…¥é …ç›®åç¨±ï¼Œé€™é‚Šé¸æ“‡Freestyle project(æä¾›å½ˆæ€§UIè¨­ç½®)<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-add-new-item.jpg" alt="Untitled"></p><p>åˆ°è¨­ç½®é é¢å¯ä»¥çœ‹åˆ°ä¸Šæ–¹æœ‰6å€‹é¸é …</p><ol><li>Generalï¼šä¸€èˆ¬è¨­å®š</li><li>Source Code Managementï¼šå°ˆæ¡ˆç¨‹å¼ç¢¼ç®¡ç†ï¼Œè®“JenkinsçŸ¥é“è¦Checkoutçš„å°ˆæ¡ˆï¼Œä»¥åŠåˆ†æ”¯</li><li>Build Triggersï¼šå»ºç½®è§¸ç™¼æ¢ä»¶ï¼Œé™¤äº†åœ¨UIä¸Šæ‰‹å‹•å»ºç½®ï¼Œä¹Ÿå¯ä»¥çµ¦äºˆè§¸ç™¼æ¢ä»¶ï¼Œä»¥è‡ªå‹•åŒ–åŸ·è¡Œ</li><li>Build Enviromentï¼šå»ºç½®ç’°å¢ƒ</li><li>Buildï¼šå»ºç½®å‹•ä½œ</li><li>Post-build Actionsï¼šå»ºç½®â€å¾Œâ€å‹•ä½œ (é€šçŸ¥ã€ç”¢ç”Ÿå ±å‘Šç­‰ç­‰)</li></ol><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-1.jpg" alt="Untitled"></p><h3 id="è¨­ç½®ç¨‹å¼ç¢¼ç®¡ç†-SCM"><a href="#è¨­ç½®ç¨‹å¼ç¢¼ç®¡ç†-SCM" class="headerlink" title="è¨­ç½®ç¨‹å¼ç¢¼ç®¡ç†(SCM)"></a>è¨­ç½®ç¨‹å¼ç¢¼ç®¡ç†(SCM)</h3><p><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨ç¨‹å¼ç¢¼ç®¡ç†å¿…é ˆè¨­å®šGit repositoriesï¼Œå¡«å…¥å°ˆæ¡ˆç¶²å€ä»¥åŠå°ˆæ¡ˆæ¬Šé™<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-scm.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>å°ˆæ¡ˆæ¬Šé™è¨­ç½®ä¸­å¯ä»¥ä½¿ç”¨UserName with passwordç¨®é¡ï¼Œè¼¸å…¥GitLab/Githubçš„å¸³å¯†å³å¯<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-scm-credentials.jpg" alt="Untitled"></p><p>æ¬Šé™è¨­ç½®å¥½å¾Œï¼ŒåŸå…ˆçš„ç´…å­—éŒ¯èª¤å°±æ¶ˆå¤±å•¦<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-scm-full.jpg" alt="Untitled"></p><h3 id="è¨­å®šå»ºç½®è§¸ç™¼ç¨‹åº-Trigger"><a href="#è¨­å®šå»ºç½®è§¸ç™¼ç¨‹åº-Trigger" class="headerlink" title="è¨­å®šå»ºç½®è§¸ç™¼ç¨‹åº(Trigger)"></a>è¨­å®šå»ºç½®è§¸ç™¼ç¨‹åº(Trigger)</h3><p>åœ¨å»ºç½®è§¸ç™¼æ¢ä»¶ä¸­å‹¾é¸ç•¶æœ‰pushè®Šæ›´è‡³GitLabæ™‚è§¸ç™¼ï¼Œä¸‹æ–¹æä¾›Push, Mergeç­‰äº‹ä»¶é¸æ“‡<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-trigger-gitlab.jpg" alt="Untitled"></p><h3 id="è¨­å®šå»ºç½®æµç¨‹-Build"><a href="#è¨­å®šå»ºç½®æµç¨‹-Build" class="headerlink" title="è¨­å®šå»ºç½®æµç¨‹(Build)"></a>è¨­å®šå»ºç½®æµç¨‹(Build)</h3><p>åœ¨å»ºç½®æµç¨‹ä¸­æˆ‘å¸Œæœ›ä¾åºåŸ·è¡Œ build â†’ Jacoco(unit testã€coverage rate) â†’ SonarQube â†’ Deoendency check </p><p><strong>è¨­ç½®Gradle</strong></p><p>é€™è£¡æˆ‘ä½¿ç”¨java gradleå°ˆæ¡ˆï¼Œæ–°å¢å‘¼å«gradle script(åœ¨å…ˆå‰åˆå§‹åŒ–æ™‚é¸æ“‡çš„å»ºè­°å®‰è£å…§æœ‰åŒ…å«gradleæ’ä»¶)<br>ç”±æ–¼æˆ‘å°ˆæ¡ˆå…§æœ‰gradle wrapperï¼Œå°±ä¸ä½¿ç”¨Jenkinsä¸Šçš„Gradleç’°å¢ƒäº† (PS. è‹¥éœ€è¦éœ€å‰å¾€æ’ä»¶è¨­å®šæ–°å¢Gradleç‰ˆæœ¬)<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-build-gradle.jpg" alt="Untitled"></p><div class="note info flat"><p>åœ¨gradle buildç”Ÿå‘½é€±æœŸä¸­testä¹ŸåŒ…å«åœ¨å…§(testå°‡åŸ·è¡Œjacocoçš„å–®å…ƒæ¸¬è©¦èˆ‡è¦†è“‹ç‡)</p></div><div class="note info flat"><p>ä½¿ç”¨mavenä¹Ÿæœ‰ç›¸æ‡‰çš„æ’ä»¶ï¼Œå…¶ä»–èªè¨€çš„å°ˆæ¡ˆä¹Ÿå¯ä»¥ç›´æ¥é¸æ“‡ä½¿ç”¨Execute shellæ–¹å¼è¼¸å…¥æŒ‡ä»¤æ–¹å¼</p></div><p><strong>è¨­ç½®SonarQube Scanner</strong><br>åœ¨Gradle buildå’Œtestå®Œæˆå¾Œæœƒæœ‰Java Classæª”å’Œjacoco reportï¼Œæ¥è‘—æä¾›çµ¦SonarQube Scanneræƒæ<br>æˆ‘å€‘éœ€è¦è¨­å®šç›¸é—œåƒæ•¸çµ¦Sonarqube ScannerçŸ¥é“</p><ul><li>sonar.projectKeyï¼šå°ˆæ¡ˆID (å¯è‡ªè¨‚)ï¼Œç”¨ä¾†è¾¨è­˜project</li><li>sonar.projectNameï¼šå°ˆæ¡ˆåç¨±ï¼Œæœƒé¡¯ç¤ºæ–¼sonarqubeä¸Š</li><li>sonar.projectVersionï¼šå°ˆæ¡ˆç‰ˆæœ¬</li><li>sonar.sourcesï¼šå°ˆæ¡ˆç¨‹å¼ç¢¼ä¾†æºä½ç½®</li><li>sonar.java.binariesï¼šå°ˆæ¡ˆç·¨è­¯Java Classä½ç½®</li><li>sonar.coverage.jacoco.xmlReportPathsï¼šJacocoå ±å‘Šè·¯å¾‘</li></ul><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-build-sonarqube-scanner-properties.jpg" alt="Untitled"></p><p><strong>è¨­ç½®Dependency-Check</strong><br>Dependency-CheckåŸºæœ¬ä¸Šä¸éœ€è¦è¨­å®šï¼Œåªè¦åœ¨æ’ä»¶è¨­å®šæ™‚æœ‰è¨­ç½®å¥½Dependency-Checkç‰ˆæœ¬å³å¯<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-build-dependency-check-setting.jpg" alt="Untitled"></p><h3 id="è¨­ç½®å»ºç½®å¾Œå‹•ä½œ-After-Build"><a href="#è¨­ç½®å»ºç½®å¾Œå‹•ä½œ-After-Build" class="headerlink" title="è¨­ç½®å»ºç½®å¾Œå‹•ä½œ(After Build)"></a>è¨­ç½®å»ºç½®å¾Œå‹•ä½œ(After Build)</h3><p>åœ¨å®Œæˆå»ºç½®å¾Œï¼Œæˆ‘å€‘å¯ä»¥åœ¨å»ºç½®å¾Œå‹•ä½œç”¢ç”Ÿä¸€äº›å ±å‘Šæˆ–è€…é€šçŸ¥</p><p><strong>ç”¢ç”ŸJacocoå ±å‘Š</strong><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-jacoco.jpg" alt="Untitled"><br>åŸºæœ¬ä¸Šä¸éœ€è¦è¨­å®š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-jacoco-setting.jpg" alt="Untitled"></p><p><strong>ç”¢ç”ŸDependency-Checkå ±å‘Š</strong><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-dependency-check.jpg" alt="Untitled"></p><p>å¯ä»¥æŒ‡å®šDependency-Checkç”¢å‡ºçš„å ±å‘Šæª”æ¡ˆè·¯å¾‘<br>PS. åŸºæœ¬ä¸Šåœ¨åœ–å½¢ä»‹é¢ä¸Šå°±æœ‰å ±å‘Šå¯ä»¥æŸ¥çœ‹<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-dependency-check-setting.jpg" alt="Untitled"></p><p><strong>ç™¼é€Slacké€šçŸ¥</strong><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-slack.jpg" alt="Untitled"></p><p>æˆ‘å€‘åœ¨æ’ä»¶è¨­å®šå·²ç¶“å®Œæˆä¸²æ¥ï¼Œé€™é‚Šåªéœ€è¦å‹¾é¸è§¸ç™¼æ¢ä»¶<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-setting-after-build-slack-setting.jpg" alt="Untitled"></p><h3 id="åŸ·è¡Œå»ºç½®å°ˆæ¡ˆ"><a href="#åŸ·è¡Œå»ºç½®å°ˆæ¡ˆ" class="headerlink" title="åŸ·è¡Œå»ºç½®å°ˆæ¡ˆ"></a>åŸ·è¡Œå»ºç½®å°ˆæ¡ˆ</h3><p>å®Œæˆå°ˆæ¡ˆå»ºç½®è¨­å®šå¾Œï¼Œç›®å‰æœ‰2ç¨®æ–¹å¼å¯ä»¥è§¸ç™¼å°ˆæ¡ˆå»ºç½®</p><ol><li>æ‰‹å‹•åŸ·è¡Œ</li><li>é€éå°ˆæ¡ˆè¨­ç½®çš„è§¸ç™¼å™¨æ¢ä»¶åŸ·è¡Œï¼Œå…ˆå‰è¨­ç½®æ˜¯ç•¶gitlabæœ‰push eventæ™‚</li></ol><p>ç‚ºäº†ç¢ºä¿å»ºç½®è¨­å®šæ²’æœ‰å‡ºéŒ¯ï¼Œå¯ä»¥å…ˆä½¿ç”¨æ‰‹å‹•æ–¹å¼åŸ·è¡Œ</p><p>åŸ·è¡Œå¾Œåœ¨å·¦ä¸‹å¯ä»¥çœ‹åˆ°æ­¤æ¬¡å»ºç½®çš„è³‡è¨Š(ç›®å‰é€²åº¦ä»¥åŠç·¨è™Ÿ(ç¬¬å¹¾æ¬¡åŸ·è¡Œ)ç­‰)ï¼Œè‹¥å»ºç½®å®Œç•¢å¾Œå‡ºç¾ä¸‰ç¨®çµæœï¼š</p><ul><li>ç´…ç‡ˆä»£è¡¨å¤±æ•—</li><li>æ©˜ç‡ˆä»£è¡¨ä¸ç©©å®š</li><li>ç¶ ç‡ˆä»£è¡¨æˆåŠŸ</li></ul><p>åœ¨å®Œæˆå»ºç½®å¾Œå¯ä»¥é»æ“Šå»ºç½®ç·¨è™ŸæŸ¥çœ‹æ­¤æ¬¡å»ºç½®çš„è©³ç´°å…§å®¹</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-status.jpg" alt="Untitled"></p><p>å¦å¤–åœ¨å»ºç½®çš„é–‹å§‹èˆ‡çµæŸæˆ‘å€‘æ‡‰è©²æœƒåœ¨Slackæ”¶åˆ°Jenkins botçš„æ¶ˆæ¯ï¼Œå…¶ä¸­Jenkinsæœƒé€šçŸ¥æ­¤æ¬¡å»ºç½®çš„ç‹€æ…‹ã€æ™‚é–“ï¼Œå¦å¤–ä¹Ÿé™„ä¸Šæ­¤æ¬¡å°ˆæ¡ˆå»ºç½®çš„é€£çµ (æˆ–è¨±æœƒæœ‰å¤šå€‹å°ˆæ¡ˆåŸ·è¡Œ)<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-notify-slack.jpg" alt="Untitled"></p><p>åœ¨å·¦å´é¸å–®é‚„æœ‰è¨±å¤šå…§å®¹å¯ä»¥æŸ¥çœ‹ï¼Œé‚„è¨˜å¾—æˆ‘å€‘å‰›æ‰è¨­å®šçš„å…¶ä»–å ±å‘Šå—?</p><ol><li>Console Outputï¼šæ•´å€‹å»ºç½®çš„æ­·ç¨‹</li><li>Coverage Reportï¼šå°ˆæ¡ˆè¦†è“‹ç‡å ±å‘Š (Jacoco)</li><li>Dependency-Checkï¼šå°ˆæ¡ˆä¾è³´æª¢æŸ¥å ±å‘Š</li></ol><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-record.jpg" alt="Untitled"></p><p><strong>Coverage Report</strong><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-record-jacoco.jpg" alt="Untitled"></p><p><strong>Dependency-Check</strong><br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-record-dependency-check.jpg" alt="Untitled"></p><p><strong>Sonarqube</strong><br>å‰‡éœ€åœ¨å°ˆæ¡ˆæµç¨‹ä¸»é é»æ“Šï¼Œä¸”è©³ç´°å…§å®¹éœ€è‡³sonarqubeä¼ºæœå™¨ç¶²é ä¸ŠæŸ¥çœ‹<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-record-sonarqube.jpg" alt="Untitled"></p><p>åœ¨Sonarqubeä¸Šå¯ä»¥çœ‹åˆ°å°ˆæ¡ˆçš„bugã€æ¼æ´ã€ä¸è‰¯ç¿’æ…£ã€æŠ€è¡“å‚µèŠ±è²»æ™‚é–“ç­‰<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-free-style-project-run-record-sonarqube-server.jpg" alt="Untitled"></p><p>å¦‚æœæ‰‹å‹•å»ºç½®æœ‰æˆåŠŸçš„è©±ï¼Œå¯ä»¥è©¦è©¦çœ‹é€éGitalb webhookè§¸ç™¼</p><p><strong>GitLab webhookè¨­å®š</strong><br><strong>æ­¥é©Ÿ1ï¼š</strong>é¦–å…ˆåˆ°GitLabå°ˆæ¡ˆé é¢ä¸Šï¼Œé¸æ“‡Setting -&gt; Integrations -&gt; Jenkins CI<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-gitlab-jenkins-webhook.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>é€™é‚Šå¡«ä¸ŠJenkins urlï¼Œæ³¨æ„æ˜¯domain + portï¼Œä¸éœ€è¦å­è·¯å¾‘å–”<br>Project nameå¡«ä¸ŠJenkinsä¸Šæ–°å¢é …ç›®çš„åç¨±<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-gitlab-jenkins-webhook-setting.jpg" alt="Untitled"></p><p>è‹¥ä½¿ç”¨Gitlab webhookç™¼é€çš„æ–¹å¼è§¸ç™¼çš„è©±ï¼Œå¯ä»¥åœ¨è©²æ¬¡å»ºç½®çš„è§¸ç™¼è€…ï¼ŒSlackä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-gitlab-jenkins-run-status.jpg" alt="Untitled"></p><h2 id="Pipelineå½¢å¼å°ˆæ¡ˆå»ºç½®æµç¨‹"><a href="#Pipelineå½¢å¼å°ˆæ¡ˆå»ºç½®æµç¨‹" class="headerlink" title="Pipelineå½¢å¼å°ˆæ¡ˆå»ºç½®æµç¨‹"></a>Pipelineå½¢å¼å°ˆæ¡ˆå»ºç½®æµç¨‹</h2><p>å‰›æ‰æˆ‘å€‘ä½¿ç”¨Free-Styleçš„å½¢å¼å»ºç½®å°ˆæ¡ˆæµç¨‹ï¼Œå…¶ä¸­å¯ä»¥é€éåœ¨Jenkinsä¸ŠUIé»é¸è¼¸å…¥å½¢å¼è‡ªå®šç¾©å…§å®¹ã€‚é‚£Pipelineå½¢å¼æœ‰ä½•ä¸åŒå‘¢? Pipelineæœ‰2å€‹ä¸éŒ¯çš„ç‰¹é»</p><ol><li>ç¨‹å¼ç¢¼å½¢å¼ç°¡æ½”æ˜“è®€çš„è¨­å®šå…§å®¹</li><li>é…ç½®æª”æ•´åˆè‡³gitå°ˆæ¡ˆä¸Šï¼Œä¾›é–‹ç™¼äººå“¡åœ¨é–‹ç™¼å°ˆæ¡ˆæ™‚å³å¯äº†è§£å»ºç½®æµç¨‹</li></ol><p><strong>æ–°å¢é …ç›®</strong><br><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨æ–°å¢é …ç›®ç¨®é¸æ“‡Pipeline<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-pipeline-add.jpg" alt="Untitled"></p><p>æ–°å¢å¾Œé€²å…¥è¨­å®šé é¢ï¼Œæœƒç™¼ç¾Jenkinsæœ‰æä¾›éƒ¨åˆ†UIè¨­å®šï¼Œä¸»è¦æ˜¯çµ¦å°‡Pipelineå¯«åœ¨Jenkinsä¸Šçš„äººä½¿ç”¨çš„æˆ–è€…ä¸€äº›Pipelineè¨­å®šçš„é¸æ“‡ï¼Œè‹¥<strong>æ­¥é©Ÿ2ï¼š</strong>é¸æ“‡pipelineé…ç½®æª”åœ¨Gitå°ˆæ¡ˆä¸Šå‰‡éœ€è¦åˆ‡æ›é¸é …<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-pipeline-setting-1.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3ï¼š</strong>é€™é‚Šåªéœ€è¦è¨­ç½®Gitå°ˆæ¡ˆçš„è³‡è¨Šå³å¯<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-pipeline-setting-scm.jpg" alt="Untitled"></p><h3 id="æ’°å¯«Jenkins-pipelineé…ç½®æª”"><a href="#æ’°å¯«Jenkins-pipelineé…ç½®æª”" class="headerlink" title="æ’°å¯«Jenkins pipelineé…ç½®æª”"></a>æ’°å¯«Jenkins pipelineé…ç½®æª”</h3><p>é¦–å…ˆJenkins pipelineé…ç½®æª”é è¨­æ˜¯å°ˆæ¡ˆæ ¹ç›®éŒ„çš„Jenkinsfileæª”æ¡ˆï¼Œå¦‚æœæƒ³æ›´æ›ä½ç½®å¯ä»¥åœ¨Jenkinsçš„UIä¸Šè¨­å®š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-pipeline-jenkinsfile-setting.jpg" alt="Untitled"></p><p>æ’°å¯«æ–¹æ³•å¾ˆç°¡å–®ï¼Œä½¿ç”¨å¤§æ‹¬å¼§å½¢å¼ä¸¦é…åˆé—œéµèªæ„å³å¯ï¼š</p><ul><li>pipelineï¼šæ•´å€‹æµç¨‹çš„æœ€å¤–å±¤</li><li>agentï¼šæ˜¯æŒ‡å®šåŸ·è¡Œæ™‚çš„ç¯€é»</li><li>stagesï¼šæ˜¯è¨­ç½®éšæ®µåŸ·è¡Œå…§å®¹èˆ‡ç’°å¢ƒï¼Œæˆ‘å€‘å¯ä»¥ç‚ºstageæœ‰å€‹æš±ç¨±ï¼ŒåŸ·è¡Œæ™‚åœ¨Jenkinsä¸Šå¯ä»¥æ›´ç›´è§€çœ‹å‡ºç¾åœ¨çš„é€²åº¦</li><li>postï¼šæ˜¯å»ºç½®å¾Œéœ€è¦åŸ·è¡Œçš„æ­¥é©Ÿï¼Œé€™é‚Šæˆ‘å€‘å¯ä»¥åšå ±å‘Šç”¢å‡ºã€é€šçŸ¥ç­‰ï¼Œå¦å¤–postæä¾›å„ç¨®ç‹€æ…‹å¯ä»¥é™„åŠ çš„å‹•ä½œ<strong>alwaysã€changedã€fixedã€regressionã€abortedã€failureã€successã€unstableã€unsuccessful å’Œ cleanup</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Checkout SCM&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Checkout SCM&#x27;</span></span><br><span class="line">                git url: <span class="string">&#x27;https://gitlab-se.ntcu.edu.tw/ntcu-acs106103/shape-by-gradle.git&#x27;</span>, branch: <span class="string">&#x27;master&#x27;</span>, credentialsId: <span class="string">&#x27;gitlab-user&#x27;</span>   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Building&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;chmod +x ./gradlew&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;./gradlew clean build&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Analyze&#x27;</span>) &#123;</span><br><span class="line">            environment &#123;</span><br><span class="line">                scannerHome = tool <span class="string">&#x27;SonarQube 4.6.2&#x27;</span> // SonarQube Scanner è©²ç‰ˆæœ¬Name</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Analyzing&#x27;</span></span><br><span class="line">                withSonarQubeEnv(<span class="string">&#x27;sonarqube&#x27;</span>) &#123; // SonarQube servers Name</span><br><span class="line">                    sh <span class="string">&quot;<span class="variable">$&#123;scannerHome&#125;</span>/bin/sonar-scanner &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.projectKey=spring-first-project &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.projectName=spring-first-project &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.sources=./src &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.java.binaries=./build/classes/java &quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            junit <span class="string">&#x27;build/test-results/**/*.xml&#x27;</span></span><br><span class="line">            jacoco()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>Checkout SCMæ˜¯å¯ä»¥çœç•¥çš„ï¼Œå› ç‚ºåœ¨Jenkinsä¸Šæˆ‘å€‘å·²ç¶“è¨­ç½®äº†Gitå°ˆæ¡ˆ<br>è‹¥å°‡pipelineè¨­ç½®åœ¨Jenkinsä¸Šå‰‡éœ€è¦æ’°å¯«</p></div><p>è¨­å®šå®Œæˆå¾Œpushè‡³gitlabä¸Šï¼Œæˆ‘å€‘ä¸€æ¨£å…ˆé€²è¡Œæ‰‹å‹•å»ºç½®<br>è‹¥è¦Gitlab webwookè§¸ç™¼å‰‡é ˆåœ¨Jenkins UIè¨­å®štriggerï¼Œç•¢ç«ŸJenkinsfileåœ¨Gitä¸Š</p><h2 id="Jenkinsåˆ†æ•£å¼å»ºæ§‹èˆ‡ä½ˆç½²"><a href="#Jenkinsåˆ†æ•£å¼å»ºæ§‹èˆ‡ä½ˆç½²" class="headerlink" title="Jenkinsåˆ†æ•£å¼å»ºæ§‹èˆ‡ä½ˆç½²"></a>Jenkinsåˆ†æ•£å¼å»ºæ§‹èˆ‡ä½ˆç½²</h2><p>Jenkinsæä¾›æ–°å¢ç¯€é»åŠŸèƒ½ï¼Œä½¿Jenkinså¯ä»¥å°‡ä»»å‹™æ´¾ç™¼çµ¦å…¶ä»–ç¯€é»ï¼ŒåŠ å¿«ä½œæ¥­åŸ·è¡Œä»¥åŠæ¸›å°‘Jenkinsä¸»æ©Ÿå·¥ä½œè² è¼‰é‡(workload)ï¼Œä»¥ç¢ºä¿ Jenkins å¯ä»¥ä¿æŒåœ¨æœ€ä½³çš„é‹ä½œç‹€æ…‹ä¸‹ã€‚</p><p>å¦å¤–æˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨æŒ‡å®šç¯€é»åŸ·è¡Œå°ˆæ¡ˆå…§å®¹é”åˆ°ä½ˆç½²æ•ˆæœ</p><h3 id="ç¯€é»ç’°å¢ƒæº–å‚™"><a href="#ç¯€é»ç’°å¢ƒæº–å‚™" class="headerlink" title="ç¯€é»ç’°å¢ƒæº–å‚™"></a>ç¯€é»ç’°å¢ƒæº–å‚™</h3><p>æˆ‘å€‘éœ€è¦ç‚ºå¦ä¸€å°serveræº–å‚™jenkinsçš„ä½¿ç”¨è€…ã€å·¥ä½œå€ä»¥åŠJava8ç’°å¢ƒ</p><p><strong>æ–°å¢ä½¿ç”¨è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å¢ä½¿ç”¨è€…</span></span><br><span class="line">sudo adduser jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ›ä½¿ç”¨è€…</span></span><br><span class="line">su jenkins</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-user-add.jpg" alt="Untitled"></p><p><strong>æ–°å¢ä½¿ç”¨è€…çš„sshå…¬ç§é‘° &amp; å®‰è£Java 8</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">ssh-keygen -f <span class="string">&quot;jenkinsAgent_rsa&quot;</span></span><br><span class="line">cat jenkinsAgent_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys ~/.ssh/jenkinsAgent_rsa</span><br><span class="line"></span><br><span class="line">cat ~/.ssh/jenkinsAgent_rsa</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£Java 8</span></span><br><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢ç¯€é»"><a href="#æ–°å¢ç¯€é»" class="headerlink" title="æ–°å¢ç¯€é»"></a>æ–°å¢ç¯€é»</h3><p><strong>æ­¥é©Ÿ1ï¼š</strong>åœ¨ç®¡ç†Jenkinsé é¢é»æ“Šç®¡ç†ç¯€é»<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-add.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ2ï¼š</strong>æ–°å¢ç¯€é»<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new.jpg" alt="Untitled"></p><p><strong>æ­¥é©Ÿ3ï¼š</strong>è¼¸å…¥ç¯€é»åç¨±ä»¥åŠå‹¾é¸é¡åˆ¥<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new-1.jpg" alt="Untitled"></p><ol><li>Remote root directoryï¼šé ç«¯æ ¹ç›®éŒ„ï¼Œå°±åƒæ˜¯Jenkins Homeä¸€æ¨£æœƒæ”¾ç½®å·¥ä½œå€çš„å…§å®¹</li><li>Usageï¼šä½¿ç”¨æ¨¡å¼ï¼Œé€™é‚Šæˆ‘æ˜¯è¨­ç½®åªæœ‰æŒ‡å®šè©²ç¯€é»æ™‚æ‰ä½¿ç”¨</li><li>Launch methodï¼šå•Ÿå‹•æ–¹å¼ï¼Œé€éSSHæ–¹å¼</li><li>Hostï¼šä¸»æ©ŸIP</li><li>Credentialsï¼šæ¬Šé™èªè­‰ï¼Œé©—è­‰ä½¿ç”¨SSHæ–¹å¼ï¼Œé™„ä¸Šprivate key</li><li>Host Key Verification Strategyï¼šé‡‘é‘°èªè­‰ç­–ç•¥ï¼Œé€™é‚Šé¸æ“‡æ‰‹å‹•é©—è­‰ï¼Œåœ¨Jenkins UIçš„å´é‚Šæ¬„ä¸Šæœƒæœ‰é¸é …è¦ç¢ºèª<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new-2.jpg" alt="Untitled"></li></ol><p>è¨­å®šå®Œç•¢å¾Œï¼ŒJenkinså°±æœƒé–‹å§‹å˜—è©¦é€£ä¸Šæ–°çš„ç¯€é»ï¼Œå°‡Jenkinsçš„ç›¸é—œç¨‹å¼å®‰è£è‡³æ–°ç¯€é»ä¸Š<br>æ­¤æ™‚å¯å¾åœ–ä¸­çœ‹åˆ°é‚„åœ¨å•Ÿå‹•ä¸­<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new-3.jpg" alt="Untitled"></p><p>é»æ“Šç¯€é»çš„Logä¸­å¯ä»¥çœ‹åˆ°ç¯€é»ç›®å‰çš„ç‹€æ³<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new-4.jpg" alt="Untitled"></p><p>å•Ÿå‹•å®Œç•¢å¾Œï¼Œå°±å¯ä»¥çœ‹åˆ°ç¯€é»çš„è³‡è¨Š<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/devops-cicd/devops-cicd-jenkins-node-new-5.jpg" alt="Untitled"></p><h3 id="åœ¨pipelineä¸ŠæŒ‡å®šç¯€é»åŸ·è¡Œ"><a href="#åœ¨pipelineä¸ŠæŒ‡å®šç¯€é»åŸ·è¡Œ" class="headerlink" title="åœ¨pipelineä¸ŠæŒ‡å®šç¯€é»åŸ·è¡Œ"></a>åœ¨pipelineä¸ŠæŒ‡å®šç¯€é»åŸ·è¡Œ</h3><p>é€™è£¡æ–°å¢äº†ä½ˆç½²çš„stageï¼Œä¸¦ä¸”ä½ˆç½²çš„stageä¸ŠæŒ‡å®šäº†deploy-serverç¯€é»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Checkout SCM&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Checkout SCM&#x27;</span></span><br><span class="line">                git url: <span class="string">&#x27;https://gitlab-se.ntcu.edu.tw/ntcu-acs106103/shape-by-gradle.git&#x27;</span>, branch: <span class="string">&#x27;master&#x27;</span>, credentialsId: <span class="string">&#x27;gitlab-user&#x27;</span>   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Building&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;chmod +x ./gradlew&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;./gradlew clean build&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Analyze&#x27;</span>) &#123;</span><br><span class="line">            environment &#123;</span><br><span class="line">                scannerHome = tool <span class="string">&#x27;SonarQube 4.6.2&#x27;</span> // SonarQube Scanner è©²ç‰ˆæœ¬Name</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;Analyzing&#x27;</span></span><br><span class="line">                withSonarQubeEnv(<span class="string">&#x27;sonarqube&#x27;</span>) &#123; // SonarQube servers Name</span><br><span class="line">                    sh <span class="string">&quot;<span class="variable">$&#123;scannerHome&#125;</span>/bin/sonar-scanner &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.projectKey=spring-first-project &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.projectName=spring-first-project &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.sources=./src &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-Dsonar.java.binaries=./build/classes/java &quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">stage(<span class="string">&#x27;PassDeployFile&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                stash includes: <span class="string">&#x27;docker-compose.yml&#x27;</span>, name: <span class="string">&#x27;docker-compose.yml&#x27;</span></span><br><span class="line">                stash includes: <span class="string">&#x27;Dockerfile&#x27;</span>, name: <span class="string">&#x27;Dockerfile&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Deploy&#x27;</span>) &#123;</span><br><span class="line">            agent &#123; label <span class="string">&#x27;deploy-server&#x27;</span> &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                unstash <span class="string">&#x27;docker-compose.yml&#x27;</span></span><br><span class="line">                unstash <span class="string">&#x27;Dockerfile&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;sudo docker-compose up -d&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            junit <span class="string">&#x27;build/test-results/**/*.xml&#x27;</span></span><br><span class="line">            jacoco()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>åœ¨æ•´ç¯‡ä¸­æˆ‘å€‘å¯ä»¥çœ‹åˆ°å¤§å¤šéƒ½é€éUIè¨­å®šå°±å®Œæˆäº†è¨±å¤šè‡ªå‹•åŒ–çš„æµç¨‹ï¼Œè€Œé€éä¸²æ¥è¨±å¤šå·¥å…·ä½¿æµç¨‹è‡ªå‹•åŒ–ï¼Œå°±å¯ä»¥è®“é–‹ç™¼èˆ‡ç¶­é‹æ¸›å°‘æˆæœ¬ã€‚å¦å¤–ï¼Œè‹¥åœ˜éšŠå°ˆæ¡ˆæœ‰é¡å¤–éœ€æ±‚é‚„å¯ä»¥å®¢è£½åŒ–è‡ªå·±çš„æ’ä»¶ï¼Œç ”ç©¶Jenkinsæ’ä»¶æ’°å¯«ä¹Ÿæ˜¯ä¸éŒ¯çš„é»å­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
            <tag> docker </tag>
            
            <tag> docker-compose </tag>
            
            <tag> jenkins </tag>
            
            <tag> sonarqube </tag>
            
            <tag> maven </tag>
            
            <tag> gradle </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Webpack å’Œ Webpack Dev Server æ‰“é€ å‰ç«¯å°ˆæ¡ˆç’°å¢ƒ</title>
      <link href="/posts/%E4%BD%BF%E7%94%A8Webpack%20%E5%92%8C%20Webpack%20Dev%20Server%E6%89%93%E9%80%A0%E5%89%8D%E7%AB%AF%E5%B0%88%E6%A1%88%E7%92%B0%E5%A2%83/"/>
      <url>/posts/%E4%BD%BF%E7%94%A8Webpack%20%E5%92%8C%20Webpack%20Dev%20Server%E6%89%93%E9%80%A0%E5%89%8D%E7%AB%AF%E5%B0%88%E6%A1%88%E7%92%B0%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="ä»€éº¼æ˜¯Webpack"><a href="#ä»€éº¼æ˜¯Webpack" class="headerlink" title="ä»€éº¼æ˜¯Webpack?"></a>ä»€éº¼æ˜¯Webpack?</h3><p>Webpack æ˜¯ä¸€å€‹å‰ç«¯æ¨¡çµ„æ‰“åŒ…(module bundler)å·¥å…·ï¼Œæä¾›æ¨¡çµ„åŒ–é–‹ç™¼æ–¹å¼ã€‚å°‡å„ç¨®éœæ…‹è³‡æºè¦–ç‚ºæ¨¡çµ„(å¦‚ä¸åŒèªè¨€vueã€sassã€jsâ€¦)ï¼Œå®ƒæœƒå¾é€²å…¥é»(entry point)é–‹å§‹åˆ†æå°ˆæ¡ˆçµæ§‹ï¼Œæ‰¾å‡ºæ¯å€‹æ¨¡çµ„é–“çš„ä¾è³´é—œä¿‚ï¼Œä¸¦åˆ†æå…¶ä¸­æ˜¯å¦æœ‰ç€è¦½å™¨ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„èªæ³•oræª”æ¡ˆã€‚æœ€å¾Œå°‡æ¯å€‹æ¨¡çµ„é€éç·¨è­¯æ–¹å¼ï¼Œè½‰æ›æˆç€è¦½å™¨æ‰€æ”¯æ´çš„æª”æ¡ˆ(htmlã€ cssã€ jsâ€¦)æ‰“åŒ…è‡³æŒ‡å®šçš„è¼¸å‡ºè³‡æ–™å¤¾ã€‚</p><p>å¦‚ä¸‹åœ–ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack.jpg" alt="webpack.jpg"></p><h3 id="ç‚ºä»€éº¼è¦ä½¿ç”¨Webpackç­‰å‰ç«¯æ‰“åŒ…å·¥å…·"><a href="#ç‚ºä»€éº¼è¦ä½¿ç”¨Webpackç­‰å‰ç«¯æ‰“åŒ…å·¥å…·" class="headerlink" title="ç‚ºä»€éº¼è¦ä½¿ç”¨Webpackç­‰å‰ç«¯æ‰“åŒ…å·¥å…·?"></a>ç‚ºä»€éº¼è¦ä½¿ç”¨Webpackç­‰å‰ç«¯æ‰“åŒ…å·¥å…·?</h3><p>éš¨è‘—æŠ€è¡“æ¼”é€²â€¦å‰ç«¯ä¸å†æ˜¯å–®ç´”htmlã€cssã€jsï¼Œç‚ºäº†ç¬¦åˆå„ç¨®éœ€æ±‚ï¼Œé–‹å§‹é–‹ç™¼å„ç¨®æ¡†æ¶ã€é è™•ç†å™¨å¼•é€²å°ˆæ¡ˆå…§ï¼Œä¸¦ä½¿ç”¨æ¨¡çµ„åŒ–æ–¹å¼é–‹ç™¼å°ˆæ¡ˆã€‚ç„¶è€Œç€è¦½å™¨ä¸¦ç„¡æ³•ç›´æ¥è¾¨è­˜é€™æ¨£çš„å°ˆæ¡ˆå…§å®¹ï¼Œå› æ­¤éœ€è¦é€éwebpackç­‰å‰ç«¯æ‰“åŒ…å·¥å…·ä½¿ç”¨ç·¨è­¯çš„æ–¹å¼è½‰æ›æˆç€è¦½å™¨çœ‹å¾—æ‡‚çš„å…§å®¹ã€‚</p><h4 id="é¸æ“‡webpackçš„åŸå› "><a href="#é¸æ“‡webpackçš„åŸå› " class="headerlink" title="é¸æ“‡webpackçš„åŸå› "></a>é¸æ“‡webpackçš„åŸå› </h4><p>é™¤äº†webpackç•¶ç„¶é‚„æœ‰è¨±å¤šæ‰“åŒ…å·¥å…·ï¼Œå¦‚gulpã€parcelã€esbuildç­‰ç­‰ï¼Œæ¯å€‹å·¥å…·éƒ½æœ‰å®ƒçš„ç‰¹é»ï¼Œè€Œwebpackæ˜¯ç›®å‰ç­†è€…åœ¨é–‹ç™¼ä¸Šé †æ‰‹çš„å·¥å…·ã€‚</p><p>ä¸‹åœ–ç‚º <a href="https://2020.stateofjs.com/en-US/technologies/build-tools/">state of js</a> çš„Build Toolsèª¿æŸ¥ï¼Œå¯ä»¥çœ‹åˆ°webpackè‡³ä»Šä½¿ç”¨ç‡éå¸¸é«˜ã€‚<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/2020-build-tool-rank.jpg" alt="2020-build-tool-rank.jpg"></p><h3 id="ä»€éº¼æ˜¯Webpack-Dev-Server"><a href="#ä»€éº¼æ˜¯Webpack-Dev-Server" class="headerlink" title="ä»€éº¼æ˜¯Webpack Dev Server?"></a>ä»€éº¼æ˜¯Webpack Dev Server?</h3><p>webpack-dev-serveræ˜¯webpackæ‰€é–‹ç™¼çš„å·¥å…·ï¼Œå®ƒæä¾›æˆ‘å€‘åœ¨é–‹ç™¼ä¸­æœ‰ä¸€å€‹åŸºæœ¬çš„web serverï¼Œä¸¦ä¸”å…·æœ‰  live reloading  åŠŸèƒ½ã€‚å› æ­¤æˆ‘å€‘ä¸éœ€è¦ç­‰å¾…æ¯æ¬¡å¾é ­ç·¨è­¯ç…©äººçš„æ™‚é–“ï½</p><p>åœ¨é–‹ç™¼æ™‚ï¼Œwebpackåªæ˜¯å¹«æˆ‘å€‘åšæª”æ¡ˆç·¨è­¯çš„å‹•ä½œè€Œå·²ï¼Œå¯¦éš›ä¸Šæˆ‘å€‘é‚„éœ€è¦é–‹ä¸€å€‹web serveræ‰èƒ½ç€è¦½ç·¨è­¯å¾Œçš„æª”æ¡ˆæ‰€æ¸²æŸ“çš„ç¶²é å…§å®¹ã€‚</p><div class="note warning flat"><p><strong>live reloading (å³æ™‚é‡è¼‰)</strong> ï¼šå¸¸è¦‹åˆç¨±hot reloadã€‚ä¸»è¦é—¡è¿°é–‹ç™¼çš„åŒæ™‚èƒ½å¤ å³æ™‚è¼‰å…¥çœ‹åˆ°æœ€æ–°ç•«é¢<br>â€»webpack-dev-serveræä¾› <strong>Hot Module Replacement(HMR)</strong> æ¨¡å¼ï¼Œé€éå³æ™‚æ›¿æ›ã€æ·»åŠ æˆ–åˆªé™¤æ¨¡çµ„ä¾†é”åˆ°ç„¡é ˆé‡æ–°è¼‰å…¥é é¢å³å¯çœ‹åˆ°æœ€æ–°ç•«é¢ã€‚</p></div><h3 id="Webpack-â€”watch-èˆ‡-Webpack-Dev-Serverå·®ç•°"><a href="#Webpack-â€”watch-èˆ‡-Webpack-Dev-Serverå·®ç•°" class="headerlink" title="Webpack â€”watch èˆ‡ Webpack Dev Serverå·®ç•°"></a>Webpack â€”watch èˆ‡ Webpack Dev Serverå·®ç•°</h3><p>å…ˆä¾†è§£é‡‹ <code>webpack --watch</code>ã€‚æˆ‘å€‘çŸ¥é“é€é <code>webpack</code> æŒ‡ä»¤æœƒé€²è¡Œç·¨è­¯å‹•ä½œï¼Œè€Œ <code>webpack --watch</code> å‰‡æ˜¯åŸ·è¡Œç·¨è­¯å‹•ä½œå¤–ï¼Œä¸¦ä¸”è¦å•Ÿç”¨è§€å¯Ÿæ¨¡å¼ï¼›ç•¶æª”æ¡ˆä¸€æœ‰è®Šå‹•æ™‚å°±æœƒç«‹å³é‡æ–°ç·¨è­¯ï¼Œæ‰€ä»¥ä¸é ˆæ¯æ¬¡æ‰‹å‹•è¼¸å…¥æŒ‡ä»¤ã€‚</p><p>çœ‹åˆ°é€™æœƒæƒ³èªªâ€¦æ¬¸ï½è·Ÿä¸Šé¢webpack-dev-serverçš„æ¦‚å¿µå¥½åƒä¸€æ¨£ã€‚æ²’éŒ¯ï¼Œåªä¸éè©³ç´°å·®åˆ¥æœ‰ï¼š</p><div class="note info flat no-icon flat"><ul><li>webpack-dev-serveræœ‰æä¾›server</li><li>webpack-dev-serverç·¨è­¯ä¹‹å¾Œä¸æœƒå¯«å…¥ä»»ä½•è¼¸å‡ºæª”æ¡ˆï¼Œè€Œæ˜¯å°‡ç·¨è­¯å¾Œæª”æ¡ˆå­˜åœ¨è¨˜æ†¶é«”å…§ä¾›serveré‹è¡Œ(ç•¢ç«Ÿåªæ˜¯ç•¶æ™‚é–‹ç™¼ç”¨)</li><li>webpack-dev-serveræœ‰HMRæ¨¡å¼ï¼Œç„¡é ˆåˆ·æ–°ç€è¦½å™¨é é¢å³å¯çœ‹åˆ°æœ€æ–°ç•«é¢</li></ul></div><h2 id="å¯¦ä½œé‡é»"><a href="#å¯¦ä½œé‡é»" class="headerlink" title="å¯¦ä½œé‡é»"></a>å¯¦ä½œé‡é»</h2><ul><li>å®‰è£webpackã€webpack-cliã€webpack-dev-serverå’Œwebpack-merge</li><li>ä½¿ç”¨webpack â€“configã€webpack-mergeå€åˆ† dev èˆ‡ prod ç’°å¢ƒè¨­å®šæª”</li><li>ä½¿ç”¨html-webpack-pluginè‡ªå‹•è¼¸å‡ºæŒ‡å®šhtmlä¸¦å¼•å…¥js</li><li>é…ç½®cssã€jsã€imageæ¨¡çµ„ç·¨è­¯è¦å‰‡<ul><li>ä½¿ç”¨mini-css-extract-pluginè¼¸å‡ºå–®ç¨CSSæª”ï¼Œæ”¯æ´CSSå’ŒSourceMapéœ€è¦æ™‚è¼‰è¼‰å…¥</li><li>ä½¿ç”¨css-loaderè™•ç†åœ¨jsä¸­å¼•å…¥çš„cssæª”</li><li>ä½¿ç”¨optimize-css-assets-webpack-pluginå„ªåŒ–ã€æœ€å°åŒ–CSS</li><li>ä½¿ç”¨babel-loaderè™•ç†jsèªæ³•è½‰æ›æˆèƒ½è¢«ç€è¦½å™¨æ”¯æ´çš„èªæ³•</li><li>ä½¿ç”¨file-loaderè™•ç†å¼•å…¥çš„æª”æ¡ˆç‰©ä»¶ã€è¼¸å‡ºç›®éŒ„å’Œå®ƒçš„url</li><li>ä½¿ç”¨url-loaderå°‡éƒ¨åˆ†æª”æ¡ˆè½‰base64ç·¨ç¢¼åµŒå…¥jsä¸­ï¼Œä»¥æ¸›å°‘è«‹æ±‚æ¬¡æ•¸</li><li>ä½¿ç”¨image-webpack-loaderå°‡åœ–ç‰‡å£“ç¸®å„ªåŒ–</li></ul></li><li>å®‰è£Vue(JavaScript Framework)ã€Tailwind CSS(CSS Framework)</li></ul><h2 id="å»ºç«‹æ–°å°ˆæ¡ˆ-amp-å®‰è£Webpackç›¸é—œå¥—ä»¶"><a href="#å»ºç«‹æ–°å°ˆæ¡ˆ-amp-å®‰è£Webpackç›¸é—œå¥—ä»¶" class="headerlink" title="å»ºç«‹æ–°å°ˆæ¡ˆ &amp; å®‰è£Webpackç›¸é—œå¥—ä»¶"></a>å»ºç«‹æ–°å°ˆæ¡ˆ &amp; å®‰è£Webpackç›¸é—œå¥—ä»¶</h2><h3 id="å»ºç«‹æ–°å°ˆæ¡ˆ"><a href="#å»ºç«‹æ–°å°ˆæ¡ˆ" class="headerlink" title="å»ºç«‹æ–°å°ˆæ¡ˆ"></a>å»ºç«‹æ–°å°ˆæ¡ˆ</h3><p>å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆç›®éŒ„(webpack-dev-server-learning)ï¼Œåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹è¼¸å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åƒæ•¸-yç‚ºä½¿ç”¨é è¨­é¸é …åˆå§‹åŒ–</span></span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure><p>åœ¨ç›®éŒ„ä¸‹æœƒç”¢ç”Ÿpackage.jsonæª”ï¼Œå…§å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;webpack-dev-server-learning&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p><strong>npm(Node Package Manager)æ˜¯åŸºæ–¼Node.jsçš„å°ˆæ¡ˆå¥—ä»¶ç®¡ç†å·¥å…·ã€‚</strong><br>é€énpmï¼Œæˆ‘å€‘å¯ä»¥çµ±ä¸€å°ˆæ¡ˆä½¿ç”¨çš„å¥—ä»¶ç‰ˆæœ¬ä»¥åŠè¨­å®šç’°å¢ƒï¼Œå¯ä»¥å‰å¾€<a href="https://www.npmjs.com/">npmå¹³å°</a>æŸ¥çœ‹æ‰€æœ‰æä¾›çš„å¥—ä»¶ï¼Œå…¶ä¸­å¥—ä»¶çš„è©³ç´°è³‡è¨Š(Readmeã€ä¾è³´é—œä¿‚ã€å®‰è£æ–¹å¼ã€githubå°ˆæ¡ˆã€ä¸‹è¼‰æ•¸ã€å„ç‰ˆæœ¬è³‡è¨Š)ã€‚<br>ä¸åŒèªè¨€ä¹Ÿæœ‰è£½ä½œä»–å€‘çš„å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œå¦‚ï¼šjavaçš„mvn</p></div><div class="note warning flat"><p><strong>åœ¨npmçš„ä¸–ç•Œæˆ‘å€‘ä¸€å®šè¦ç‰¢è¨˜çš„äº‹ï¼š</strong></p><ul><li>æœ‰äº›å¥—ä»¶é‚„éœ€è¦å®‰è£å…¶ä»–ä¾è³´çš„å¥—ä»¶æ‰èƒ½ä½¿ç”¨</li><li>å¥—ä»¶ä¹‹é–“è‹¥æœ‰é—œè¯æœƒæœ‰ç‰ˆæœ¬ç›¸å®¹å•é¡Œ</li><li>å®‰è£å‰é™¤äº†çœ‹å¥—ä»¶çš„æ–‡ä»¶å¤–ï¼Œè¦å»è©²å¥—ä»¶çš„npmç¶²ç«™çœ‹å„ç‰ˆæœ¬ä¸‹è¼‰æ•¸ï¼Œä¸‹è¼‰æ•¸å¤šçš„ç›¸å°è¼ƒç©©å®šï¼Œç•¶ç„¶é‚„æ˜¯è¦è¨˜å¾—<strong>ç‰ˆæœ¬ç›¸å®¹</strong></li></ul></div><h3 id="å®‰è£webpackã€webpack-cliã€webpack-dev-serverå’Œwebpack-merge"><a href="#å®‰è£webpackã€webpack-cliã€webpack-dev-serverå’Œwebpack-merge" class="headerlink" title="å®‰è£webpackã€webpack-cliã€webpack-dev-serverå’Œwebpack-merge"></a>å®‰è£webpackã€webpack-cliã€webpack-dev-serverå’Œwebpack-merge</h3><p>é¦–å…ˆè§£é‡‹ä¸€ä¸‹æ²’æåˆ°çš„webpack-cliã€webpack-mergeï¼š</p><ul><li><strong>webpack-cli</strong> ï¼šcli(Command-Line Interface)ä¹Ÿå°±æ˜¯å‘½ä»¤åˆ—ä»‹é¢ï¼Œç”±æ–¼webpackæŠŠcliéƒ¨åˆ†ç¨ç«‹å‡ºä¾†ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å®‰è£æ‰èƒ½ä½¿ç”¨webpackçš„æŒ‡ä»¤ã€‚</li><li><strong>webpack-merge</strong> ï¼šå¹«åŠ©æˆ‘å€‘å¯ä»¥åˆ†åˆ¥æ’°å¯«dev å’Œ prod çš„ webpackè¨­å®šæª”</li></ul><h4 id="å®‰è£"><a href="#å®‰è£" class="headerlink" title="å®‰è£"></a>å®‰è£</h4><p>æˆ‘é€™é‚ŠæŒ‡å®šå®‰è£webpack v4ç‰ˆæœ¬ï¼Œä»¥åŠå…¶ä»–ä¸‹è¼‰æ•¸é«˜çš„ç©©å®šç‰ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --save-devåƒæ•¸è¡¨ç¤ºï¼šå¥—ä»¶é—œä¿‚åªæœ‰åœ¨é–‹ç™¼æˆ–æ¸¬è©¦çš„æ™‚å€™éœ€è¦</span></span><br><span class="line">npm install webpack@4.46.0 webpack-dev-server@3.11.2 webpack-cli@3.3.12 webpack-merge@5.7.3 --save-dev</span><br></pre></td></tr></table></figure><p>å®‰è£æˆåŠŸå¾Œï¼Œåœ¨package.jsonæª”æœƒå¹«æˆ‘å€‘æ–°å¢å…§å®¹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;webpack-dev-server-learning&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^4.46.0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.12&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^3.11.2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-merge&quot;</span>: <span class="string">&quot;^5.7.3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¸¬è©¦ç’°ç¯€"><a href="#æ¸¬è©¦ç’°ç¯€" class="headerlink" title="æ¸¬è©¦ç’°ç¯€"></a>æ¸¬è©¦ç’°ç¯€</h4><p>æ¥è‘—æˆ‘å€‘å…ˆä¾†æ¸¬è©¦æ˜¯å¦èƒ½ä½¿ç”¨å§ï¼</p><ol><li><p>å…ˆå»ºç«‹srcç›®éŒ„ï¼Œä¸¦ä¸”åœ¨srcç›®éŒ„å»ºç«‹index.jsï¼Œå¦‚ä¸‹åœ–ï¼š</p><p> <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-src-index.jpg" alt="Untitled"></p></li><li><p>åœ¨package.jsonæ–°å¢ä¸€æ¢scriptsï¼Œå¦‚ä¸‹ï¼š(è¨˜å¾—ä¸Šä¸€è¡Œçš„é€—è™Ÿ)</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;webpack-dev-server-learning&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;webpack&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^4.46.0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.12&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^3.11.2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;webpack-merge&quot;</span>: <span class="string">&quot;^5.7.3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¼¸å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p> è‹¥è¼¸å…¥çµæœå¦‚ä¸‹åœ–å°±æˆåŠŸå•¦</p><p> <img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-install-output.jpg" alt="Untitled"></p></li></ol><h2 id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”"><a href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”" class="headerlink" title="ä¾ dev å’Œ prod ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”"></a>ä¾ dev å’Œ prod ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”</h2><p>ä¸€èˆ¬æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨æ ¹ç›®éŒ„æ’°å¯« <code>webpack.config.js</code> è¨­å®šæª”ï¼Œä½†ç•¶æˆ‘å€‘é–‹ç™¼èˆ‡ç”Ÿç”¢çš„ç’°å¢ƒè¨­å®šä¸åŒæ™‚æ€éº¼è¾¦å‘¢ï¼Ÿè‹¥æœ‰äº›è¨­å®šæœƒç›¸åŒï¼Œä½†åˆä¸æƒ³æ¯æ¬¡ç¶­è­·å…©ä»½æª”æ¡ˆçš„è©±å‘¢ï¼Ÿ</p><div class="note success flat"><ul><li>ä½¿ç”¨ <code>webpack --config</code> åƒæ•¸ä¾†é¸å–æˆ‘å€‘çš„éœ€è¦çš„è¨­å®šæª”</li><li>ä½¿ç”¨ <code>webpack-merge</code> å¥—ä»¶å¹«åŠ©æˆ‘å€‘åˆä½µ <mark class="hl-label default">å…±ç”¨çš„</mark>  è¨­å®šæª”</li></ul></div><h3 id="ä¾å°ˆæ¡ˆæ¶æ§‹å»ºç«‹webpackè¨­å®šæª”"><a href="#ä¾å°ˆæ¡ˆæ¶æ§‹å»ºç«‹webpackè¨­å®šæª”" class="headerlink" title="ä¾å°ˆæ¡ˆæ¶æ§‹å»ºç«‹webpackè¨­å®šæª”"></a>ä¾å°ˆæ¡ˆæ¶æ§‹å»ºç«‹webpackè¨­å®šæª”</h3><h4 id="å°ˆæ¡ˆæ¶æ§‹"><a href="#å°ˆæ¡ˆæ¶æ§‹" class="headerlink" title="å°ˆæ¡ˆæ¶æ§‹"></a>å°ˆæ¡ˆæ¶æ§‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ build</span><br><span class="line">â”‚   â”œâ”€â”€ webpack.config.common.js <span class="comment"># å…±ç”¨è¨­å®šæª”   </span></span><br><span class="line">â”‚   â”œâ”€â”€ webpack.config.dev.js    <span class="comment"># é–‹ç™¼ç’°å¢ƒè¨­å®šæª”</span></span><br><span class="line">â”‚   â””â”€â”€ webpack.config.prod.js   <span class="comment"># ç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”</span></span><br><span class="line">â”œâ”€â”€ dist <span class="comment"># outputè¼¸å‡ºè³‡æ–™å¤¾</span></span><br><span class="line">â”œâ”€â”€ node_modules</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â””â”€â”€ index.js <span class="comment"># entry å…¥å£é»</span></span><br><span class="line">â”œâ”€â”€ package-lock.json</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure><h3 id="æ’°å¯«webpackå…±ç”¨è¨­å®šæª”-common"><a href="#æ’°å¯«webpackå…±ç”¨è¨­å®šæª”-common" class="headerlink" title="æ’°å¯«webpackå…±ç”¨è¨­å®šæª”(common)"></a>æ’°å¯«webpackå…±ç”¨è¨­å®šæª”(common)</h3><p>æˆ‘å€‘å¯ä»¥åœ¨webpackè¨­å®šè©²å°ˆæ¡ˆç·¨è­¯çš„æ ¹ç›®éŒ„(context)ã€å…¥å£é»(entry)ã€è¼¸å‡ºæª”æ¡ˆåç¨±è¦å‰‡å’Œä½ç½®(output)<br>å¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„è¨­å®šæª”åœ¨buildè³‡æ–™å¤¾å…§ï¼Œæ‰€ä»¥contextå¿…é ˆæŒ‡å‘å¤–å±¤æ‰ç¬¦åˆæˆ‘å€‘çš„éœ€æ±‚</p><div class="tabs" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpackå…±ç”¨è¨­å®šæª”(common)"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpackå…±ç”¨è¨­å®šæª”(common)-1">webpack.config.common.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpackå…±ç”¨è¨­å®šæª”(common)-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">context</span>: path.resolve(__dirname, <span class="string">&#x27;../&#x27;</span>), <span class="comment">// è¨­å®šç·¨è­¯æ™‚çš„æ ¹ç›®éŒ„</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><div class="note warning flat"><p><code>path</code> ç‚ºnode.jsçš„æ¨¡çµ„<br><code>__dirname</code> å‰‡æ˜¯å›å‚³åŸ·è¡Œçš„ js æª”æ‰€åœ¨è³‡æ–™å¤¾çš„çµ•å°è·¯å¾‘</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”-dev"><a href="#æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”-dev" class="headerlink" title="æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”(dev)"></a>æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”(dev)</h3><p>è¨­å®šæª”ä¸­çš„<code>commonWebpackConfig</code>æ˜¯æˆ‘å€‘å‰›å‰›å¯«çš„å…±ç”¨è¨­å®šæª”ï¼Œåˆ©ç”¨mergeå°‡é–‹ç™¼ç’°å¢ƒçš„è¨­å®šèˆ‡å…¶åˆä½µã€‚</p><div class="tabs" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”(dev)"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”(dev)-1">webpack.config.dev.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-æ’°å¯«webpacké–‹ç™¼ç’°å¢ƒè¨­å®šæª”(dev)-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonWebpackConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonWebpackConfig, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">      </span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note warning flat"><p><code>mode</code> è¨­ç½®ç‚ºé–‹ç™¼ç’°å¢ƒ<br><code>devServer</code> è¨­ç½®åœ¨webpack-dev-serverçš„serverç’°å¢ƒ</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="æ’°å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”-prod"><a href="#æ’°å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”-prod" class="headerlink" title="æ’°å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”(prod)"></a>æ’°å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”(prod)</h3><p>å¤§è‡´è¨­å®šèˆ‡é–‹ç™¼ç’°å¢ƒç›¸åŒï¼Œ<code>mode</code>æ”¹ç‚ºç”Ÿç”¢ç’°å¢ƒã€ç”Ÿç”¢ç’°å¢ƒä¸éœ€è¦ä½¿ç”¨dev-server</p><div class="tabs" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”(prod)"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”(prod)-1">webpack.config.prod.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-å¯«webpackç”Ÿç”¢ç’°å¢ƒè¨­å®šæª”(prod)-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonWebpackConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonWebpackConfig, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">      </span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="æ¸¬è©¦ç’°ç¯€-1"><a href="#æ¸¬è©¦ç’°ç¯€-1" class="headerlink" title="æ¸¬è©¦ç’°ç¯€"></a>æ¸¬è©¦ç’°ç¯€</h3><p>æ—¢ç„¶åˆæ­¥çš„webpackç’°å¢ƒå·²ç¶“è¨­å®šå¥½äº†é‚£å°±ä¾†æ¸¬è©¦æ˜¯å¦èƒ½å¦‚æœŸé‹è¡Œå§ï¼</p><div class="tabs" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-åŠŸèƒ½æ¸¬è©¦"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-åŠŸèƒ½æ¸¬è©¦-1">é–‹ç™¼ç’°å¢ƒ</button></li><li class="tab"><button type="button" data-href="#ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-åŠŸèƒ½æ¸¬è©¦-2">ç”Ÿç”¢ç’°å¢ƒ</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-åŠŸèƒ½æ¸¬è©¦-1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œå¾Œè‹¥å¦‚ä¸‹åœ–è¡¨ç¤ºæˆåŠŸäº†ï¼Œä½†ç”±æ–¼æˆ‘å€‘æ²’æœ‰è¨­ç½®<code>index.html</code> æ‰€ä»¥åªèƒ½çœ‹åˆ°æ ¹ç›®éŒ„</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-dev-compile-output.jpg" alt="Untitled"></p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-dev-compile-demo.jpg" alt="Untitled"></p><div class="note warning flat"><p>é—œæ–¼htmléƒ¨ä»½ï¼Œç”±æ–¼é€²å…¥é»(entry)çš„index.jsä¸ç”¨æŠŠhtmlå¼•å…¥ï¼Œåè€Œæ˜¯htmléœ€è¦å¼•å…¥index.jsã€‚å› æ­¤æˆ‘å€‘æœƒéœ€è¦html-webpack-pluginå¥—ä»¶å¹«åŠ©æˆ‘å€‘ç·¨è­¯å¾Œç›´æ¥å¹«æˆ‘å€‘çš„htmlæ¨£æœ¬å¼•å…¥ç·¨è­¯å¥½çš„jsæª”æ¡ˆã€‚</p></div><h4 id="å®‰è£html-webpack-plugin"><a href="#å®‰è£html-webpack-plugin" class="headerlink" title="å®‰è£html-webpack-plugin"></a>å®‰è£html-webpack-plugin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin@4.5.2 --save-dev</span><br></pre></td></tr></table></figure><ul><li>åœ¨webpack.config.common.jså¢åŠ æ’ä»¶è¨­å®šè¨­å®š</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">context</span>: path.resolve(__dirname, <span class="string">&#x27;../&#x27;</span>), <span class="comment">// è¨­å®šç·¨è­¯æ™‚çš„æ ¹ç›®éŒ„</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ–°å¢src/index.htmlæª”æ¡ˆ</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æ­¤æˆ‘å€‘å†æ¬¡åŸ·è¡Œå°±æœƒå¾—åˆ°ç©ºç™½çš„ç•«é¢ä»¥åŠconsoleé¢æ¿çš„Hello World!</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-dev-server-console.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ä¾-dev-å’Œ-prod-ç’°å¢ƒåˆ†åˆ¥æ’°å¯«webpackè¨­å®šæª”-åŠŸèƒ½æ¸¬è©¦-2"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>æ²’æ„å¤–çš„è©±ï¼Œè¼¸å…¥è³‡æ–™å¤¾distä¸­æ‡‰è©²æœƒæœ‰main.bundle.jsä»¥åŠå‰›å‰›åŠ å…¥çš„pluginæ‰€å¹«æˆ‘å€‘ç”¢ç”Ÿçš„index.html<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-html-plugin.jpg" alt="Untitled"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æ·»åŠ Webpackæ¨¡çµ„ç·¨è­¯è¦å‰‡"><a href="#æ·»åŠ Webpackæ¨¡çµ„ç·¨è­¯è¦å‰‡" class="headerlink" title="æ·»åŠ Webpackæ¨¡çµ„ç·¨è­¯è¦å‰‡"></a>æ·»åŠ Webpackæ¨¡çµ„ç·¨è­¯è¦å‰‡</h2><p>æˆ‘å€‘å·²ç¶“å°‡åŸºæœ¬ç’°å¢ƒæ¶æ§‹è¨­ç½®å®Œç•¢äº†ï¼Œæ¥è‘—å°±å¯ä»¥ä¾éœ€æ±‚å®‰è£éœ€è¦çš„å¥—ä»¶è·ŸæŒ‰ç…§ç’°å¢ƒæ’°å¯«ä¸åŒçš„è¨­å®šã€‚ä¸éæˆ‘å€‘ç‚ºäº†èƒ½å¤ ç·¨è­¯å„ç¨®éœæ…‹è³‡æºé‚„å¾—å€‹åˆ¥æ·»åŠ æ¨¡çµ„è¦å‰‡ã€‚</p><h3 id="ç‚ºä»€éº¼è¦æ·»åŠ æ¨¡çµ„ç·¨è­¯è¦å‰‡"><a href="#ç‚ºä»€éº¼è¦æ·»åŠ æ¨¡çµ„ç·¨è­¯è¦å‰‡" class="headerlink" title="ç‚ºä»€éº¼è¦æ·»åŠ æ¨¡çµ„ç·¨è­¯è¦å‰‡"></a>ç‚ºä»€éº¼è¦æ·»åŠ æ¨¡çµ„ç·¨è­¯è¦å‰‡</h3><p>äº‹å¯¦ä¸Šwebpackä¸¦ä¸çŸ¥é“ä½ çš„éœæ…‹è³‡æºè¦æ€éº¼ç·¨è­¯ï¼Œè€Œä¸”å®ƒæ²’è¾¦æ³•ç¨ç«‹å®Œæˆé€™é …ä½œæ¥­ã€‚åœ¨ä¸‹åœ–å¯ä»¥çœ‹åˆ°æˆ‘æ·»åŠ äº†cssæª”æ¡ˆä¸¦åœ¨index.jså¼•å…¥ï¼Œç·¨è­¯å¾Œå‡ºç¾éŒ¯èª¤è¨Šæ¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-css-fail-output.jpg" alt="Untitled"></p><div class="note danger flat"><p>ã€Œ ä½ éœ€è¦<strong>åˆé©çš„loader</strong>ä¾†è™•ç†é€™å€‹<strong>æª”æ¡ˆé¡å‹</strong>ï¼Œç›®å‰é€™å€‹æª”æ¡ˆé¡å‹æ²’æœ‰è¨­å®šä»»ä½•çš„loader ã€</p></div><p>ç”±æ­¤å¯ä»¥å¾—çŸ¥æˆ‘å€‘å¿…é ˆæ·»åŠ è¦å‰‡è¨­ç½®loaderçµ¦cssçš„é¡å‹æª”æ¡ˆï¼Œå¦å¤–webpackæœ¬èº«ä¸¦æ²’æœ‰å„ç¨®éœæ…‹è³‡æºçš„loaderï¼Œå› æ­¤æˆ‘å€‘é‚„éœ€è¦é¡å¤–å®‰è£ã€‚</p><p>æ‰€ä»¥æ·»åŠ æ¨¡çµ„è¦å‰‡æœƒæœ‰2ä»¶äº‹æƒ…è¦åŸ·è¡Œï¼š</p><ol><li><strong>å®‰è£éœ€è¦çš„loader</strong></li><li><strong>åœ¨webpackè¨­å®šæª”æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡</strong></li></ol><h3 id="æ·»åŠ CSSç·¨è­¯è¦å‰‡"><a href="#æ·»åŠ CSSç·¨è­¯è¦å‰‡" class="headerlink" title="æ·»åŠ CSSç·¨è­¯è¦å‰‡"></a>æ·»åŠ CSSç·¨è­¯è¦å‰‡</h3><p>è‹¥è¦ç·¨è­¯CSSæˆ‘å€‘å¿…é ˆå®‰è£mini-css-extract-plugin(æˆ–style-loader)å’Œcss-loaderï¼Œå…ˆè§£é‡‹ä»–å€‘åˆ†åˆ¥è™•ç†ä»€éº¼ï¼š</p><div class="note info flat"><p><strong>mini-css-extract-plugin</strong> ï¼šç‚ºæ¯å€‹åŒ…å« CSS çš„ JS æª”æ¡ˆå‰µå»ºä¸€å€‹å–®ç¨çš„ CSS æª”ï¼Œä¸”æ”¯æ´CSSå’ŒSourceMapéœ€è¦æ™‚è¼‰è¼‰å…¥<br><strong>style-loader</strong> ï¼šå°‡CSSæ³¨å…¥åˆ°HTMLçš„ <code>&lt;style&gt;&lt;/style&gt;</code> æ¨™ç±¤ä¸Š<br><strong>css-loader</strong> ï¼šè™•ç†åœ¨jsä¸­ç”¨ <code>@import url() || import/require()</code> å¼•å…¥çš„cssæª”(é‚„åªæ˜¯å€‹æª”æ¡ˆ)</p></div><p>å¯ä»¥çœ‹åˆ°mini-css-extract-pluginå·²ç¶“å¹«æˆ‘å€‘è™•ç†style-loaderçš„å·¥ä½œäº†ï¼Œä¸”åŠŸèƒ½æ›´è±å¯Œ</p><h4 id="å®‰è£æŒ‡ä»¤"><a href="#å®‰è£æŒ‡ä»¤" class="headerlink" title="å®‰è£æŒ‡ä»¤"></a>å®‰è£æŒ‡ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin@1.6.2 css-loader@4.3.0 --save-dev</span><br></pre></td></tr></table></figure><h4 id="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"><a href="#æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡" class="headerlink" title="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"></a>æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡</h4><div class="tabs" id="æ·»åŠ cssç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ·»åŠ cssç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1">webpack.config.common.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ cssç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">context</span>: path.resolve(__dirname, <span class="string">&#x27;../&#x27;</span>), <span class="comment">// è¨­å®šç·¨è­¯æ™‚çš„æ ¹ç›®éŒ„</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                use: [ MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note warning flat"><p>åœ¨ruleä¸­ä»¥ç‰©ä»¶æ–¹å¼åŠ å…¥å„å€‹è¦å‰‡<br>å…¶ä¸­testè¾¨åˆ¥è©²è¦å‰‡çš„æ¢ä»¶(ä½¿ç”¨æ­£å‰‡è¡¨ç¤ºæ³•)ï¼Œå¦‚ä¸Šè¿°ç‚ºç¬¦åˆcssæª”æ¡ˆ<br>ä¸€å€‹ruleå¯ä»¥è¨­ç½®å¤šå€‹loaderï¼Œä½†é€™é‚Šè¦æ³¨æ„åŸ·è¡Œé †åºæ˜¯(ç”±ä¸‹è‡³ä¸Šã€ç”±å³è‡³å·¦)</p></div><p>åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­æˆ‘å€‘å¯ä»¥ä½¿ç”¨optimize-css-assets-webpack-pluginå¤–æ›ä¾†å„ªåŒ–ã€æœ€å°åŒ–CSS</p><h4 id="å®‰è£optimize-css-assets-webpack-plugin"><a href="#å®‰è£optimize-css-assets-webpack-plugin" class="headerlink" title="å®‰è£optimize-css-assets-webpack-plugin"></a>å®‰è£optimize-css-assets-webpack-plugin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin@5.0.4 --save-dev</span><br></pre></td></tr></table></figure><h4 id="åŠ å…¥æ’ä»¶"><a href="#åŠ å…¥æ’ä»¶" class="headerlink" title="åŠ å…¥æ’ä»¶"></a>åŠ å…¥æ’ä»¶</h4><div class="tabs" id="å®‰è£optimize-css-assets-webpack-plugin-åŠ å…¥æ’ä»¶"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å®‰è£optimize-css-assets-webpack-plugin-åŠ å…¥æ’ä»¶-1">webpack.config.prod.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å®‰è£optimize-css-assets-webpack-plugin-åŠ å…¥æ’ä»¶-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonWebpackConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonWebpackConfig, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">            <span class="attr">cssProcessorPluginOptions</span>: &#123;</span><br><span class="line">              <span class="attr">preset</span>: [<span class="string">&#x27;default&#x27;</span>, &#123; <span class="attr">discardComments</span>: &#123; <span class="attr">removeAll</span>: <span class="literal">true</span> &#125; &#125;],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="æ¸¬è©¦ç’°ç¯€-2"><a href="#æ¸¬è©¦ç’°ç¯€-2" class="headerlink" title="æ¸¬è©¦ç’°ç¯€"></a>æ¸¬è©¦ç’°ç¯€</h4><p>è‹¥æˆåŠŸçš„è©±ï¼Œåœ¨é–‹ç™¼ç’°å¢ƒçš„ç¶²é ä¸Šå¯ä»¥çœ‹åˆ°æˆ‘å€‘å¥—ç”¨çš„CSSå›‰ï¼åœ¨ç”Ÿç”¢ç’°å¢ƒå‰‡åœ¨dist/main.csså¯ä»¥çœ‹åˆ°å£“ç¸®å¾Œçš„css</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-css-min-compile.jpg" alt="Untitled"></p><h3 id="æ·»åŠ JSç·¨è­¯è¦å‰‡"><a href="#æ·»åŠ JSç·¨è­¯è¦å‰‡" class="headerlink" title="æ·»åŠ JSç·¨è­¯è¦å‰‡"></a>æ·»åŠ JSç·¨è­¯è¦å‰‡</h3><p>webpacké è¨­æ”¯æ´ç·¨è­¯jsæª”ï¼Œä½†ç„¡æ³•å°‡ES6ä»¥ä¸Šç‰ˆæœ¬èªæ³•ç·¨è­¯è‡³ES5ç‰ˆæœ¬ã€‚é›–ç„¶å¤§å¤šç€è¦½å™¨é–‹å§‹æ”¯æ´ES6èªæ³•ï¼Œä¸éES5ç‰ˆæœ¬é‚„æ˜¯è¼ƒç‚ºç©©å®šä¸”å…¼å®¹åº¦é«˜ã€‚babelæ˜¯å°ˆé–€è™•ç†JavaScriptç·¨è­¯å™¨çš„å·¥å…·ï¼Œå› æ­¤é€™è£¡éœ€è¦ä½¿ç”¨babel-loaderå¹«åŠ©æˆ‘å€‘è½‰æ›ES6ä»¥ä¸Šç‰ˆæœ¬èªæ³•ã€‚</p><h4 id="å®‰è£æŒ‡ä»¤-1"><a href="#å®‰è£æŒ‡ä»¤-1" class="headerlink" title="å®‰è£æŒ‡ä»¤"></a>å®‰è£æŒ‡ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader@8.2.2 @babel/core@7.15.5 @babel/preset-env@7.15.4 --save-dev</span><br></pre></td></tr></table></figure><div class="note warning flat"><p><strong>@babel/core</strong> ç‚ºbabelçš„æ ¸å¿ƒ<br><strong>@babel/preset-env</strong> ç‚ºå°‡å¤§éƒ¨åˆ†ç€è¦½å™¨å°šæœªæ”¯æ´çš„ jsèªæ³•è½‰æ›æˆèƒ½è¢«ç€è¦½å™¨æ”¯æ´çš„èªæ³•</p></div><h4 id="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1"><a href="#æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1" class="headerlink" title="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"></a>æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡</h4><div class="tabs" id="æ·»åŠ jsç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ·»åŠ jsç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1">webpack.config.common.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ jsç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">context</span>: path.resolve(__dirname, <span class="string">&#x27;../&#x27;</span>), <span class="comment">// è¨­å®šç·¨è­¯æ™‚çš„æ ¹ç›®éŒ„</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                use: [ MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">presets</span>: [</span><br><span class="line">                            [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123; <span class="attr">targets</span>: <span class="string">&quot;defaults&quot;</span> &#125;]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="æ¸¬è©¦ç’°ç¯€-3"><a href="#æ¸¬è©¦ç’°ç¯€-3" class="headerlink" title="æ¸¬è©¦ç’°ç¯€"></a>æ¸¬è©¦ç’°ç¯€</h4><p>é€™é‚Šæˆ‘ä½¿ç”¨es6çš„ç‰©ä»¶è§£æ§‹ã€‚è‹¥æˆåŠŸçš„è©±ï¼Œç·¨è­¯å¾Œæª”æ¡ˆæœƒç™¼ç¾çœ‹ä¸åˆ°é€™ç¨®èªæ³•</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> date = &#123;</span><br><span class="line">    <span class="attr">year</span>: <span class="number">2021</span>,</span><br><span class="line">    <span class="attr">month</span>: <span class="number">9</span>,</span><br><span class="line">    <span class="attr">day</span>: <span class="number">9</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;year, month&#125; = date</span><br><span class="line"><span class="built_in">console</span>.log(year,month)</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ imageç·¨è­¯è¦å‰‡"><a href="#æ·»åŠ imageç·¨è­¯è¦å‰‡" class="headerlink" title="æ·»åŠ imageç·¨è­¯è¦å‰‡"></a>æ·»åŠ imageç·¨è­¯è¦å‰‡</h3><p>åœ–ç‰‡é¡å‹çš„éœæ…‹è³‡æºï¼Œæˆ‘å€‘ä¹Ÿå¿…é ˆçµ¦äºˆç·¨è­¯è¦å‰‡ã€‚é€™é‚Šæœƒç”¨åˆ°url-loaderã€file-loaderã€image-webpack-loaderä¸‰ç¨®loaderï¼Œä»¥ä¸‹åˆ†åˆ¥ç‚ºä»–å€‘çš„ç”¨é€”ã€‚</p><div class="note info flat"><p><strong>url-loader</strong> ï¼šè¼‰å…¥æª”æ¡ˆä¸¦è½‰ç‚ºbase64ç·¨ç¢¼ï¼ŒåµŒå…¥è‡³jsæª”å…§<br><strong>file-loader</strong> ï¼šè™•ç†å¼•å…¥çš„æª”æ¡ˆç‰©ä»¶ã€è¼¸å‡ºç›®éŒ„å’Œå®ƒçš„url<br><strong>image-webpack-loader</strong> ï¼šå°‡åœ–ç‰‡å£“ç¸®å„ªåŒ–</p></div><p>ä¸€èˆ¬file-loaderå°±èƒ½è®“æˆ‘å€‘å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼Œè€Œurl-loaderå¯ä»¥è¨­å®šæª”æ¡ˆä¸‹é™ï¼Œå°‡æª”æ¡ˆåµŒå…¥jsæª”æ¸›å°‘ä¹‹å¾Œç¶²é æ¸²æŸ“æ™‚requestæ¬¡æ•¸ã€‚</p><h4 id="å®‰è£æŒ‡ä»¤-2"><a href="#å®‰è£æŒ‡ä»¤-2" class="headerlink" title="å®‰è£æŒ‡ä»¤"></a>å®‰è£æŒ‡ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader@4.1.1 file-loader@6.2.0 image-webpack-loader@7.0.1</span><br></pre></td></tr></table></figure><h4 id="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-2"><a href="#æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-2" class="headerlink" title="æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"></a>æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡</h4><div class="tabs" id="æ·»åŠ imageç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ·»åŠ imageç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1">webpack.config.dev.js</button></li><li class="tab"><button type="button" data-href="#æ·»åŠ imageç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-2">webpack.config.prod.js</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ imageç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-1"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonWebpackConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonWebpackConfig, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|jfif|svg)$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">name</span>: <span class="string">&#x27;assets/images/[hash:7].[ext]&#x27;</span>,</span><br><span class="line">                            <span class="attr">limit</span>: <span class="number">8192</span>,</span><br><span class="line">                            <span class="attr">esModule</span>: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ·»åŠ imageç·¨è­¯è¦å‰‡-æ’°å¯«æ¨¡çµ„ç·¨è­¯è¦å‰‡-2"><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonWebpackConfig = <span class="built_in">require</span>(<span class="string">&quot;./webpack.config.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonWebpackConfig, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">            <span class="attr">cssProcessorPluginOptions</span>: &#123;</span><br><span class="line">              <span class="attr">preset</span>: [<span class="string">&#x27;default&#x27;</span>, &#123; <span class="attr">discardComments</span>: &#123; <span class="attr">removeAll</span>: <span class="literal">true</span> &#125; &#125;],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|jfif|svg)$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">name</span>: <span class="string">&#x27;assets/images/[hash:7].[ext]&#x27;</span>,</span><br><span class="line">                            <span class="attr">limit</span>: <span class="number">8192</span>,</span><br><span class="line">                            <span class="attr">esModule</span>: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;image-webpack-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">mozjpeg</span>: &#123;</span><br><span class="line">                                <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">                                <span class="attr">quality</span>: <span class="number">65</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">optipng</span>: &#123;</span><br><span class="line">                                <span class="attr">enabled</span>: <span class="literal">false</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">pngquant</span>: &#123;</span><br><span class="line">                                <span class="attr">quality</span>: [<span class="number">0.65</span>, <span class="number">0.9</span>],</span><br><span class="line">                                <span class="attr">speed</span>: <span class="number">4</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">gifsicle</span>: &#123;</span><br><span class="line">                                <span class="attr">interlaced</span>: <span class="literal">false</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">webp</span>: &#123;</span><br><span class="line">                                <span class="attr">quality</span>: <span class="number">75</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="æ¸¬è©¦ç’°ç¯€-4"><a href="#æ¸¬è©¦ç’°ç¯€-4" class="headerlink" title="æ¸¬è©¦ç’°ç¯€"></a>æ¸¬è©¦ç’°ç¯€</h4><p>æˆ‘å€‘è©¦è‘—æ‹¿å¹¾å¼µä¸åŒå¤§å°çš„åœ–ç‰‡å¼•å…¥jsæª”ç·¨è­¯çœ‹çœ‹</p><p>å¦‚ä¸‹åœ–å¯ä»¥çœ‹åˆ°åŸå§‹è³‡ç”¢ä¸­æœ‰3å¼µåœ–ç‰‡ï¼Œä½†è¼¸å‡ºè³‡æ–™å¤¾åªæœ‰2å¼µï¼Œå› ç‚ºæœ‰ä¸€å¼µåœ–ç‰‡å¤§å°åƒ…5KBï¼Œè€Œæˆ‘å€‘åœ¨url-loaderè¨­ç½®çš„é™åˆ¶ç‚º10KBï¼Œå› æ­¤è¢«ä»¥base64ç·¨ç¢¼å¯«è‡³main.bundle.js</p><p><img src="https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/webpack-image-loader-prod-output.jpg" alt="Untitled"></p><div class="note warning flat"><p>file-loaderè™•ç†æª”æ¡ˆç‰©ä»¶ï¼Œä¹Ÿå¯ä»¥æ‡‰ç”¨åœ¨éŸ³è¨Šã€å­—å‹ã€æ–‡ä»¶æª”ç­‰ç­‰<br>url-loaderä¹Ÿæ˜¯ç›¸åŒæ¦‚å¿µï¼Œä¸éè¦æ³¨æ„å¤§å°é™åˆ¶ï¼Œéåº¦ä½¿ç”¨åè€Œè®“jsæª”è‚¥å¤§</p></div><h2 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h2><p>çœ‹å®Œå¯ä»¥ç™¼ç¾ä¸¦æ²’æœ‰ä»€éº¼å¤ªè¤‡é›œçš„æ¦‚å¿µï¼Œwebpackå°±åƒä¸€å€‹å®¹å™¨è®“æˆ‘å€‘çµ„è£æ‰€éœ€çš„å…§å®¹, è€Œåªè¦çŸ¥é“å„å€‹é›¶ä»¶çš„ç”¨é€”èˆ‡è¨­ç½®å°±å¯ä»¥æ·»åŠ å„å€‹éœ€æ±‚ã€‚ä¸éwebpackä¾ç„¶é‚„æœ‰é ˆå¤šå¯ä»¥ç ”ç©¶çš„ï¼Œä¾‹å¦‚è€ƒé‡ç¶²é æ•ˆèƒ½èˆ‡é«”é©—ä¸Šå¦‚ä½•æœ€ä½³åŒ–ç·¨è­¯éœæ…‹è³‡æºå°‡æœƒæ˜¯å¾ˆé‡è¦çš„èª²é¡Œã€‚</p><p>æœ€å¾Œé™„ä¸Šæœ¬æ¬¡å¯¦ä½œçš„ç¨‹å¼ç¢¼</p><div><a class='link-card' title='https://github.com/SP12893678/webpack-dev-server-learning' href='https://github.com/SP12893678/webpack-dev-server-learning'><div class='left'><img src=https://cdn.jsdelivr.net/gh/sp12893678/blog@gh-pages/img/github.svg></div><div class='right'><p class='text'>webpack-dev-server-learning</p><p class='url'>https://github.com/SP12893678/webpack-dev-server-learning</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯æ‰“åŒ…å·¥å…· </tag>
            
            <tag> webpack </tag>
            
            <tag> webpack-dev-server </tag>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
